##故障について

ノードキャッシュの有効期限を設定し、ウォームアップが完了した後も、リクエストがノードキャッシュにヒットしません。

## 考えられる原因

1. 複数のキャッシュを設定しているが、優先度が明確ではない。
2. オリジンサーバーのキャッシュポリシーに従うように設定されているが、オリジンサーバーのCache-Controlフィールドが`no-cache/no-store/private`になっている。

## ソリューション

1. キャッシュの優先度を正しく設定します
   CDNキャッシュルールは複数設定でき、最下部が優先されます。ここでは、お客様が想定しているルールが有効になるように、ユーザーの想定と優先度が一致していることを確認する必要があります。
2. キャッシュ時間を正しく設定します
コンソールのキャッシュ時間が短すぎないかチェックします。
>! ファイルアクセス頻度が低く、話題性に欠け、ユーザーが頻繁にアクセスしないURLは、すべてのキャッシュルールを満たしていても、ノードによってキャッシュから削除されるリスクがあります。
3. キャッシュ設定ルールが想定に合致しているかチェックします。
	- CDNキャッシュキールールがパラメータキャッシュルールに設定されて、ノードがキャッシュされないようにしているかチェックします。
	- CDNノードの期限切れのキャッシュ設定が強制的にキャッシュされないかチェックします。
	- CDNノードの期限切れキャッシュ設定がオリジンサーバーに従っている場合、back-to-origin時のオリジンサーバーのヘッダーが`no-cache/no-store/private`を返すかどうかチェックします。

## 処理手順

1. キャッシュ設定の優先度（最下部が優先）をチェックします
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側メニューバーで**ドメイン名管理**を選択し、ドメイン名操作列の**管理**をクリックして、ドメイン名の設定ページに進み、Tabを**キャッシュ設定**に切り替えると、**キャッシュキールール設定**が見つかります。下図に示すように、jpgの無視されないパラメータキャッシュの優先度は、パラメータキャッシュを無視するすべてのファイルの優先度よりも高くなります。業務のキャッシュポリシーが優先度設定に適合していることを確認する必要があります。

2. キャッシュ時間をチェックします
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側メニューバーで**ドメイン名管理**を選択し、ドメイン名操作列の**管理**をクリックして、ドメイン名の設定ページに進み、Tabを**キャッシュ設定**に切り替えると、**ノードキャッシュの有効期限の設定**が見つかります。下図に示すように、キャッシュ設定時間が短すぎると、ビジネスキャッシュポリシーへの適合を確保するため、キャッシュの設定が有効になっていないと誤解する可能性があります。

3. キャッシュポリシーをチェックします
キャッシュキールール設定とノードキャッシュ有効期限設定のポリシーをチェックして、想定と合致していることを確認します。
オリジンサーバーに従うように設定されている場合は、オリジンサーバーのCache-Controlフィールドが`no-cache/no-store/private`でないことを確認してください。
4. キャッシュする必要のあるリソースを再度プリフェッチし、プリフェッチが完了するのを待ってから、再度リクエストすれば完了です。

