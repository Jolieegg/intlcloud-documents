## 현상 설명

노드 캐시 만료 시간을 설정하고 프리패치가 완료된 후에도 요청이 여전히 노드 캐시에 히트되지 못합니다.

## 예상 원인

1. 여러 캐시 설정이 있지만 우선순위가 명확하지 않습니다.
2. 원본 서버의 캐시 정책을 따르도록 설정되어 있지만 원본 서버의 Cache-Control 필드가 `no-cache/no-store/private`입니다.

## 해결 방법

1. 캐시 우선순위를 정확하게 설정합니다.
   CDN 캐시 규칙은 여러 개를 설정할 수 있으며, 밑에 위치할 수록 우선순위가 높습니다. 고객이 기대하는 규칙이 적용되기 위해서는 사용자의 기대치와 우선순위가 일치해야 합니다.
2. 캐시 시간을 정확하게 설정합니다.
콘솔의 캐시 시간이 너무 짧지 않은지 확인합니다.
>! 파일 액세스 빈도가 낮고, 사용자가 자주 액세스하지 않는 URL은 모든 캐시 규칙을 충족하더라도 노드에 의해 캐시에서 제거될 위험이 있습니다.
3. 캐시 설정 규칙이 예상과 부합하는지 확인합니다.
	- CDN 캐시 키 규칙이 매개변수 캐시 규칙으로 설정되어 노드가 캐시되지 않았는지 확인합니다.
	- CDN 노드의 캐시 만료 설정에서 강제 캐시 정지 설정 여부를 확인합니다.
	- CDN 노드 캐시 만료 설정이 원본 서버를 따르는지, Origin-pull 시 원본 서버 헤더가 `no-cache/no-store/private`를 반환하는지 확인합니다.

## 해결 단계

1. 캐시 설정 우선순위 확인(하단 우선)
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 **도메인 관리**를 선택한 뒤 도메인 작업 열의 **관리**를 클릭하여 도메인 설정 페이지로 이동합니다. Tab을 **캐시 설정**으로 전환하면 **캐시 키 규칙 설정**을 찾을 수 있습니다. 아래 그림과 같이 jpg 매개변수 캐시 무시 안함 우선순위가 전체 파일 무시 매개변수 캐시보다 높으면 서비스 캐시 정책이 우선순위 설정에 부합한지 확인해야 합니다.

2. 캐시 시간 확인
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 **도메인 관리**를 선택한 뒤 도메인 작업 열의 **관리**를 클릭하여 도메인 설정 페이지로 이동합니다. Tab을 **캐시 설정**으로 전환하면 **노드 캐시 만료 설정**을 찾을 수 있습니다. 아래 그림과 같이 캐시 설정 시간이 너무 짧으면 캐시 설정이 적용되지 않았다고 잘못 인식할 수 있습니다. 캐시 정책이 적절한지 확인해야 합니다.

3. 캐시 정책 확인
캐시 키 규칙 설정 및 노드 캐시 만료 설정에서 정책을 확인합니다.
원본 서버를 따르도록 설정한 경우 원본 서버의 Cache-Control 필드가 `no-cache/no-store/private`가 아닌지 확인합니다.
4. 캐시할 리소스를 다시 프리패치하고, 프리패치가 완료된 후 다시 요청합니다.

