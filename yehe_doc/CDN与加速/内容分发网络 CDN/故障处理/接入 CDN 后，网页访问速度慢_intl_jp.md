
## 現象の説明

Tencent Cloud CDNを使用後、ウェブページのアクセス速度が非常に遅いままです。

## 考えられる原因

- 原因1：接続されているドメイン名のCDNアクセラレーションサービスが有効化されていません。これはドメイン名のDNSプロバイダでCNAMEレコードを設定していないためである可能性があります。[ドメイン名解決の確認](#step1)を実行してください。
- 原因2：ノードキャッシュの有効期限設定が間違っています。[ノードキャッシュの有効期限設定をチェック](#step2)を実行してください。
- 原因3：リソースへの初めてのアクセスで、そのリソースに対してプリフェッチ処理を実行していません。[URLのプリフェッチを実行](#step3)してください。
- 原因4：ウェブページのアーキテクチャ自体に問題があります。[ウェブページのアーキテクチャの最適化](#step4)を実行してください。



## 解決方法

[](id:step1)
### ドメイン名解決をチェック
以下の内容は、nslookupコマンドを使用してCDNアクセラレーションドメイン名のDNS解決をクエリーする例です。
```
nslookupアクセラレーションドメイン名
```
![](https://main.qcloudimg.com/raw/66c920f2edbc402f860461778c5d226a.png)
クエリーによるドメイン名解決で、上図の赤いボックスのサフィックスdnsv1.comを持つCNAME解決レコードがない場合は、接続したドメイン名のCDNアクセラレーションサービスが有効になっていないことを意味します。これはドメイン名DNSプロバイダでCNAMEレコードを設定していないためである可能性があります。[CNAMEの設定](https://intl.cloud.tencent.com/document/product/228/3121)ドキュメントに従い、ドメイン名のDNSプロバイダに移動してCNAMEレコードを設定することができます。

[](id:step2)
###  ノードキャッシュ有効期限設定をチェック
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のメニューバーで【ドメイン名管理】を選択し、ドメイン名操作列の【管理】をクリックして、ドメイン名設定画面に入ります。Tabを【キャッシュ設定】に切り替えると、【ノードキャッシュ期限切れ設定】が表示されます。
![](https://main.qcloudimg.com/raw/c65246f14eae93e66c0ecf33b4d8a778.png)

- アクセスしたリソースに対応するノードキャッシュルールをチェックし、ノードキャッシュの有効期限を0にした設定があるか、ノードキャッシュの有効期限が短すぎるか、またはキャッシュがないという状況が存在するかどうか確認します。
  CDNノードにキャッシュがない場合は、アクセスリクエストはback-to-originとなり、アクセラレーションの効果を得られなくなります。ユーザーの必要に応じてノードのキャッシュ時間を設定することをお勧めします。
- オリジンサーバーのキャッシュヘッダーCache-Controlがno-store/no-cache/privateに設定されているかどうか確認します。
  - オリジンサーバーのキャッシュヘッダーCache-Controlがno-store/no-cache/privateに設定されている場合、同時に「強制キャッシュ」を有効にしないと、CDNノードは設定したキャッシュ時間に基づくリソースのキャッシュを行いません。
  - 「強制キャッシュ」を有効にしておらずオリジンサーバーのCache-Controlフィールドがno-cache/no-store/privateの場合は、キャッシュ時間を設定しても、CDNノードもリソースをキャッシュしません。

その他の設定ルールについては、[ノードキャッシュ期限切れ設定](https://intl.cloud.tencent.com/document/product/228/38424)に移動してください。

[](id:step3)
### URLプリフェッチの実行

リソースへのアクセスが初めてで、そのリソースがプリフェッチ処理をされていない場合、CDNノードはback-to-originしてリソースをプルするため、初めてのアクセス速度が遅くても正常です。[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインして、【パージとプリフェッチ】内でURLプリフェッチ機能を探し、[URLプリフェッチ](https://intl.cloud.tencent.com/document/product/228/39000)を実行することを推奨します。
![](https://main.qcloudimg.com/raw/d7af46ee572c005dcb7dafdcb03c01dd.png)

[](id:step4)
### ウェブページアーキテクチャの最適化

ウェブページには動的リソースが比較的多く、アクセスするたびにback-to-originして最新のリソースをプルするため、アクセス速度に影響します。ウェブページの動的リソースの占める割合が多い場合は、オリジンサーバーを最適化して、動的リソースと静的リソースを分離し、CDN配信を使用して静的リソースの速度を上げることを推奨します。
