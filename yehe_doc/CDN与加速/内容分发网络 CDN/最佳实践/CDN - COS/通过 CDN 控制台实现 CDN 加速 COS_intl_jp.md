<style> 
table th:nth-of-type(1) { width:18%; } 
table th:nth-of-type(2){ width:82%; } 
</style>

本ドキュメントでは、CDN経由のCOSアクセラレーションについての全体的な操作フローと具体的な操作方法を詳しく説明します。

## 前提条件

1. Tencent Cloudのアカウント登録を完了し、実名認証します。
2. COSバケットを作成します。詳細については、[バケットの作成](https://intl.cloud.tencent.com/document/product/436/13309)をご参照ください。

## 操作ガイド

### ドメイン名の追加

[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションバーで**ドメイン名管理**をクリックしてドメイン名管理ページに進み、**ドメイン名の追加**をクリックします。 ![](https://staticintl.cloudcachetci.com/yehe/backend-news/tzMB146_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230224114903.png)

### COSをオリジンサーバーとして選択

#### その1：ドメイン名の設定

ドメイン名にアクセラレーション対象のリージョンとお客様のサービスドメイン名を追加し、次にプロジェクト、アクセラレーションタイプ、IPv6アクセスを有効にするかどうか、およびタグを選択します。
<img src="https://staticintl.cloudcachetci.com/yehe/backend-news/7Jsd355_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230224115825.png" width="60%">

**構成項目の詳細説明：**

| 構成項目   | 構成の説明                                                     |
| :------- | :----------------------------------------------------------- |
| アクセラレーションリージョン | 中国本土：グローバルユーザーからのアクセスは、中国本土のアクセラレーションノードにスケジューリングされてサービスを提供します。 <br/>中国本土以外：グローバルユーザーからのアクセスは、中国本土以外のアクセラレーションノードにスケジューリングされてサービスを提供します。 <br/>グローバル：グローバルユーザーからのアクセスは、最も近いノードにスケジューリングされてサービスを提供します。 <br/><br/>**注意事項：**中国本土と中国本土以外のアクセラレーションサービスは別々に課金されます。課金ポリシーについては[クリックして確認]（https://intl.cloud.tencent.com/document/product/228/2949）してください。 |
| アクセラレーションドメイン名 | 1. ドメイン名の長さは81文字以内です。 <br/>2. ドメイン名は工業情報化部にてICP申告済みである必要があります。 <br/>3.ドメイン名が`a.test.com`、`a.b.test.com`などの形式のサブドメイン名、または`*.test.com`、`*.a.test.com`のようなワイルドカード形式のドメイン名をサポートします。 <br/>4. ドメイン名がワイルドカード形式のドメイン名である場合、または他のユーザーによってすでに追加されている場合は、[所有権の検証](https://intl.cloud.tencent.com/document/product/228/5734)を行うことでドメイン名を追加または取り戻すことができます。 <br/><br/> **注意事項：** <br/>1. ワイルドカード形式のドメイン名を追加した後、そのサブドメイン名または第2レベルのワイルドカード形式のドメイン名を、その他のアカウントに追加することは現在サポートされていません。<br/>2. `*.test.com`と`*.a.test.com`の同時追加は現在サポートされていません。<br/>3. 現在、アンダーバーを含むドメイン名とpunycodeに変換された中国語ドメイン名の追加をサポートしています。<br/>　• 中国本土の中国語ドメイン名はまず中国語の形式で関連の申告を行う必要があります。<br/>　• 「中国語.ドメイン名」などの中国語ドメイン名は、サードパーティのツールで「xn--fiq228c.xn--eqrt2g」に変換した後、追加することができます。　<br/>　• 「test_qq.tencent.cloud」などのアンダーバーを含むドメイン名は、直接追加することができます。<br/>4. ドメイン名が悪意のあるドメイン名やハイリスクのドメイン名である場合は、追加できません。詳細については、[使用制限](https://intl.cloud.tencent.com/document/product/228/32981)をご参照ください。 |
| 所属プロジェクト | プロジェクトは、Tencent Cloudのすべてのクラウド製品の共有リソースセットの概念です。[プロジェクト管理](https://console.cloud.tencent.com/project)ページでプロジェクト関連の操作を実行できます。（任意） |
| アクセラレーションタイプ | Tencent Cloud CDNは、異なるサービスタイプに合わせてアクセラレーションパフォーマンスを最適化しています。より良いアクセラレーション効果を得るために、お客様のビジネスに最も近いサービスタイプを選択することをお勧めします。<br>CDNとECDNは、それぞれ静的リソースと動的リソースのアクセラレーションに適しています。<br>CDN：<br>• 小容量Webページファイル：eコマース、ウェブサイト、UGCコミュニティなど、小容量の静的リソース（たとえば、ホームページのスタイル、画像および小容量ファイル）を主とするサービスシーンに適しています。<br>•大容量ファイルのダウンロード：ゲームのインストールパッケージ、アプリケーションの更新、アプリケーションパッケージのダウンロードなど、比較的ファイル容量が大きいサービスシーンに適しています。<br>•オーディオ/ビデオ・オン・デマンド：オーディオとビデオのオンライン・オンデマンドなど、オーディオ/ビデオファイルのオンデマンドアクセラレーションサービスシーンに適しています。<br>ECDN：<br>• 動的・静的アクセラレーション：各種Webサイトのトップページなど、動的・静的データが組み合わさったサービスシーンに適しています。<br>•動的アクセラレーション：アカウントのログイン、注文取引、APIの呼び出し、リアルタイム照会などのシーンに適しています。<br><br>アクセラレーションタイプは一度選択すると、変更することはできません。変更する場合は、ドメイン名を削除して再度追加する必要があります。|
| IPv6アクセス | IPv6アクセス：ノードはデフォルトでIPv4アクセスをサポートしています。有効化するとIPv6アクセスをサポートするようになります。<br /><br/>**注意事項：** 中国本土でのみIPv6をサポートします。（任意） |
| タグ     | さまざまな次元からリソースのカテゴリー管理を行うために用います。既存のタグが要件を満たさない場合は、コンソールの[タグの管理](https://console.cloud.tencent.com/tag/taglist)に移動してください。（任意） |

#### その2：オリジンサーバーの構成

サービスオリジンサーバーの関連情報を構成します。CDNノードはキャッシュにリソースがない場合、オリジンサーバーに戻ってリソースを取得してキャッシュします。

1. **ドメイン名設定**内の**オリジンサーバータイプ**で選択：COSオリジン（すなわち、Cloud Object Storage）。
2. オリジンサーバーのサポート状況に応じて、Back-to-Originリクエストプロトコルを選択します。
3. オリジンサーバーのアドレス内で対応する**バケット**を選択します。
4. **プライベートバケットアクセス**を有効化するには、COS-bucket権限管理に移動して先にCDNサービスの権限承認を行う必要があります。権限承認を確認した後、手動で有効化できます。
5. Back-to-Origin HOSTはデフォルト値を保持し、変更する必要はありません。

**ドメイン名の追加**ページのすべての設定を入力した後、**追加を確認**をクリックし、ドメイン名の追加操作を完了します。ドメイン名の設定をネットワーク全体のノードに配信するには約5～10分かかります。しばらくお待ちください。

### 最終ステップ：CNAMEの構成

ドメイン名の追加が完了した後、**ドメイン名管理**ページで、CDNがドメイン名に割り当てたアクセラレーションCNAMEを確認することができます。
![](https://staticintl.cloudcachetci.com/yehe/backend-news/hKnF341_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230224143035.png)

追加するドメイン名のDNSサービスプロバイダ（Dnspodなど）に移動し、ドメイン名に対して当該CNAMEレコードを追加する必要があります。**DNS構成が有効になった後**、アクセラレーションサービスが実行可能になります。詳細については、[CNAMEの構成](https://www.tencentcloud.com/document/product/228/3121)をご参照ください。

## 推奨設定

1. 設定完了後、COS下のリソースファイルに対してプリフェッチを行います。事前に静的リソースをCDNアクセラレーションノードにプリフェッチすることで、オリジンサーバーのストレスを軽減して、レスポンスとダウンロードの速度を向上させることができます。詳細については、<a href="https://intl.cloud.tencent.com/document/product/228/39000"> キャッシュプリフェッチ</a>をご参照ください。
2. クロスドメインのヘッダーパラメーターを設定します。リソースのクロスドメイン権限に関する問題を解決する場合、詳細は<a href="https://intl.cloud.tencent.com/document/product/228/35320">HTTPレスポンスヘッダーの設定</a>をご参照ください。
3. クライアントのオリジンサーバーのリソースが変更されている場合、キャッシュを更新してからプリフェッチを行うことを推奨します。詳細は<a href="https://intl.cloud.tencent.com/document/product/228/6299">キャッシュ更新</a>をご参照ください。
