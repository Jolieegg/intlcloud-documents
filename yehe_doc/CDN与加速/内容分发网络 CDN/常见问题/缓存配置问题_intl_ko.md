[](id:q1)

### 노드 캐시 유효성 구성이란 무엇인가요?
노드 캐시 유효성 구성은 CDN 가속 노드가 사용자의 비즈니스 콘텐츠를 캐시할 때 따르는 기간 만료 규칙입니다.
CDN 노드에 캐시된 모든 사용자 리소스에는 '기간 만료' 문제가 있습니다. 만료 상태가 아닌 리소스의 경우, 노드에서 사용자의 요청을 수신한 후 해당 리소스를 바로 사용자에게 반환하여 가져오기 속도가 향상됩니다. 만료 상태(설정한 유효 기간이 지난 경우)인 리소스의 경우, 노드에서 사용자의 요청을 원본 서버에 발송합니다. 원본 서버 콘텐츠가 업데이트된 경우 다시 콘텐츠를 가져오고 노드에 캐시하는 동시에 사용자에게 반환합니다. 원본 서버 콘텐츠가 업데이트되지 않은 경우 노드의 리소스 캐시 시간만 업데이트합니다. 캐시 시간을 합리적으로 설정하면 히트율이 높아지고 원본 가져오기 빈도가 낮아짐으로써 대역폭 비용을 절감할 수 있습니다.


[](id:q2)
### 파일의 브라우저 내 캐시 시간을 어떻게 제어하나요?
콘솔에서 브라우저의 캐시 만료 시간을 설정할 수 있습니다. 자세한 내용은 [브라우저 캐시 만료 설정](https://intl.cloud.tencent.com/document/product/228/38932)을 참조하십시오.

[](id:q3)
### 캐시 없이 특정 파일을 반환하도록 CDN을 구성하려면 어떻게 해야 하나요?
디렉터리, 파일 경로, 파일 유형을 기반으로 리소스에 대한 캐시 유효성을 구성할 수 있습니다. 자세한 내용은 [노드 캐시 구성](https://intl.cloud.tencent.com/document/product/228/38424)을 참고하십시오.
파일에 대해 캐시 없음을 설정하면 파일이 CDN 노드에 캐시되지 않습니다. 파일을 요청할 때마다 CDN 노드는 원본 서버에서 직접 파일을 풀링합니다. 예를 들어 php;jsp;asp;aspx 동적 파일을 캐시하지 않고 html 파일에 대해 1일 캐시 유효 기간을 설정하고 다른 파일에 대해 30일 캐시 유효 기간을 설정합니다. 노드 캐시 유효성 구성은 다음과 같습니다.
![](https://staticintl.cloudcachetci.com/yehe/backend-news/268x818_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230320161250.png)

[](id:q4)
### CDN에서 지원하는 캐시 유효성 구성은 무엇입니까?
CDN을 사용하면 캐시 유효 기간과 쿼리 문자열 무시, 대소문자 무시, 원본 서버 추적 및 다양한 파일 유형에 대한 휴리스틱 캐시 활성화 여부를 설정할 수 있습니다. 이러한 캐시 규칙을 적절하게 사용하면 더 낮은 오리진 풀 속도와 대역폭 사용으로 히트율을 효과적으로 향상시킬 수 있습니다. 자세한 내용은 [캐시 구성](https://www.tencentcloud.com/document/product/228/35315) 및 [노드 캐시 구성](https://intl.cloud.tencent.com/document/product/228/38424)을 참고하십시오.

[](id:q5)
### CDN의 기본 캐시 구성은 무엇입니까?
가속 도메인 이름을 추가할 때 다양한 가속 서비스 유형을 기반으로 기본 노드 캐시 유효성 규칙이 추가되며 필요에 따라 수정할 수 있습니다.
- CDN - 웹 페이지 파일/대용량 파일/주문형 오디오 및 비디오 & ECDN - 동적 및 정적 콘텐츠(예: php;jsp;asp;aspx 동적 파일)를 비롯한 다음 유형의 리소스는 기본적으로 캐시되지 않습니다. 다른 파일은 30일 동안 캐시됩니다.
- ECDN - 동적 콘텐츠 가속의 경우 모든 파일이 캐시되지 않습니다.

규칙을 설정하지 않았거나 요청이 설정된 규칙을 미스한 경우, 기본적으로 다음과 같은 플랫폼 정책을 따릅니다.
- 사용자가 특정 서비스 리소스 요청 시, 원본 서버에 해당하는 HTTP Response Header에 Cache-Control 필드가 있는 경우, 해당 Cache-Control을 따릅니다.
- 원본 서버에 해당하는 HTTP Response Header에 Cache-Control 필드가 없는 경우, CDN 노드는 기본적으로 해당 리소스를 600초 동안 캐시합니다.

[](id:q6)
### 캐시의 매칭 방식은 무엇인가요?
여러 캐시 정책을 설정한 경우 서로 간에 중복이 있을 수 있습니다. 설정 항목표를 기준으로 아랫부분의 우선순위가 윗부분보다 높습니다. 특정 도메인의 캐시 설정이 아래와 같다고 가정합니다.
```
모든 파일 30일
.php .jsp .aspx 0초
.jpg .png .gif 300초
/test/*.jpg 400초
/test/abc.jpg 200초
```

도메인 이름이 `www.test.com`이고, 리소스는 `www.test.com/test/abc.jpg`이라고 가정했을 때, 매칭 방식은 아래와 같습니다.
1. 첫 번째 모든 파일과 매칭, 히트, 이 때 캐시 시간 30일
2. 두 번째와 매칭, 미스.
3. 세 번째와 매칭, 히트, 이 때 캐시 시간 300초
4. 네 번째와 매칭, 히트, 이 때 캐시 시간 400초
5. 다섯 번째와 매칭, 히트, 이 때 캐시 시간 200초

따라서 최종 캐시 시간은 200초이며, 마지막 매칭을 기준으로 적용합니다.


### 사용자 액세스가 CDN 노드 캐시에 히트되었는지 어떻게 판단합니까?
HTTP 응답 헤더의 X-Cache-Lookup 값에 따라 CDN 노드 캐시의 히트 여부를 판단할 수 있으며, 여러 X-Cache-Lookup 헤더가 동시에 존재할 수 있으며, 이는 다양한 레이어 급의 히트 상태를 나타내는 데 사용됩니다.
X-Cache-Lookup이 다음 임의 값 하나를 반환하면 캐시 히트를 의미하고 그렇지 않으면 캐시 미스를 의미합니다.
X-Cache-Lookup: Hit From MemCache
X-Cache-Lookup: Hit From Disktank
X-Cache-Lookup: Cache Hit
![](https://qcloudimg.tencent-cloud.cn/raw/2561202809f0f1f4f0e754fc50eafe9f.png)

### 원본 서버에서 파일이 변경되면 CDN 가속 노드의 캐시가 실시간으로 업데이트됩니까?
아니요. CDN 캐시 노드의 캐시는 실시간으로 업데이트되지 않습니다.
- CDN 캐시 노드는 콘솔에서 구성한 [노드 캐시 유효성 구성](https://intl.cloud.tencent.com/document/product/228/38424) 규칙에 따라 캐시를 업데이트합니다. 원본 서버에 파일 변경 사항이 있고 캐시가 여전히 유효한 경우 CDN 캐시 노드는 캐시를 업데이트하기 위해 Origin-pull을 수행하지 않습니다. 결과적으로 원본 서버의 파일은 캐시와 다릅니다.
- 원본 서버 리소스가 업데이트되면 CDN 노드의 캐시를 즉시 업데이트해야 합니다. [캐시 퍼지](https://console.cloud.tencent.com/cdn/refresh) 기능을 사용하여 CDN 노드에서 만료되지 않은 캐시를 업데이트하여 CDN 노드에 캐시되고 원본 서버에 저장된 리소스가 일관되도록 할 수 있습니다.
- 특정 파일의 캐시를 정기적으로 업데이트하려면 [예약 퍼지와 프리패치](https://console.cloud.tencent.com/cdn/plugins/refresh)를 통해 제 때에 퍼지 작업을 트리거할 수 있습니다.


### CDN에서 vary 특성 지원 여부
Tencent Cloud CDN은 vary 특성을 지원하며 현재 vary 기능은 A/B테스트 중입니다. 만약 현재 사용자의 원본 서버가 동일한 URL을 대상으로 하는 경우 원본 서버는 vary 헤더로 응답합니다. 예시: Vary: Accept-Charset, CDN 노드는 Accept-Charset 헤더를 기반으로 캐시를 구분합니다. 클라이언트가 파일을 다시 요청하면 CDN 노드는 서로 다른 Accept-Charset 헤더를 기반으로 해당 파일에 응답합니다.

Tencent Cloud CDN은 기본적으로 다른 압축 파일의 다중 버전 캐시를 지원하므로 vary 헤더 기능은 Accept-Encoding을 지원하지 않습니다. 원본 서버에서 반환되는 Vary 헤더의 값에 Accept-Encoding만 있을 때 CDN 노드는 이 헤더를 무시합니다.
