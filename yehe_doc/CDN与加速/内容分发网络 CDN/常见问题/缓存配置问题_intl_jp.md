[](id:q1)
### ノードキャッシュ期限切れ設定とは何ですか。
ノードキャッシュ期限切れ設定とは、CDNアクセラレーションノードがユーザーのサービスコンテンツをキャッシュするように設定する時に準拠する期限切れルールのセットです。
CDNノードにキャッシュされたユーザーリソースは、いずれも「期限切れ」の問題に直面しています。リソースが期限切れではない状態にある場合、ユーザーリクエストがノードに到達すると、ノードは対象リソースをユーザーに直接返し、取得速度を向上させます。リソースが期限切れの状態になっている場合（即ち、設定された有効時間を超えた場合）、ユーザーリクエストはノードからオリジンサーバーに送信されます。オリジンサーバーのコンテンツがすでに更新されていた場合は、コンテンツを再取得してノードにキャッシュすると同時に、ユーザーに返します。オリジンサーバーのコンテンツがまだ更新されていない場合は、ノードにあるリソースのキャッシュ時間のみを更新します。キャッシュ時間を適切に設定することで、ヒット率を効果的に向上させ、back-to-origin率を低下させ、ユーザーの帯域幅を節約することができます。


[](id:q2)
### ブラウザでのファイルキャッシュ時間はどう制御しますか。
コンソールはブラウザのキャッシュ期限を設定しています。詳細は[ブラウザキャッシュ期限設定](https://intl.cloud.tencent.com/document/product/228/38932)をご参照ください。

[](id:q3)
### CDNはどのように一部のファイルのキャッシュを設定していますか。一部のファイルがキャッシュされなかった場合は、直接back-to-originされますか。
ディレクトリ、ファイルパス、ファイルタイプに従って、対応するキャッシュ時間を設定してください。詳細については、[ノードキャッシュ設定](https://intl.cloud.tencent.com/document/product/228/38424)をご参照ください。
キャッシュオプションがキャッシュしないとなっている場合は、CDNノードが当該リソースをキャッシュしないということであり、ユーザーがCDNノードにアクセスリクエストを送信するたびに、CDNノードは直接オリジンサーバーに戻って対応するファイルを取り出します。
![]()

[](id:q4)
### CDNはどのようなキャッシュ期限切れ設定をサポートしていますか。
CDNは、各ファイルタイプのキャッシュ期限や、パラメータ、大文字と小文字の区別、オリジンサーバーの準拠などを無視するかどうかや、ヒューリスティックキャッシュルールなどの設定をサポートしています。キャッシュルールを適切に設定することで、ヒット率を効果的に向上させ、back-to-origin率を低下させることで、ユーザーの帯域幅を節約することができます。詳細については、[キャッシュ設定](https://intl.cloud.tencent.com/document/product/228/35315)と[ノードキャッシュ設定](https://intl.cloud.tencent.com/document/product/228/38424) をご参照ください。

[](id:q5)
### CDNのデフォルトのキャッシュ設定は何ですか。
アクセラレーションドメイン名にアクセスする場合、異なるサービスタイプに応じて、CDNはデフォルトのノードキャッシュ期限切れルールを追加できます。これは必要に応じて調整できます。
- CDN - ウェブページ小容量ファイル/大容量ファイルダウンロード/オーディオビデオオンデマンド & ECDN - 動的・静的アクセラレーション：通常の動的ファイル（例 php;jsp;asp;aspx）はキャッシュされず、その他のファイルはデフォルトでは30日間キャッシュされます。
- ECDN - 動的アクセラレーション：すべてのファイルはキャッシュされません。

いずれのルールも設定しない場合や、設定されたルールにリクエストがヒットしない場合は、デフォルトで次のようなプラットフォームポリシーに準じます。
- ユーザーがあるサービスリソースをリクエストし、オリジンサーバーに対応するHTTP Response HeaderにCache-Controlフィールドが存在している場合は、このCache-Controlに準じます。
- オリジンサーバーに対応するHTTP Response HeaderにCache-Controlフィールドが存在しない場合、CDNノードはデフォルトでこのリソースを600秒間キャッシュします。

[](id:q6)
### キャッシュのマッチング方法は何ですか。
複数のキャッシュポリシーが設定されている場合、互いに重複することがあるため、設定項目リストの下部の項目が上部の項目に優先するように設定します。あるドメイン名は次のキャッシュ設定で設定されていると仮定します。
```
すべてのファイルは30日間
.php .jsp .aspx 0秒
.jpg .png .gif 300秒
/test/*.jpg 400秒
/test/abc.jpg 200秒
```

ドメイン名が `www.test.com`で、リソースが`www.test.com/test/abc.jpg`であるとすると、そのマッチング方法は次のとおりです。
1. 1番目のすべてのファイルにマッチングし、ヒットした場合のキャッシュ時間は30日です。
2. 2番目にマッチングし、ヒットしませんでした。
3. 3番目にマッチングし、ヒットした場合のキャッシュ時間は300秒です。
4. 4番目にマッチングし、ヒットした場合のキャッシュ時間は400秒です。
5. 5番目にマッチングし、ヒットした場合のキャッシュ時間は200秒です。

そのため、最終のキャッシュ時間は200秒となり、最後のマッチングで有効となります。


### ユーザーのアクセスがCDN cacheにヒットしたかどうかをどのように判断しますか。
こんにちは、HTTPレスポンスヘッダーのX-Cache-Lookup情報を確認することができます。
![](https://qcloudimg.tencent-cloud.cn/raw/4c8b8e2954bacadd520c94e6fa4aff31.png)
X-Cache-Lookup: Hit From MemCache
X-Cache-Lookup: Hit From Disktank
X-Cache-Lookup: Cache Hit
以上のいずれかが戻ってくれば、キャッシュがヒットしたことを意味し、戻ってこなければキャッシュはヒットしていないことを意味します。

### オリジンサーバーがファイルを変更すると、CDNアクセラレーションノード上のキャッシュはリアルタイムで更新されますか。
CDNアクセラレーションノード上のキャッシュコンテンツは、リアルタイムでは更新されません。
- CDNノードは、コンソールに設定した[キャッシュの有効期限の設定](https://intl.cloud.tencent.com/document/product/228/35317)のルールに従ってキャッシュを更新してください。オリジンサーバーがファイルを変更しても、CDNキャッシュの有効期限がまだ切れていない場合、自動的にオリジンサーバーに戻ってファイルを更新することはありません。この場合、オリジンサーバーのファイルとCDNキャッシュのファイルは一致しません。
-  特定ファイルのコンテンツを自動で更新したい場合は、[キャッシュ更新](https://intl.cloud.tencent.com/document/product/228/6299)から自動でCDNキャッシュのクリーンアップをすることができます。次に、当該ファイルのリクエストからback-to-originし、最新のファイルを取得して、再キャッシュします。[キャッシュプリフェッチ](https://intl.cloud.tencent.com/document/product/228/39000)からCDNを自動でback-to-originしてリクエストし、最新のファイルを取得することもできます。
- 特定のファイルのキャッシュを定期的に更新したい場合は、**定期的な更新とプリフェッチ**から定期的に更新タスクをトリガーすることができます。
