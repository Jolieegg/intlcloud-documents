## 設定シナリオ
Tencent Cloud CDNサービスは、ビジネスソースへのアクセスのソース元を制御するためのIPアクセス頻度制限機能を提供します。クライアントIPからノードへの1秒あたりのアクセス数を制限することにより、高頻度のCC攻撃から防御し、悪意のあるユーザーによる盗用を防止することができます


## 設定ガイド
### 設定の確認
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、メニューバーで【ドメイン名管理】を選択して、ドメイン名の右側にある【管理】をクリックすると、ドメイン名設定画面に入ります。第2欄の【アクセス制御】でIPアクセス頻度制限の設定を確認できます。デフォルトでは設定は無効で、しきい値は空です。
![](https://main.qcloudimg.com/raw/647b73c63e867b31dfc1116fec3225b0.png)

### 設定を有効にする

スイッチをクリックし、頻度のしきい値を入力して【OK】をクリックすると、IPアクセス頻度制限機能が有効になります。
![](https://main.qcloudimg.com/raw/15303948df14017a03ed7b5890c3673a.png)
**設定についての説明**

+ 設定を有効にすると、QPS制限を超えるリクエストに対して直接514エラーが返されます。アクセス頻度の制限を低く設定する場合、利用頻度の高いユーザーのアクセスに影響する可能性があります。実際のビジネスニーズや使用シナリオに従って、適切なしきい値を設定してください。
+ IPアクセス制限は、単一IPの単一ノードのアクセス回数のみを制限します、悪意のあるユーザーが大量のIPを使用してネットワーク全体のノードを攻撃する場合、この機能は効果的に制御できません。

### 設定を無効にする
設定スイッチを使用すると、ワンクリックでオフにすることができます。スイッチがオフの場合、既存の設定があっても、この機能は実稼働環境では有効になりません。スイッチがオンの場合、この設定はネットワーク全体で有効になります。
![](https://main.qcloudimg.com/raw/1f3c1893aed28e3845a1adaea9abf1d9.png)

> !ご利用のアクセラレーションドメイン名のサービスエリアがグローバルアクセラレーションの場合、設定されたIPアクセス頻度制限はグローバルに有効になります。中国本土と中国本土以外の設定が一致しない場合については、現状ではサポートしていません。

## 設定例
アクセラレーションドメイン名`www.test.com`のIPアクセス制限の設定は以下のとおりです。
![](https://main.qcloudimg.com/raw/0d78c86a122b3b58c35ca2ba8b3316b6.png)
実際のアクセス状況は次のとおりです。
1. クライアントIPが`1.1.1.1`であるユーザーは、1秒間にリソース`http://www.test.com/1.jpg`を10回リクエストし、いずれもCDNアクセラレーションノードAの同じサーバーにアクセスしました。この場合、このサーバーで10個のアクセスログが生成されましたが、その中の9つはQPS制限を超えたため、ステータスコード「514」が返却されます。
2. クライアントIPが`2.2.2.2`であるユーザーは、1秒間にリソース`http://www.test.com/1.jpg`を2回リクエストします。アクセス要求は、ネットワークの状態により、処理のために2つのCDNアクセラレーションノードに分散される場合があります。 この場合、各ノードはコンテンツを正常に返します。

