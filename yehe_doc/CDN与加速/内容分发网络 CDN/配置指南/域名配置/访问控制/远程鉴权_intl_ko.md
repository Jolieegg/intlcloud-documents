## 원격 인증

### 설정 시나리오

Tencent Cloud는 불법 사용자가 고객의 리소스에 액세스하는 것을 방지하기 위해 CDN 엣지에서 [고급 타임스탬프 인증](https://intl.cloud.tencent.com/document/product/228/35237)을 지원합니다. 또한 클라이언트가 지정한 원격 인증 서버로 요청을 포워딩하는 기능도 지원합니다. 인증 서버는 사용자 요청을 확인하고, CDN은 원격 인증 서버에서 반환된 확인 결과에 따라 서비스를 계속할지 여부를 결정합니다.

원격 인증을 위한 요청 절차는 다음과 같습니다.

![](https://qcloudimg.tencent-cloud.cn/raw/8f8d75de26e96ebaf58676eee0ca084a.png)


1. 단말 사용자가 리소스를 요청합니다.
2. CDN은 동기적으로 원격 인증 서버에 요청을 포워딩합니다.
3. 원격 인증 서버가 인증 결과를 반환합니다.
4. CDN 노드는 인증 결과에 따라 사용자의 요청에 계속 응답할지 여부를 결정합니다.

> !
> - CDN 노드는 원격 서버에서 반환된 상태 코드에 따라 인증 통과 여부를 판단합니다. 인증 통과 상태 코드는 `200`/`206`/`304`이고 나머지 상태 코드는 인증 실패입니다. 인증에 통과하면 통과 허가(200 반환)하고, 실패하면 차단(403 반환)합니다.
> - 현재 동기 원격 인증만 지원합니다. 즉, CDN은 원격 인증 서버에서 반환된 인증 결과를 받은 후에만 응답할 수 있습니다.
> - 일부 해외 플랫폼은 원격 인증 설정을 지원하지 않으므로, 도메인 가속 영역을 수정하면 원격 인증 기능이 효력을 상실할 수 있습니다.
> - VOD 가속은 현재 원격 인증 설정을 지원하지 않습니다.



### 설정 가이드

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하고 메뉴 바에서 **도메인 관리**를 선택하고, 도메인 오른쪽의 **관리**를 클릭하여 도메인 설정 페이지로 진입한 후, **액세스 제어**에서 원격 인증을 설정합니다.

- 원격 인증 주소: HTTP/HTTPS 프로토콜을 지원하며 도메인 또는 IP 주소를 입력할 수 있습니다.
- 요청 방식: 원격 서버에 요청 또는 단말 사용자 요청 방법 따르기 또는 GET/POST/HEAD와 같은 요청 방법 지정을 지원합니다.
- 인증 파일 유형: 인증 적용 범위를 설정합니다. **모든 파일/파일 접미사 지정/파일 디렉터리 지정/파일 지정** 범위에 대한 원격 인증 활성화를 지원합니다.
- 인증 타임 아웃 시간: 원격 인증 서버의 응답 시간 초과 기간을 최대 30,000밀리초까지 설정합니다.
- 타임 아웃 실행 동작: 원격 인증 타임 아웃 후 실행할 동작을 설정합니다. 기본 동작은 릴리스입니다.

<img src="https://qcloudimg.tencent-cloud.cn/raw/02def6deb735b7defbbd26a86be9b022.png" width="60%">



### 예시 설명

고객의 가속 도메인이 'www.example.com'이라고 가정할 때, 원격 인증 설정은 다음과 같습니다.

- 원격 인증 주소: `www.remoteauth.com`.
- 요청 방법 : 단말 사용자 요청 방법 따르기.
- 인증 파일 형식: 모든 콘텐츠.
- 인증 초과 시간: 1500 밀리초.
- 타임 아웃 실행 동작: 차단.

이 때 사용자 요청 응답 프로세스 예시는 아래와 같습니다.
1. 사용자 GET 요청 발송: `http://www.example.com/v001/test.txt?token=Gf6Gq04ymjdSTXusvTmh8yalO82YsuKUQb63ToXOFc&e=1467565695283&sign=854124740723b575a7cfa4fc40f0be30`.
2. CDN 요청 수신 후, 원격 인증 서버에 대한 GET 요청 발송: `http://www.remoteauth.com/v001/test.txt?token=Gf6Gq04ymjdSTXusvTmh8yalO82YsuKUQb63ToXOFc&e=1467565695283&sign=854124740723b575a7cfa4fc40f0be30`.
3. 원격 인증 서버가 상태 코드 200을 반환합니다.
4. CDN은 인증이 통과된 것으로 판단합니다. 상태 코드 200을 반환하고 콘텐츠에 정상적으로 응답합니다.


