
## 구성 시나리오
서비스 리소스에 대한 액세스 출처를 제어하려면 Tencent Cloud CDN의 IP 블록리스트/얼로우리스트 기능을 사용할 수 있습니다.

사용자 요청 IP에 대해 액세스 제어 정책을 설정하여 액세스 출처를 효과적으로 제어하여 악성 IP에 의한 도용, 공격 등의 문제를 방지할 수 있습니다.

## 구성 가이드

### 구성 보기
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하여 왼쪽 사이드바에서 **도메인 관리**를 선택한 후 도메인 이름 오른쪽의 **관리**를 클릭하여 구성 페이지로 이동합니다. **액세스 제어** 탭을 열어 IP 블록리스트/얼로우리스트 구성 섹션을 확인합니다. 기본적으로 비활성화되어 있습니다.

### 구성 활성화

구성을 활성화하려면 켜기/끄기 스위치를 켭니다. IP 블록리스트/얼로우리스트 구성을 처음으로 활성화하고 사용 가능한 규칙이 없으면 규칙 추가 페이지가 나타납니다. IP 블록리스트/얼로우리스트 구성은 추가하는 규칙의 우선 순위에 따라 적용됩니다. 규칙 목록의 맨 아래에 있는 규칙이 가장 높은 우선 순위를 갖습니다.
>! 가속 도메인 이름이 전역 가속에 대해 구성된 경우 IP 블록리스트/얼로우리스트 구성이 전역적으로 적용됩니다. 이 구성은 중국 본토 내부 및 외부 리전의 요청을 구분하지 않습니다.

#### 규칙 추가 또는 수정
IP 블록리스트/얼로우리스트 구성 섹션에서 **규칙 추가**를 클릭하여 IP 블록리스트/얼로우리스트 규칙을 추가합니다.
**IP 블록리스트**
클라이언트 IP가 블록리스트의 IP 또는 IP 범위와 일치하는 경우, 액세스된 CDN 노드는 514 상태 코드를 직접 반환합니다.
**IP 얼로우리스트**
클라이언트 IP가 얼로우리스트의 IP 또는 IP 범위와 일치하지 않는 경우 액세스된 CDN 노드는 514 상태 코드를 직접 반환합니다.
**구성 제한 사항**

- 규칙을 추가할 때 규칙 유형으로 얼로우리스트 또는 블록리스트를 선택합니다. IP 블록리스트와 얼로우리스트는 상호 배타적이며 동시에 구성할 수 없습니다.
- 블록리스트와 얼로우리스트에 각각 최대 500개의 항목을 추가할 수 있습니다.
- IP 블록리스트 또는 얼로우리스트에 IP:Port 형식의 항목을 추가하지 마십시오.
- 예약된 IPV4/IPV6 주소 또는 주소 범위를 IP 블록리스트 또는 얼로우리스트에 추가하지 마십시오.
- 규칙 목록 하단에 있는 규칙의 우선순위가 가장 높습니다.
규칙을 수정하려면 작업 열의 규칙 오른쪽에 있는 **수정**을 클릭합니다.


#### 규칙의 우선순위 조정
규칙의 우선순위를 조정하려면 규칙 목록 위에 있는 **우선순위 조정**을 클릭합니다. 그 다음 작업 열의 규칙 오른쪽에 있는 위쪽 또는 아래쪽 화살표를 클릭하여 다음 그림과 같이 우선 순위를 조정합니다. 위쪽 화살표를 클릭하면 규칙이 한 행 위로 이동합니다. 아래쪽 화살표를 클릭하면 규칙이 한 행 아래로 이동합니다. 규칙의 우선순위를 조정한 후 **저장**을 클릭합니다.
>!규칙 목록에서 밑에 있을수록 우선 순위가 높습니다.
>

#### 규칙 삭제
규칙을 삭제하려면 작업 열에서 규칙 오른쪽에 있는 **삭제**를 클릭합니다. 팝업 창에서 확인을 클릭하여 삭제를 확인합니다. 규칙이 영구적으로 삭제됩니다.

### 구성 비활성화
구성을 비활성화하려면 켜기/끄기 스위치를 끕니다. IP 블록리스트/얼로우리스트 구성이 비활성화된 후에도 여전히 IP 블록리스트/얼로우리스트 규칙을 수정할 수 있습니다. 그러나 수정된 규칙은 프로덕션 환경에 즉시 게시되지 않습니다. 규칙은 IP 블록리스트/얼로우리스트 구성을 활성화한 경우에만 적용됩니다.

## 구성 예시
도메인 이름 `www.test.com`의 IP 블록리스트/얼로우리스트 구성이 다음과 같은 경우:
![](https://staticintl.cloudcachetci.com/yehe/backend-news/z5ge560_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230310104738.png)
실제 액세스는 다음과 같습니다.

1. IP가 1.1.1.1인 사용자가 `https://www.test.com/test/vod.mp4` 액세스를 요청하면 규칙 목록 하단의 블록리스트 규칙이 일치합니다. 이 경우 액세스 요청이 거부되고 514 상태 코드가 반환됩니다.
2. IP가 1.1.1.2인 사용자가 'https://www.test.com/test/vod.mp4' 액세스를 요청하면 블록리스트 규칙에 IP가 지정되어 있지 않기 때문에 블록리스트 규칙이 매칭되지 않습니다. 액세스 리소스에 대해 구성된 얼로우리스트 규칙은 IP 1.1.1.1의 액세스 요청만 허용합니다. 이 경우 IP 불일치로 인해 액세스 요청이 거부되고 514 상태 코드가 반환됩니다.
3. IP가 1.1.1.1인 사용자가 'https://www.test.com/vod.mp4' 액세스를 요청하면 블록리스트 규칙이 아닌 얼로우리스트 규칙이 매칭됩니다. 이 경우 액세스 요청이 허용되며 사용자는 예상대로 리소스에 액세스할 수 있습니다.
