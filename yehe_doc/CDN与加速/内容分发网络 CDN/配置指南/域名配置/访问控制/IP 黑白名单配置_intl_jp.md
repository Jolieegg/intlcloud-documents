
## 設定シーン
Tencent Cloud CDNは、業務リソースのアクセス元を制御するためのIPブラックリスト/ホワイトリスト設定機能を提供します。

クライアント側のIPに対してアクセス制御ポリシーを設定することにより、アクセス元を効果的に制御し、悪意のあるIP盗用や攻撃を防ぐことができます。

## 設定ガイド

### 設定の確認
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、メニューバーで**ドメイン名管理**を選択し、ドメイン名の右側の**管理**をクリックすると、ドメイン名設定画面に入ります。第2欄の**アクセス制御**でIPブラックリスト/ホワイトリストの設定を確認できます。デフォルトでは、無効になっています。

### 設定を有効にする

スイッチをクリックすれば設定を有効にできます。初めて設定を有効にする場合、ルールが存在しなければ、デフォルトではルールを新規作成する画面が表示されます。有効になっている場合、IPブラックリスト/ホワイトリストはルールに設定している優先度で反映されます。一番下にあるルールの優先度が最も高いです。
>!ご利用のアクセラレーションドメイン名のサービスエリアがグローバルアクセラレーションの場合、設定されたIPブラックリスト/ホワイトリストはグローバル範囲で有効になります。中国本土と中国本土以外の設定が一致しない場合については、現状ではサポートしていません。

#### ルールの新規作成/変更
IPブラックリストで**ルールを新規作成**ボタンをクリックすると、新しいIPブラックリスト/ホワイトリスクルールが作成されます。
**IP ブラックリスト**
クライアントIPがブラックリスト中のIPまたはIPセグメントに該当する場合、CDNノードにアクセスすると、514ステータスコードが直接返されます。
**IPホワイトリスト**
クライアントIPがホワイトリスト中のIPまたはIPレンジに該当しない場合、CDNノードにアクセスすると、514ステータスコードが直接返されます。
**設定ルール**

- 同一ルールでは、IPブラックリストとIPホワイトリストのどちらかを選択します。両方とも設定することはできません。
- IPブラックリスト/ホワイトリストはそれぞれ500個まで入力可能です。
- IP:ポートという形のブラックリスト/ホワイトリストがサポートされません。
- IPV4とIPV6予約済みアドレスおよびIPレンジをIPブラックリスト/ホワイトリストとして設定できません。
- ルールの優先度は下にある優先度の方が高いです。
ルールを変更する場合、ルールの右側の操作欄で、**変更**ボタンをクリックして、ルールの内容を変更できます。

#### ルール優先度の変更
ルールの優先度を変更する場合、ルールリストの上側で**優先度を変更**をクリックしルールの優先度を変更するモードに切り替えます。以下に示す画面で操作欄でルールの優先度を変更できます。上向き矢印はルールを上へ移動し、下向き矢印はルールを下へ移動します。変更後に、**保存**をクリックすると、変更後のルールの優先度が保存されます。
>!リスト下位の方は優先度が上部より高いです。
>

#### ルールの削除
ルールを削除する場合、ルールの操作欄で、**削除**ボタンをクリックすると、このルールを削除するか旨の確認ウィンドウが表示されます。OKをクリックすると、ルールが完全に削除されます。

### 設定を無効にする
設定状態の右側のスイッチをクリックすると、設定が無効になります。設定が無効になっている場合、IPブラックリスト/ホワイトリストルールを変更できるが、現在のネットワークでは直ちに反映されません。設定を有効にすれば、ルールが反映されます。

## 設定例
アクセラレーションドメイン名`www.test.com`のIPブラックリスト/ホワイトリストの設定が以下のとおりである場合：
![](https://staticintl.cloudcachetci.com/yehe/backend-news/z5ge560_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230310104738.png)
実際のアクセス状況は次のとおりです：

1. クライアント側のIPが1.1.1.1の場合、リソース`https://www.test.com/test/vod.mp4`にアクセスしようとすると、一番下にあるブラックリストルールに該当し、このユーザからのアクセスを許可せず、514を返します。
2. クライアント側のIPが1.1.1.2の場合、リソース`https://www.test.com/test/vod.mp4`にアクセスしようとすると、このIPがブラックリストルールに存在しないため、ブラックリストルールに該当しません。ただし、このユーザがアクセスしようとする内容がホワイトリストルールに該当します。このルールでは、IPが1.1.1.1のユーザからのアクセスのみを許可し、このユーザからのアクセスを許可せず、514を返します。
3. クライアント側のIPが1.1.1.1の場合、リソース`https://www.test.com/vod.mp4`にアクセスしようとすると、ブラックリストルールに該当せず、ホワイトリストルールに該当し、このIPからのアクセスを許可し、アクセス内容を返します。
