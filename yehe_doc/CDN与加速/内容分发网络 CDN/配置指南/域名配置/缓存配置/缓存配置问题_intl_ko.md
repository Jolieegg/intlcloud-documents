### 캐시 만료 설정이란 무엇인가요?
캐시 만료 설정은 CDN 가속 노드가 서비스 콘텐츠를 캐싱할 때, 따르는 하나의 만료 규칙을 설정하는 것을 가리킵니다.
CDN 노드에 캐싱된 사용자 리소스에는 "기간 만료"라는 문제가 있습니다. 리소스가 만료 상태가 아닌 상황에서 사용자의 요청이 노드에 도달하면, 노드가 해당 리소스를 사용자에게 바로 리턴함으로써 가져오기 속도를 높여줍니다. 리소스가 만료 상태라면(즉, 설정해 놓은 유효기간이 지난 경우), 사용자의 요청이 노드를 통해 원본 서버에 전송되어 콘텐츠를 다시 노드에 캐시함과 동시에 사용자에게 리턴합니다. 캐싱 시간을 합리적으로 설정하여 히트율은 높이고, 반대로 Origin-pull 확률은 낮춤으로 대역폭 사용을 절약할 수 있습니다.

### 고급 캐시 만료 설정이란 무엇인가요?
1. [CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 뒤, 왼쪽 메뉴의 [Domain Management]를 클릭해 도메인 관리 페이지에 들어갑니다.

2. 편집할 도메인이 속한 행을 찾고, 작업 메뉴에서 [Manage]를 클릭합니다.

   ![](https://main.qcloudimg.com/raw/53c1171f8b1fdec4ddd2f87f6c47fe12.png)

3. 캐시 만료 설정 모듈에서 **고급 캐시 만료 설정**의 스위치를 찾아 클릭하여 활성화합니다.

   ![](https://main.qcloudimg.com/raw/dcb2baf6f60df8836243778c70e4ee60.png)

4. 고급 캐시 만료 설정의 스위치를 활성화하면, 다음의 효과가 적용됩니다.
  사용자가 원본 서버에 특정 리소스를 요청할 때, Response HTTP Header 에 Cache-Control 필드가 포함되어 있으며 그 값이 `max-age = xxxx`라면, 노드는 설정된 만료 시간과 max-age 중 최솟값을 해당 리소스의 캐싱 시간으로 사용합니다.
 - 사용자의 원본 서버가`/index.html`의 max-age를 200초로 설정했고, CDN이 설정한 캐싱 시간이 600초라면, 파일의 실제 만료 시간은 200초가 됩니다.
 - 사용자의 원본 서버가`/index.html`의 max-age를 800초로 설정했고, CDN이 설정한 캐싱 시간이 600초라면, 파일의 실제 만료 시간은 600초가 됩니다.
>원본 서버 Response Header 에 Cache-Control 필드가 없으면, CDN은 기본으로 Cache-Control: max-age=600 헤더를 추가합니다.

### 파일의 브라우저 내 캐싱 시간을 어떻게 제어하나요?
Tencent Cloud CDN은 원본 서버의 Cache-Control 설정을 기본적으로 지원합니다. 현재 Cache-Control 헤더 설정은 지원하지 않으므로 CDN 노드에서 max-age를 설정할 수 없습니다. 단, CDN 노드가 원본 서버의 max-age를 상속하기 때문에 원본 서버에서만 설정하면 됩니다.

### 캐시 설정의 우선순위는 어떻게 조정하나요?
[노드 캐시 설정](https://intl.cloud.tencent.com/document/product/228/35317) 문서의 조작설명을 참조 바랍니다.

### CDN 외부 원본이 특정 파일을 캐싱하지 않도록 설정할 수 있나요? 캐싱 시간을 0으로 설정하면 캐싱하지 않나요?
디렉터리 및 파일 유형별로 캐싱 시간을 설정할 수 있습니다. 캐싱 시간을 0으로 설정하면 CDN 노드는 해당 리소스를 캐싱하지 않습니다. 사용자가 CDN 노드로 액세스 요청을 보낼 때마다 CDN 노드는 원본 서버로부터 해당하는 리소스를 불러와야 합니다. 캐시 설정과 관련된 내용은 [노드 캐시 설정](https://intl.cloud.tencent.com/document/product/228/35317)을 참조 바랍니다.

## Tencent Cloud가 지원하는 캐시 만료 설정에는 무엇이 있나요?
Tencent Cloud CDN은 여러 차원의 캐싱 시간 설정을 지원하며, 사용자 정의 우선순위 조정, Cache 상속 정책(고급 캐시 구성)을 지원합니다. 캐싱 시간을 합리적으로 설정하여 히트율은 높이고, 반대로 Origin-pull 확률은 낮춤으로써 대역폭 사용을 절약할 수 있습니다.

### CDN의 기본 캐시 설정은 무엇인가요?
도메인 액세스 시의 기본 설정은 아래와 같습니다.
- 외부 원본 도메인 액세스: 모든 파일의 캐시 만료 시간 기본값은 30일이지만, 동적 파일(예: .php .jsp .asp .aspx)의 기본값은 0이므로 이러한 동적 파일에 대한 요청은 바로 Origin-pull을 진행합니다.
- COS 원본 도메인 액세스: 모든 파일의 캐시 만료 시간 기본값은 30일입니다.
- 고급 캐시 만료 설정은 비활성화 상태로 기본 설정되어 있습니다.

### 캐시 상속 정책이 어떻게 되나요?
사용자로부터 특정 서비스 리소스를 요청받았을 때, 원본 서버에 상응하는 Response HTTP Header에 Cache-Control 필드가 존재할 경우 기본 정책은 다음과 같습니다.
- Cache-Control 필드가 max-age이므로, 해당 리소스의 캐싱 시간은 설정된 캐싱 시간을 기준으로 하며 Max-age 지정 시간은 상속하지 않습니다.
- Cache-Control 필드가 no-Cache 혹은 no-store이므로, 이때 CDN 노드는 해당 리소스를 캐싱하지 않습니다.

### 캐시의 매칭 방식은 무엇인가요?
여러 캐시 정책을 설정한 경우 서로 간에 중복이 있을 수 있습니다. 설정 항목표를 기준으로 아랫부분의 우선순위가 윗부분보다 높습니다. 특정 도메인의 캐시 설정이 아래와 같다고 가정합니다.
```
모든 파일 30일
.php .jsp .aspx 0초
.jpg .png .gif 300초
/test/*.jpg 400초
/test/abc.jpg 200초
```

도메인 이름이 `www.test.com`이고, 리소스는 `www.test.com/test/abc.jpg`이라고 가정했을 때, 매칭 방식은 아래와 같습니다.
1. 첫 번째 줄의 모든 파일과 매칭, 도달되며, 이때 캐싱 시간은 30일.
2. 두 번째 줄과 매칭, 미도달.
3. 세 번째 줄과 매칭, 도달되며, 이때 캐싱 시간은 300초.
4. 네 번째 줄과 매칭, 도달되며, 이때 캐싱 시간은 400초.
5. 다섯 번째 줄과 매칭, 도달되며, 이때 캐싱 시간은 200초.

따라서 최종 캐싱 시간은 200초이며, 마지막 매칭을 기준으로 적용합니다.
