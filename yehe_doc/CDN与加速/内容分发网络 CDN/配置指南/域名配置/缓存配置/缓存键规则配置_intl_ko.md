


## 설정 시나리오

Tencent Cloud CDN은 캐싱 시 Key-Value 포맷으로 리소스를 매핑하며, 여기에서 Key는 캐시 리소스의 고유한 식별자인 캐시 키를 가리킵니다. 캐시 키 규칙 설정을 통해 서로 다른 파일 유형의 콘텐츠에 필터링 매개변수와 대소문자 생략을 설정해 캐시 키를 최적화할 수 있습니다.



### 필터링 매개변수

- 사용자가 URL을 통해 리소스에 액세스하는 경우 특수한 작용을 하는 매개변수를 가지고 있을 수 있습니다. 다음 링크를 사용해 서로 다른 두 가지 이미지 표시합니다.
`http://cloud.tencent.com/1.jpg?version=1`
`http://cloud.tencent.com/1.jpg?version=2`
이러한 시나리오에서 필터링 매개변수를 비활성화해야하며 전체 URL을 캐시 키 값으로 하여 각 이미지 콘텐츠를 캐싱해 리소스를 구분합니다.

- 멀티미디어 시나리오에서 타임스탬프 서명 매개변수를 사용해 액세스를 인증하는 경우:
`http://cloud.tencent.com/1.mp4?sign=XXXXXX`
이러한 시나리오에서 필터링 매개변수를 활성화해야하며 ‘?’ 앞의 링크 `http://cloud.tencent.com/1.mp4`가 캐시 키 값이 됩니다. 노드는 1개의 리소스만 캐싱하며 타임스탬프 서명이 계속 변경되어도 서명을 통해 인증한 후 직접 캐시를 히트합니다.

### 대소문자 무시

비즈니스 시나리오에서 리소스 URL 경로의 대소문자 구분이 리소스 콘텐츠와 관련된 경우 대소문자 무시 설정을 비활성화할 수 있습니다.
비즈니스 시나리오에서 리소스 URL 경로의 대소문자 구분이 리소스 콘텐츠와 관련이 없는 경우 대소문자 무시 설정을 활성화하여 히트율을 향상시킬 수 있습니다.
>! 현재 플랫폼 업그레이드 관계로 대소문자 무시 활성화를 지원하지 않습니다.

## 설정 가이드

### 설정 조회

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 [도메인 관리]를 선택한 뒤 도메인 작업 열의 [관리]를 클릭하여 도메인 설정 페이지로 들어갑니다. Tab을 [캐시 설정]으로 전환하면 [캐시 키 규칙 설정]을 찾을 수 있습니다.

가속 도메인 추가 시, 필터링 매개변수는 서비스 유형에 따라 기본적으로 비활성화 또는 활성화할 수 있습니다.

- 가속 도메인에서 정적 가속 서비스 유형을 선택하는 경우 필터링 매개변수는 기본적으로 비활성화됩니다. 캐시 키 규칙 설정 중 모든 파일 규칙의 [필터링 매개변수]는 ‘필터링하지 않음’으로 동기화됩니다.
- 가속 도메인에서 다운로드, 스트리밍 미디어 VOD 서비스 유형을 선택하는 경우 필터링 매개변수는 기본적으로 활성화됩니다. 캐시 키 규칙 설정 중 모든 파일 규칙의 [필터링 매개변수]가 “모두 필터링”으로 동기화됩니다.


![](https://main.qcloudimg.com/raw/1f53ed863618b442233dd3e1bba6229b.png)

### 규칙 추가

필요에 따라 캐시 키 값 규칙을 추가할 수 있습니다.
<img src="https://main.qcloudimg.com/raw/48becf925518b2595097eddf7b4ec6d5.png" height="250" width="438" />

#### 설정 제한

- 도메인당 캐시 키 값 규칙(기본 규칙 포함)을 최대 20개까지 추가할 수 있습니다.
- 규칙 우선순위 조정 지원: 하단의 우선순위가 상단의 우선순위보다 높습니다. (기본 규칙의 우선순위는 조정할 수 없음)
- 단일 파일 유형/폴더/전체 경로 파일 규칙에는 최대 100개까지 내용을 입력할 수 있으며, 각 내용 사이에 ‘;’ 부호를 사용하여 분리합니다. 예: 파일 유형 - jpg;png
- 필터링 매개변수 - 지정 매개변수 보관
  - 모든 파일: 매개변수 이름은 최대 6개까지 추가할 수 있으며 각 매개변수의 이름은 20자를 초과할 수 없습니다.
  - 파일 유형/폴더/전체 경로 파일: 매개변수 이름은 최대 5개까지 입력할 수 있으며 각 매개변수의 이름은 20자를 초과할 수 없습니다.
    여러 매개 변수 이름 사이에 ‘;’ 부호를 사용하여 구분합니다. 예: key1;key2;key3

### 규칙 수정

캐시 키 값 규칙 작업 열의 [수정]을 클릭하여 이미 추가한 캐시 키 값 규칙을 수정할 수 있습니다.

>!기본 규칙은 필터링 매개변수와 대소문자 무시 설정만 수정할 수 있으며, 유형과 내용은 수정할 수 없습니다.

### 규칙 삭제

캐시 키 값 규칙 작업 열의 [삭제]를 클릭하여 추가한 캐시 키 값 규칙을 삭제할 수 있습니다. (기본 규칙은 삭제 불가)


## 설정 예시

가속 도메인 `www.test.com`의 [캐시 키 규칙 설정]이 다음과 같은 경우,
![](https://main.qcloudimg.com/raw/8c3f7f534c5fa849ca1594a0a244d840.png)

실제 액세스 상황은 다음과 같습니다:

클라이언트 요청 리소스가 `www.test.com/abc.jpg?version=1&colour=red`와 `www.test.com/abc.JPG?version=1&colour=red`인 상태에서, 모두 CDN 노드 X에 액세스를 요청했을 때 노드 X에 상기 두 리소스의 캐시가 없는 경우:

- 원본 서버에 요청하여 `abc.jpg` 이미지 리소스를 획득하고 CDN 노드 X에 캐싱하면, 필터링 매개변수가 모두 필터링으로 설정되어 있어 ‘?’ 앞에 있는 링크 `www.test.com/abc.jpg`가 캐시 키 값이 됩니다.
- 클라이언트에서 `www.test.com/abc.JPG?version=1&colour=red`를 요청하는 경우, 대소문자 무시가 활성화되어 있지 않아 이전에 캐싱한 `www.test.com/abc.jpg` 리소스를 히트할 수 없습니다. 원본 서버에 요청하여 `abc.JPG` 이미지 리소스를 획득하고 CDN 노드 X에 캐시하면 상응하는 캐시 키 값은 `www.test.com/abc.JPG`가 됩니다.



