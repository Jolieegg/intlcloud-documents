노드 캐시 만료 설정을 모두 업데이트한 경우 고급 모드에서 더 세분화된 설정을 제공합니다. 자세한 내용은 [노드 캐시 만료 설정(New)](https://intl.cloud.tencent.com/document/product/228/38424)을 참고하십시오. 

## 설정 시나리오
Tencent Cloud CDN 캐시 리소스가 트리거 방식이고 사용자가 특정 리소스에 액세스하는 경우, 요청을 받은 CDN 노드에서 해당 리소스를 캐시하지 않으면 사용자 원본 서버로 돌아와 리소스를 가져옵니다. 리소스(2XX 상태 코드) 가져오기에 성공하면 노드에서 캐시하고 사용자에게 리턴합니다.

CDN 노드에 캐시하는 리소스는 직접 관리할 수 없습니다. 원본 서버 리소스가 변경되었는데도 CDN 노드가 기존 리소스를 캐시해 사용자에게 반환하는 것이 우려되는 경우, 노드 캐시 규칙 설정을 통해 일정 수준의 제어가 가능합니다.

모든 CDN 노드 상의 캐시 리소스에는 '만료 시간' 개념이 존재하며, 요청된 캐시 리소스가 만료된 경우 노드에 캐시가 존재한다고 해도 무효로 판단되므로 다시 원본 서버에서 가져옵니다. 노드 캐시 규칙 설정에서 특정 유형, 특정 디렉터리 및 경로의 리소스를 지정하여 노드에서의 캐시 만료 시간을 설정할 수 있으며 실제 비즈니스 시나리오에 따른 설정이 가능합니다.

>!현재 캐시의 파일 크기 제한은 32G 이내입니다. 이 제한을 초과하면 정상적으로 캐시되지 않고 리소스를 Origin-pull합니다.

## 설정 가이드
### 설정 조회
[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 [도메인 이름 관리]를 선택한 뒤 도메인 작업 열의 [관리]를 클릭하여 도메인 설정 페이지로 들어갑니다. Tab을 [캐시 구성]으로 전환하면 [노드 캐시 만료 설정]을 찾을 수 있습니다.
![](https://main.qcloudimg.com/raw/834d620b98c9d7d387547e59a7e6a1f4.png)

### 규칙 추가

현재 CDN에서는 다음 네 가지 유형의 노드 캐시 만료 규칙을 지원합니다.
+ 파일 유형: 기입한 파일 확장자에 따라 캐시 만료 시간을 설정합니다. 포맷은 파일 유형 형식이며(예: 'jpg;css'), 각 확장자 사이에 ';' 부호를 사용해 분리합니다.
+ 폴더: 입력한 디렉터리 경로에 따라 캐시 만료 시간을 설정합니다. 포맷은 '/test' 형식이며, 끝에 '/' 부호를 삽입할 필요 없이 각 디렉터리 사이에 ';' 부호를 사용해 분리합니다.
+ 전체 경로 파일: 전체 파일 경로를 지정하여 캐시 만료 시간을 설정합니다. 포맷은 '/index.html' 형식이며, 전체 경로에 매칭되는 파일 유형을 삽입할 수 있습니다. (예: '/test/*.jpg')
+ 메인 페이지: 기본 루트 디렉터리에 대해 캐시 만료 시간을 설정합니다.

<img src='https://main.qcloudimg.com/raw/1a72478ce0bc4fc1ef6a22bcb8064a6b.png' style='width:400px'/>

**설정 제한:**
- 도메인당 최대 100개까지 캐시 규칙을 추가할 수 있습니다.
- 다수 규칙에 우선순위 변경 지원: 하단의 우선순위가 상단보다 높습니다.
- 단일 파일 유형/폴더/전체 경로 파일 규칙에는 최대 100개까지 콘텐츠를 입력할 수 있으며, 각 콘텐츠 사이에 “;” 부호를 사용하여 분리합니다. 예: 파일 유형 - jpg;png
- 캐시 시간은 최대 365일까지 설정할 수 있습니다.

>! [모드]에서 ‘고급 모드’를 선택하고 규칙을 제출한 경우, 고급 모드로 업그레이드됩니다. 자세한 내용은 [노드 캐시 만료 설정(New)](https://intl.cloud.tencent.com/document/product/228/38424)을 참고하십시오. 업그레이드 완료 후에는 기본 모드로 다시 복구할 수 없습니다.


#### 고급 캐시 만료 설정 활성화/비활성화
활성화 시, CDN은 히트된 캐시 규칙 상의 캐시 시간과 원본 서버의 max-age 값을 비교하여 더 작은 값을 실제 유효 캐시 시간으로 합니다.

- 사용자 원본 서버 '/index.html'의 Max-Age가 200초로 설정되어 있고, CDN에 설정된 캐시 시간이 600초인 경우, 노드에서 파일의 실제 만료 시간은 200초입니다.
- 사용자 원본 서버 '/index.html'의 Max-Age가 800초로 설정되어 있고, CDN의 캐시 시간이 600초인 경우, 노드에서 파일의 실제 만료 시간은 600초입니다.

> !활성화 시, 원본 서버가 Last-Modified 필드를 리턴하지 않으면 CDN에서 기본적으로 Last-Modified 필드를 추가하며, 이는 10분에 한 번씩 변경됩니다.

#### 원본 서버 활성화/비활성화 준수
활성화 시, 요청이 모든 설정된 캐시 규칙을 히트하지 않는 경우 원본 서버를 따릅니다.

>! 원본 서버 따르기 활성화/비활성화에서 활성화할 경우, 고급 캐시 만료 설정 활성화/비활성화를 사용할 수 없으며 둘 중에 하나만 사용할 수 있습니다.


### 플랫폼 기본 정책
스위치를 활성화하지 않은 상태에서 규칙이 설정되지 않았거나 요청이 설정된 규칙을 미스한 경우, 기본적으로 다음과 같은 플랫폼 정책을 따릅니다.
- 사용자가 특정 서비스 리소스 요청 시, 원본 서버에 해당하는 HTTP Response Header에 Cache-Control 필드가 있는 경우, 해당 Cache-Control을 따릅니다.
- 원본 서버에 해당하는 HTTP Response Header에 Cache-Control 필드가 없는 경우, CDN 노드는 기본적으로 해당 리소스를 600초 동안 캐싱합니다.


## 설정 예시
가속 도메인이 'cloud.tencent.com'인 노드 캐시 만료 설정이 다음과 같은 경우,
![](https://main.qcloudimg.com/raw/a585a6b560cb0e555b71e08bea179353.png)
실제 캐시 시간은 다음과 같습니다.

1. '/test/def.jpg' 파일의 노드 캐시 시간: 400초
2. '/test/1.png' 파일의 노드 캐시 시간: 5분
3. 기타 모든 파일의 노드 캐시 시간: 30일
