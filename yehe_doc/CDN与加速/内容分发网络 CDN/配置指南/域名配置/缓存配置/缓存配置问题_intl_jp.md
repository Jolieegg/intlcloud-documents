### キャッシュ有効期限の設定とは何ですか。
キャッシュ有効期限の設定とは、ビジネスコンテンツをキャッシュするときにCDNキャッシュノードが従うべき一連の有効期限ポリシーを指します。
CDNノードにキャッシュされたすべてのリソースには有効期限があります。有効期限が切れていないリソースの場合、ユーザーリクエストがノードに到達すると、ノードは対象リソースをユーザーに直接返し、取得速度を向上させます。期限切れのリソースの場合（即ち、設定された有効時間を超えた場合）、ノードはユーザーリクエストをオリジンサーバーに転送し、リソースを再取得してノードにキャッシュしてから、ユーザーに返します。キャッシュ時間を適切に設定することは、リソースヒット率を効果的に向上させ、back-to-origin率を低下させ、帯域幅の使用量を削減できます。

### 高度なキャッシュ設定とは何ですか。
1. [CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【ドメイン名管理】をクリックすると、管理ページが入ります。

2. 編集するドメイン名の行を見つけて、【管理】をクリックします。

   ![](https://main.qcloudimg.com/raw/53c1171f8b1fdec4ddd2f87f6c47fe12.png)

3. キャッシュ有効期限の設定モジュールから**高度なキャッシュ有効期限の設定**セクションを見つけて、スイッチをOFFからONに切り替えて有効にします。

   ![](https://main.qcloudimg.com/raw/dcb2baf6f60df8836243778c70e4ee60.png)

4. その後、次の結果が得られます。
  ユーザーがオリジンサーバーから特定のリソースをリクエストし、Response HTTPヘッダーに値がmax-age = xxxxのCache-Controlフィールドが含まれている場合、ノードは設定されている有効期限とmax-ageの中の最小値を該当リソースのキャッシュ時間とします。　
 - ユーザーのオリジンサーバーで/index.htmlのmax-ageが200秒、CDNに対応するキャッシュ時間が600秒に設定されている場合、ファイルの実際のキャッシュ有効期限は200秒となります。
 - ユーザーのオリジンサーバーで/index.htmlのmax-ageが800秒、CDNに対応するキャッシュ時間が600秒に設定されている場合、ファイルの実際のキャッシュ有効期限は600秒となります。
>オリジンサーバーのレスポンスヘッダーにCache-Controlフィールドがない場合、CDNはデフォルトではCache-Control: max-age=600ヘッダーを追加します。

### ブラウザーでのファイルキャッシュ時間をどのように制御しますか。
Tencent Cloud CDNは、デフォルトではオリジンサーバーのCache-Control設定をサポートします。現在、Cache-Controlヘッダーの設定がまだサポートされていませんので、CDNノードでmax-ageを設定することはできません。ただし、CDNノードはオリジンサーバーのmax-ageを継承しますので、オリジンサーバーでのみ設定すればいいです。

### キャッシュ設定の優先順位をどう調整しますか。
詳細については、[ノードキャッシュの設定](https://intl.cloud.tencent.com/document/product/228/35317) をご参照ください。

### CDNのオリジンサーバーは特定のファイルをキャッシュしないように設定できますか、キャッシュ時間を0に設定するとは、キャッシュしないということですか。
ユーザーは、ディレクトリとファイルのタイプに応じて対応するキャッシュ時間を設定することができます。キャッシュ有効期限が0に設定されている場合、CDNノードが該当リソースをキャッシュしません。その場合、ユーザーがCDNノードにアクセスリクエストを送信するたびに、CDNノードはオリジンサーバーから関連リソースを取り出す必要があります。キャッシュ設定の詳細については、[ノードキャッシュの設定](https://intl.cloud.tencent.com/document/product/228/35317)をご参照ください。

### Tencent Cloudはどのようなキャッシュ有効期限の設定をサポートしますか。
CDNサービスは、各ディメンションでのキャッシュ有効期限の設定、カスタム優先度の調整、およびキャッシュ継承ポリシー（高度なキャッシュ設定）をサポートします。 キャッシュ有効期限を適切に設定することは、リソースヒット率を効果的に向上させ、back-to-origin率を低下させ、帯域幅の使用量を削減できます。

### CDNはデフォルトのキャッシュ設定は何ですか。
ドメイン名にアクセスする場合、デフォルト設定は次のとおりです。
- 外部オリジンドメイン名へのアクセス：デフォルトでは、動的ファイル（php .jsp .asp .aspxなど）を除くすべてのファイルのキャッシュ有効期限は30日で、動的ファイルのキャッシュ有効期限は0です。このような動的ファイルに対してリクエストはオリジンサーバーに直接転送されます。
- COSオリジンドメイン名へのアクセス：デフォルトでは、すべてのファイルのキャッシュ有効期限は30日です。
- 高度なキャッシュ有効期限の設定はデフォルトで無効になっています。

### キャッシュ継承ポリシーとは何ですか。
ユーザーが特定のビジネスリソースをリクエストすると、オリジンサーバーに対応するResponse HTTP HeaderにCache-Controlフィールドが含まれます。この時、デフォルトのポリシーは次の通りです。
- Cache-Controlフィールドはmax-ageである場合、このリソースに対するキャッシュ有効期限は設定されたキャッシュ有効期限に準ず、max-ageで指定された時間を継承しません。
- Cache-Controlフィールドがno-cacheまたはno-storeである場合、CDNノードはこのリソースをキャッシュしません。

### キャッシュのマッチングルールとは何ですか。
複数のキャッシュポリシーが設定されている場合、互いに重複することがあるため、設定項目リストの下部の項目が上部の項目に優先します。あるドメイン名が次のキャッシュポリシーで設定されていると仮定します。
```
すべてのファイル（30日）
.php .jsp .aspx 0秒
.jpg .png .gif 300秒
/test/*.jpg 400秒
/test/abc.jpg 200秒
```

ドメイン名が `www.test.com`で、リソースが`www.test.com/test/abc.jpg`であるとすると、そのマッチングルールは次の通りです。
1. 1番目のすべてのファイルにマッチングし、ヒットしました。この場合のキャッシュの有効期限は30日です。
2. 2番目にマッチングし、ヒットしませんでした。
3. 3番目にマッチングし、ヒットしました。この場合のキャッシュ有効期限は300秒です。
4. 4番目にマッチングし、ヒットしました。この場合のキャッシュ有効期限は400秒です。
5. 5番目にマッチングし、ヒットしました。この場合のキャッシュ有効期限は200秒です。

そのため、最終のキャッシュ有効期限が200秒となります。
