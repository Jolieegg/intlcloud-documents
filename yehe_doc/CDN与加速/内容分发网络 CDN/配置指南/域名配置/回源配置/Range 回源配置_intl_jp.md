## 設定シナリオ
Tencent Cloud CDNがリソースをキャッシュする際に、ストレージ効率を改善するために、ファイルをシャードに分割して格納し、Rangeリクエストもサポートします。リクエストにHTTPヘッダー`Range: bytes = 0-999`が含まれている場合、ファイルの最初の1,000バイトがユーザーに返されます。

Back-to-Origin of Range設定を有効にすると、ユーザーがリクエストしたファイルの一部が期限切れの場合、CDNはユーザーのリクエストに従ってBack-to-Origin of Range 機能を実行して、ユーザーが必要とするファイルのみをプルしてキャッシュし、ユーザーに返します。Range back-to-origin設定を無効にすると、ユーザーが一部のファイルのみをリクエストした場合でも、CDNはback-to-originするときにファイル全体を取り出して、キャッシュして、リクエストされた一部のファイルをユーザーに返します。

Back-to-Origin of Range設定を有効にすると、大容量ファイルの配信効率が効果的に向上し、応答時間が改善され、オリジンサーバーへの負荷が軽減されます。

> ?
>- Back-to-Origin of Range設定を有効にすると、リソースはノードのシャードにキャッシュされますが、各シャードのキャッシュの有効期限が全部一致し、ユーザーが指定したキャッシュ有効期限ルールに従います。
> - Back-to-Origin of Range機能を使用するには、オリジンサイトで Rangeリクエストがサポートされている必要があります。そうでなければ、Back-to-Originが失敗する可能性があります。

## 設定ガイド

[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、左側のナビゲーションメニューバーで【ドメイン名管理】を選択して、ドメイン名の右側にある【管理】をクリックすると、ドメイン名設定画面に入ります。【back-to-origin設定】タブで、【Back-to-Origin of Range設定】を見つけることができます。

【Back-to-Origin of Range設定】は、デフォルトで無効になっています。COSオリジンサーバードメイン名の場合、デフォルトで有効になっています。必要に応じて、設定は自由に有効/無効にすることができます。
![](https://main.qcloudimg.com/raw/04b9ec63d365b60ba2c3a8c16bc61c36.png)



## 設定例
ドメイン名`cloud.tencent.com`のBack-to-Origin of Rangeが次のように設定されているとします。
![](https://main.qcloudimg.com/raw/04b9ec63d365b60ba2c3a8c16bc61c36.png)
ユーザーAがリソース`http://cloud.tencent.com/test.apk`をリクエストしてから、ノードがリクエストを受信し、キャッシュされている`test.apk`ファイルがすでに期限切れであることが判明した時に、back-to-originリクエストを送信します。ノードback-to-originはRangeリクエストを使用し、シャードによってリソースを取得してキャッシュします。この時に、ユーザーBもRangeリクエストを送信し、ノードに保存されているシャードがすでにRangeリクエストで指定されたバイトセグメントと一致する場合、リソースは直接にユーザーに返して、すべてのシャードの取得が完了するまで待つ必要がありません。

