
## 설정 시나리오
Tencent Cloud CDN은 301/302 상태 코드를 캐싱하지 않도록 기본 설정되어 있습니다. 원본 서버가 301/302 요청을 반환하면 CDN 노드에서 클라이언트에 자동으로 응답하고 클라이언트가 해당 리소스에 리디렉션되어 액세스합니다.

301/302 원본 정책 따르기 설정을 활성화하면, CDN 노드에서 원본을 가져올 때 301/302가 발생할 경우 필요한 리소스를 획득할 때까지(최대 3회 따름) 직접 리디렉션을 따릅니다. 실제 리소스를 클라이언트에 반환하므로 클라이언트는 리디렉션하지 않아도 됩니다.


## 설정 가이드

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후, 왼쪽 메뉴바에서 [도메인 관리]를 선택한 뒤 도메인 작업 열의 [관리]를 클릭하여 도메인 설정 페이지로 들어갑니다. Tab을 [Origin-pull 설정]으로 전환하면 [301/302 원본 정책 따르기 설정]을 찾을 수 있습니다. 기본적으로 비활성화 상태이며, 필요에 따라 활성화할 수 있습니다.
![](https://main.qcloudimg.com/raw/3d431956857ef20b21bb954e481c66e4.png)



## 설정 예시
도메인 `cloud.tencent.com`의 301/302 원본 정책 따르기 설정이 아래와 같을 경우,
![](https://main.qcloudimg.com/raw/cbbd0f472a50287fd425cd093a2dacb9.png)
사용자 A가 `http://cloud.tencent.com/1.jpg` 리소스를 요청한 경우, 노드에서 캐시가 미스되면 노드는 원본 서버에 필요한 리소스를 요청합니다. 원본 서버가 반환한 HTTP Response 상태 코드가 302이고 리디렉션 주소가 `http://cloud.tencent.com/2.jpg`인 경우 다음과 같습니다.
1. 301/302 원본 정책 따르기 설정 활성화 후, 노드에서 상태 코드가 301/302인 HTTP Response를 수신하면 바로 리디렉션 지정 주소로 요청을 발송합니다.
2. 필요한 리소스를 가져온 뒤 노드에 캐시하고 사용자에게 반환합니다.
3. 이때 사용자 B도 `http://cloud.tencent.com/1.jpg`에 요청을 보내면 노드에서 바로 히트되어 사용자에게 반환합니다.
4. 301/302 원본 정책 따르기 설정 활성화 후 최대 3회까지 리디렉션을 따라가며, 제한 횟수 초과 시 클라이언트에 바로 301/302를 반환합니다.

도메인 `cloud.tencent.com`의 301/302 원본 정책 따르기 설정이 아래와 같을 경우,
![](https://main.qcloudimg.com/raw/3d431956857ef20b21bb954e481c66e4.png)
사용자 A가 `http://cloud.tencent.com/1.jpg` 리소스를 요청한 경우, 노드에서 캐시가 미스되면 노드는 원본 서버에 필요한 리소스를 요청합니다. 원본 서버가 반환한 HTTP Response 상태 코드가 301/302이고 리디렉션 주소가 `http://xxx.tencent.com/1.jpg`인 경우 다음과 같습니다.

1. 노드에서 해당 HTTP Response를 사용자에게 바로 반환합니다.
2. 사용자가 `http://xxx.tencent.com/1.jpg`에 요청을 보낸 뒤 해당 도메인이 CDN에 액세스하지 않으면 가속 효과가 발생하지 않습니다.
3. 이때 사용자 B도 `http://cloud.tencent.com/1.jpg`에 요청을 보내면 위의 과정이 반복됩니다.
