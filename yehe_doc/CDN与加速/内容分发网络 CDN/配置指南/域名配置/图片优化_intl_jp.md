
## 設定シナリオ
大量の画像配信にTencent Cloud CDNを使用すると、画像の最適化を有効にして、要件を満たす画像リクエストのwebp、guetzli、tpg形式の画像を自動的に圧縮できます。これにより、画像によって生成されるダウンリンクトラフィックを効果的に削減し、コストを削減できます。 

## 設定ガイド
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、メニューバーから**ドメイン名管理**を選択し、ドメイン名の右側にある**管理**をクリックすると、ドメイン名設定ページに進み、オリジンサーバーがCOSである場合、**画像の最適化**メニューバーを表示できます：
- 関連する設定は、オリジンサーバーがCOSで、バージョンがCOS V5である場合にのみ、実行できます。
- Cloud Infiniteサービスをまだ有効にしていない場合は、このページをワンクリックするだけで、Cloud Infiniteサービスを有効にしてから、画像処理に関連する設定を実行できます。
- Cloud Infiniteサービスを有効にしている場合は、直接設定できます。

>?[Cloud Infinite](https://intl.cloud.tencent.com/products/ci)は、Tencent Cloudが提供する安全で安定した効率的なクラウドデータ処理サービスであり、Webp、Guetzli、TPGなどの画像処理により一定量のCloud Infinite料金が発生されます。[課金説明の確認](https://intl.cloud.tencent.com/document/product/1045/33431)をクリックしてください。

### Webp適応
Webp適応画像圧縮機能を有効にした後、以下の条件を満たすリクエストは、Webpによって処理された画像が直接返されます。以下の条件を満たさない場合は、元の画像が返されます：
- HTTPリクエストヘッダーのacceptヘッダーにimage/webpが含まれています。 
- 画像のサフィックスはjpg、jpeg、bmp、gif、pngです。

>! 
>- Webp画像圧縮によって発生された料金は、Cloud Infinite-基本的な画像処理料金に起因します。
>- 処理された画像の元の画像サイズは20MBを超えてはならず、幅と高さは30000画素を超えてはならず、合計画素は1億画素を超えてはなりません。処理された画像の幅と高さは9999画素を超えてはなりません。
>- アニメーション画像の場合、元の画像の幅*高さ*フレーム数は1億画素を超えず、GIFのフレーム数は300フレームに制限されます。

### Guetzli適応
Guetzli画像圧縮は、Cloud Infiniteによって開始された視覚的なロスレス圧縮サービスであり、JPG画像を高い比率で圧縮し、ユーザーのダウンロードトラフィックを節約し、ユーザーのダウンロード速度を高め、ユーザーエクスペリエンスを向上させることができます。これは、一部の色域と画像の詳細に対する人間の目の鈍感さを利用し、視覚効果に影響を与えることなく詳細情報を選択的に破棄し、同じ視覚効果の下で元の画像と比較して画像トラフィックの約35%〜50%を節約します。

Guetzli適応画像圧縮機能を有効にした後、以下の条件を満たすリクエストは、Guetzliによって処理された画像が直接返されます：
- HTTPリクエストヘッダーのacceptヘッダーにimage/guetzliが含まれています。
- 画像のサフィックスはjpg、jpegです。

> !
>- Guetzli画像圧縮によって発生された料金は、Cloud Infinite-Guetzli圧縮料金に起因します。
> - Guetzliを有効にすると、画像に初めてアクセスしたときに元のJPG画像が返され、同時に非同期Guetzli処理が開始されます。処理が完了した後、画像を再度リクエストすると、圧縮された結果画像が取得されます。
> - 現在のGuetzli画像圧縮サービスは、品質qが70を超え、画素数が400万画素未満のJPG画像のみを処理します。

### TPG適応

TPG圧縮は、Tencent Cloud Cloud Infiniteが提供する高度な画像圧縮機能です。この機能を使用すると、指定した形式の画像をTPG形式にトランスコードできます。これにより、画像のサイズが大幅に減少し、画像のトラフィックが大幅に削減され、ページのロード速度が向上します。

TPG適応画像圧縮機能を有効にした後、以下の条件を満たすリクエストは、TPGによって処理された画像が直接返されます。
- HTTPリクエストヘッダーのacceptヘッダーにimage/tpgが含まれています。
- 画像のサフィックスはjpg、jpeg、bmp、gif、png、webpです。

> !TPG 画像圧縮によって発生された料金は、Cloud Infinite-高度な画像圧縮料金に起因します。

## 注意事項
適応画像圧縮機能を有効にすると、URLにアクセスするためのキャッシュキーが変更されますが、**キャッシュ設定-キャッシュキールール設定**のキャッシュキールールの優先度が高くなります。
たとえば、jpgタイプのファイルで画像の最適化を有効にしている場合、リクエストURL`http://www.test.com/a.jpg?colour=red`は`http://www.test.com/a.jpgxxxxxx?colour=red`に変更されます。**キャッシュ設定-キャッシュキールール設定**には、すべてのファイル-すべてのパラメータを無視するとという優先度がより高いと、設定されている場合、すべてのパラメータを無視すると有効になり、リクエストURLは最終的に`http://www.test.com/a.jpgxxxxxx`に変更されます。




