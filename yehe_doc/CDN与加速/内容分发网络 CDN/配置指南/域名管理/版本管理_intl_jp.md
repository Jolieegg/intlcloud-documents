


<blockquote class="d-mod-alarm">
<div class="d-mod-title d-alarm-title">
<i class="d-icon-alarm"></i>お知らせ：
</div>
<p>現在この機能はカナリアリリース中です。アカウントで、この機能の有効化に合致したドメイン名がこの機能の項目に表示されない場合は、すべて公開されるまでお待ちください。</p>
</blockquote>


## 機能説明

Tencent Cloud CDNは、単一のドメイン名のバージョン管理をサポートしています。1つのバージョンは、1つのドメイン名設定に対応しており、ドメイン名に対して異なるバージョンをデプロイできます。本番環境とシミュレーション環境という2つのデプロイ環境をサポートします。

- 本番環境：カレントネットワーク環境のことで、アクセラレーションサービスが実際に有効になる環境です。
- シミュレーション環境：サンドボックス、ドメイン名機能テスト専用の独立した環境です。シミュレーション環境は規模が小さく、コンソールドメイン名の設定テストのみに対応しており、実際の業務の負荷に耐えたり、パフォーマンステストを行ったりすることはできません。

>!
>1. 現時点では未設定の自己証明書のみをサポートしています。画像最適化機能が有効になっていないドメイン名ではバージョン管理が有効になっています。
>2. それぞれの環境で、1回につき1つのバージョンのみデプロイできます。
>3. URL更新機能は本番環境とシミュレーション環境の両方で機能し、ディレクトリ更新およびURLプリフェッチ機能は本番環境でのみ機能します。 パージとプリフェッチ機能の説明については、[パージとプリフェッチ]（https://intl.cloud.tencent.com/document/product/228/33982）をご参照ください。
> 4. [使用量制限]（https://intl.cloud.tencent.com/document/product/228/7541）などのデータ/使用量の監視機能は、本番環境でのみ機能します。


## シナリオ

- ドメイン名設定のA/Bテスト



[](id:open)
## バージョン管理の有効化

[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、メニューバーで【ドメイン名管理】を選択して、ドメイン名リストに進みます。バージョン管理を有効にしたいドメイン名をクリックしてドメイン名設定ページに進むと、右上隅に【バージョン管理の有効化】と表示されます。
![](https://main.qcloudimg.com/raw/52d05f1d49c1143e572d5bd2ff7cb88c.png)

有効化を確認すると、現在のドメイン名の設定によって初版Ver.1として自動生成され、本番環境とシミュレーション環境に同時にデプロイされます。

## バージョン管理

バージョン管理を有効にすると、【バージョン管理ページ】 に進むことができ、バージョンの表示と管理を行うことができます。異なるバージョンは、バージョン番号**Ver.n (n=1,2,3,...)**によって区別されます。
ドメイン名リストページ> ドメイン名操作バー> 【その他】 > 【バージョン管理】と移動するか、またはドメイン名をクリックしてドメイン名設定ページの右上隅にある【バージョン管理】から【バージョン管理ページ】に進むことができます。
![](https://main.qcloudimg.com/raw/6d74d6b53b75ef97a63926718f50cda4.png)



### 新しいバージョンの追加
【新しいバージョンの追加】をクリックします。新しいバージョンを追加するときのバージョン設定は、デフォルトで現在の本番環境でのバージョン設定になります。これをベースとして調整、送信し、新しいバージョンを生成することができます。
![](https://main.qcloudimg.com/raw/7d6277fad76dd1391f9be965c4c99df0.png)

>! 新しいバージョンを送信した後、設定項目のエラーが表示された場合（設定項目の送信に成功しなかった可能性があります）も、このバージョンが引き続き生成されます（エラーのある設定項目はデフォルトで元の内容になります）ので、新たに作成する必要はありません。バージョン管理ページに戻ってこのバージョンを編集し、設定の調整を続けることができます。

### バージョンの編集

バージョンリストのうち最新バージョンがシミュレーション環境でパブリッシュされていない場合、編集することができます。バージョン操作列の【その他】 > 【編集】をクリックします。
![](https://main.qcloudimg.com/raw/ccd2e75a24c5076c0a624b5cd8cbbecb.png)
過去バージョン（最新バージョンより前のすべてのバージョン） は、シミュレーション環境でパブリッシュされているかどうかにかかわらず編集はできず、表示のみに対応します。

>!新しいバージョンを追加する前に、パブリッシュされていないバージョンがないか確認してください。バージョンが新しくなると、このバージョンは自動的に過去バージョンとなり、編集やシミュレーション環境でのパブリッシュが行えなくなります。


### バージョンのパブリッシュ

バージョン管理が有効になっているドメイン名に対して、次の手順によるバージョンのパブリッシュを行ってください。

1. シミュレーション環境でテストまたはパブリッシュするバージョンのオンライン化：バージョン操作列の【その他】>【シミュレーション環境にパブリッシュ】をクリックします。
![](https://main.qcloudimg.com/raw/13b8f5a168719c31c2c1b03b532933a9.png)
2. シミュレーション環境にデプロイされたバージョンのテスト：CDNはIPv4のIPをドメイン名に割り当て、クライアントのHOSTSを変更し、ドメイン名をこのIPに指定してテストを実行します。
3. 設定を調整して再テストする場合は、新しいバージョンを追加して送信し、新しいバージョンを生成して、手順1～2を繰り返す必要があります。
4. テストに合格した後、バージョンを本番環境と同期し、設定がカレントネットワーク環境に配信されると、ネットワーク全体が有効になります。シミュレーション環境カードのバージョン番号の横にある【本番環境と同期】をクリックします。
![](https://main.qcloudimg.com/raw/89b2d937dcba03f68c62a2aad60b9f6f.png)
5. 本番環境でバージョンを変更するには、手順1～4を繰り返してください。

>!
>- バージョンリストの最新バージョン（バージョン番号が最も大きいバージョン）のみがシミュレーション環境にパブリッシュすることができ、過去バージョンはすべて表示のみに対応します。
>- バックエンドの特殊設定またはプラットフォームのアップグレードと最適化が本番環境に直接配信され、カレントネットワークが有効になります。
>- ドメイン名が現在手動設定であるか、またはプラットフォームのアップグレードと最適化を行っている場合、テスト環境から本番環境にバージョンを同期するときに競合が発生する可能性があります。コンソールは、ドメイン名にバックエンドの特殊設定があることを示すエラーを報告しますので、新しいバージョンを作成して再度パブリッシュしてください。
>- シミュレーション環境のIPは、高い頻度で変化することはありません。ただし精度を確保するために、テストの前にIPの後ろにあるリフレッシュボタンをクリックして、最新のIPを取得することをお勧めします。



### バージョンの表示

対応するバージョンの操作列の【表示】をクリックすると、バージョンの設定内容が表示されます。


### バージョンのオフライン/オンライン
本番環境の【オフライン】をクリックすると、本番環境とシミュレーション環境のバージョンが同時にオフライン、つまりドメイン名がオフラインになり、アクセラレーションサービスがオフになります。

オフラインにした後、ドメイン名を再びオンラインにすることができます。本番環境の同じ位置の【オンライン】をクリックすると、本番環境とシミュレーション環境において、環境に表示されるバージョンが同時にオンラインになります。

## バージョン管理の無効化

通常の運用中にバージョン管理が有効になっているドメイン名の場合、バージョン管理を無効化することもできます。無効化すると、基本的なカレントネットワークの設定モードに戻ります。現在の本番環境で、オンラインになっているバージョンがカレントネットワークの設定になります。その他ストックされているバージョンはすべて表示されなくなり、復元できなくなります。

必要に応じて、再度[バージョン管理の有効化](#open)を行うことができます。


## 注意事項

バージョン管理が有効になっているドメイン名：
- [設定のコピー](https://intl.cloud.tencent.com/document/product/228/38936)、[一括変更設定](https://intl.cloud.tencent.com/document/product/228/39911)など、一括設定機能はサポートされていません。
- コンソール左側のナビゲーションバーにある証明書管理ページでの証明書の個別設定はサポートされていません。
- アクセラレーションサービスを終了/起動すると、本番環境とシミュレーション環境のバージョンが同時にオフライン/オンラインになります。
- ドメイン名のタグや項目は引き続き編集可能です。
- ドメイン名のアクセラレーションリージョン、業務タイプは変更できません。変更が必要な場合は、まずドメイン名のバージョン管理をオフにしてください。 
