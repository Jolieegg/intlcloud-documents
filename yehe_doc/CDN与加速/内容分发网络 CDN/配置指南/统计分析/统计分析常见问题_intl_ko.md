### 액세스 모니터링 중 대역폭 데이터는 어떻게 계산되나요?
각 CDN 노드에서는 실시간으로 수집한 트래픽 데이터를 컴퓨팅 센터에 보고하고, 이를 종합해 도메인의 총 트래픽 데이터가 계산됩니다. 일정 시간 주기로 사용 트래픽/시간이 대역폭 데이터로 계산되어 표시됩니다.
**예시: **
- 1분 동안 생성된 총 트래픽이 6MB라면, 해당 대역폭은 (6 * 8)/60 = 0.8Mbps입니다.
- 대역폭 과금 시 5분 단위로 데이터를 결산하며, 해당 대역폭 값 = 5분 동안의 총 트래픽 ÷ 300초 입니다.

### 모니터링한 트래픽과 로그로 계산한 트래픽이 일치하지 않는 이유는 무엇인가요?
가속 도메인 로그에 기록된 다운스트림 바이트 수로 통계한 트래픽 데이터는 응용 레이어 데이터입니다. 실제 네트워크 전송 과정에서 생성되는 네트워크 트래픽은 순수 응용 레이어 트래픽보다 5%-15% 더 많습니다.
- TCP/IP 패킷 헤더 소모: TCP/IP 프로토콜 기반의 HTTP 요청으로, 각 패킷의 최대 크기는 1500바이트이며 TCP 및 IP 프로토콜의 40바이트 헤더를 포함합니다. 헤더 부분 역시 트래픽이 발생하지만 이는 응용 레이어에 의해 통계되지 않으므로, 이 부분의 비용은 약 3%로 계산됩니다.
- TCP 재전송: 정상적인 네트워크 전송 과정에서, 전송된 네트워크 패킷의 3%-10%가 인터넷에서 삭제되며, 삭제된 후 서버는 삭제된 부분을 재전송합니다. 이 부분의 트래픽 응용 레이어 역시 통계를 낼 수 없으며, 약 3%-7%를 자치합니다.

업계 표준의 경우 트래픽 과금은 일반적으로 응용 레이어 트래픽 기반에 상기 비용을 더하고, 여기에 Tencent Cloud CDN가 10%를 추가로 청구합니다. 따라서 모니터링 트래픽은 로그로 계산된 트래픽의 약 110%입니다.

### 트래픽 히트율은 어떻게 계산하나요?
기본적으로 CDN은 보조(L2) 캐시(엣지 레이어, 중간 레이어)로 적용되어 있으며, CDN의 한 레이어에 도달하여 요청에 응답하기만 한다면 CDN 노드에 도달했다고 판단합니다.
트래픽 히트율 = (총 다운스트림 트래픽 - Origin-pull 트래픽) / 총 다운스트림 트래픽

### 트래픽 히트율이 낮으면 어떻게 해결하나요?
- 캐시 제거 진행 여부 확인: 캐시 제거 시 노드에 지정된 콘텐츠를 지우므로, 히트율이 일시적으로 감소할 수 있습니다.
- 원본 서버에 새로운 리소스 존재 여부 확인: 원본 서버에 새로운 리소스가 많으면 CDN 노드 Origin-pull이 발생하여 트래픽 히트율이 감소할 수 있습니다.
- 원본 서버 비정상 여부 확인: 원본 서버에 장애가 발생하여 5XX 또는 4XX이 자주 나타나면 트래픽 히트율에 영향을 줄 수 있습니다.
- 캐시 만료 정책의 정상 설정 여부 확인: 콘솔 캐시 설정에서 '캐시 만료 설정' 섹션을 확인합니다. 캐시 만료 정책의 우선순위는 위에서 아래로(낮은 순서에서 높은 순서로)이므로, 아래의 캐시 정책이 위의 캐시 정책을 덮어씁니다.
- Range Origin-pull 활성화 여부 확인: 콘솔 Origin Configuration에서 'Range Origin-pull' 섹션을 확인합니다. Range Origin-pull이 비활성화되어 있으면 Origin-pull 시 요청에 따라 멀티 파트를 가져오지 않고, 전체 파일을 가져오게 됩니다. 이는 Origin-pull 트래픽을 증가시키므로 트래픽 히트율에 영향을 줍니다.
- 필터링 매개변수 활성화 여부 확인: 콘솔 액세스 설정에서 '필터링 매개변수' 섹션을 확인합니다. 필터링 매개변수가 비활성화되어 있으면 전체 경로가 캐싱됩니다. 동일한 리소스를 여러 매개변수가 요청하면 매칭하지 못해 여러 개로 캐싱하므로 트래픽 히트율에 영향을 줍니다.

### 상태 코드 통계 시 생성된 모든 상태 코드를 계산하나요?

그렇습니다. CDN Statistics의 새 버전이 런칭된 이후로, 원본 서버에서 생성된 상태 코드라면 해당하는 모니터링 곡선이 생성되어 오류 문제를 간편히 해결할 수 있습니다.

### 성 및 통신사의 통계 데이터는 어떻게 계산하나요?
성 및 통신사의 통계 데이터는 액세스 로그에서 Client IP 정보를 사용하여 계산됩니다. 이때 순수 로그 계산을 사용하므로, 누적량이 '모든 지역', '모든 통신사'를 선택할 때 사용하는 과금 데이터와는 약간의 차이가 있습니다. 자세한 원인은 상기 두 번째 질문을 참조 바랍니다.


### CDN Origin-pull 트래픽은 어떻게 발생하나요?

CDN Origin-pull 트래픽은 아래의 세 가지 상황에서 발생할 수 있습니다.
1. CDN 노드에 없을 때부터 원본 서버에서 가져올 때까지.
2. 원본 서버 수동 업데이트 후 노드에 동기화될 때.
3. 원본 서버 업데이트가 자동 업데이트될 시간이 됐을 때.

### CDN 트래픽이 비정상적입니다/DDOS, CC 공격을 받았습니다.

서비스 액세스양이 그리 크지 않다고 판단된다면, 로그를 다운로드하여 본인의 비즈니스 액세스 현황에 따라 액세스 제한을 설정할 수 있습니다. CDN에서는 고객님의 비즈니스 상황을 정확히 알 수 없으므로 액세스를 제한하지 않도록 기본 설정되어 있습니다. 고객님의 비즈니스 현황에 맞게 직접 설정하시기 바라며, 자세한 내용은 [로그 다운로드](https://intl.cloud.tencent.com/document/product/228/6316)를 참조 바랍니다.

귀하의 사이트가 트래픽을 도용 당하거나 CC/DDOS 등 공격을 받지 않도록 아래와 같이 설정할 것을 적극 권장합니다.
1. 링크 도용 방지 설정: 서비스 리소스의 액세스 출처를 제어합니다. 사용자의 HTTP Request Header 에서 referer 필드의 값으로 액세스 제어 정책을 설정하여 액세스 출처를 제한하고, 악성 사용자의 도용을 막을 수 있습니다. 자세한 내용은 [링크 도용 방지 설정](https://intl.cloud.tencent.com/document/product/228/6292)을 참조 바랍니다.
2. IP 블랙리스트/화이트리스트 설정: 비즈니스에 따라 사용자가 요청할 원본 IP에 필터링 정책을 설정하여 악성 IP 도용, 공격 등을 해결할 수 있습니다. 자세한 내용은 [IP 블랙리스트/화이트리스트](https://intl.cloud.tencent.com/document/product/228/6298)를 참조 바랍니다.
3. IP 액세스 빈도 제한 설정: 각 노드에서 클라이언트 IP의 초당 액세스 횟수를 제한하여 CC 공격을 방어할 수 있습니다. 설정을 활성화하면 QPS 제한을 초과한 요청은 514를 바로 반환합니다. 빈도 제한을 낮게 설정할 경우 일반적인 고빈도 사용자의 사용에 영향을 미칠 수 있으므로, 비즈니스 현황과 사용 시나리오에 맞는 적절한 임계 값을 설정해야 합니다. 자세한 내용은 [IP 액세스 빈도 제한 설정] (https://intl.cloud.tencent.com/document/product/228/6420)을 참조 바랍니다.
4. 대역폭 상한 설정: 도메인에 대역폭 상한 임계 값을 설정하면, 도메인이 한 통계 주기(5분) 동안 생성한 대역폭이 지정한 임계 값을 초과할 경우 설정에 따라 모든 액세스를 원본 서버로 반환하거나, CDN 서비스를 바로 종료하여 모든 액세스에 404를 반환합니다. 자세한 내용은 [대역폭 상한 설정](https://intl.cloud.tencent.com/document/product/228/7541)을 참조 바랍니다.

### API를 사용하여 데이터를 조회할 때 딜레이가 있나요? 또 얼마나 딜레이되나요?
API로 데이터를 조회하면 일정 시간의 딜레이가 있습니다. 액세스 데이터, 과금 데이터 등의 실시간 데이터를 조회할 때는 5~10분 정도의 딜레이가 발생하며, TOP 데이터 등 분석 유형의 데이터를 조회할 때는 30분 정도의 딜레이가 발생합니다. 백그라운드에서는 새벽 3시 전후에 데이터에 대해 검증을 실시합니다.



