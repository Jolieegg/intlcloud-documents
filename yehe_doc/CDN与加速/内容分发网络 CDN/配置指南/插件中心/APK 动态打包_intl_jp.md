## 機能の説明

APK動的パッケージプラグイン機能は、エンドユーザーのリクエストURL中の特定パラメータを識別し、このパラメータが持つ情報をCDNエッジのAPKに動的に書き込み、CDNエッジでAPKに対する動的パッケージの実行を実現します。APK動的パッケージはTencent Cloud COSをオリジンサーバーとして使用することを要求します。

> ? 現時点では中国本土のノードのみAPK動的パッケージ機能をサポートしています。

## 適用ケース

- アプリケーション市場、ネットワークアライアンス、検索エンジン、パフォーマンス広告など、Appマルチチャネルへの配信。ただし、大量のチャネルパッケージを手動でメンテナンスしたくない場合。
- Appホットスタート。APKパッケージに動的にリンクを挿入することで、初回アクティベーション時にAppが起動し、指定したページに自動的にジャンプできるようにします。

## 使用手順

1. プラグインセンターのCDNコンソールにログインし、APK動的パッケージプラグイン機能の関連する設定を完了します。
2. オリジナルのAPKをCOSオリジンサーバーの指定するアップロードディレクトリにアップロードします。
3. CDNノードが親パケットの処理を完了するのを待ちます。
4. エンドユーザーがパラメータ付きのリクエストを送信します。
5. CDNエッジが動的パッケージ後のAPKファイルを返します。

![]()

## 設定ガイド

### ステップ1：動的パッケージの追加設定

[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、メニューバーから**プラグインセンター**を選択します。APK動的パッケージプラグイン機能カードのスイッチボタンをクリックし、APK動的パッケージをアクティブにし、追加設定ページに進みます。機能をアクティブにした後は、カード下部の**基本設定**、**使用量の統計**から対応する設定リストと使用量確認ページに進むことができます。 
<img src="" width="80%">

- バケットの選択：COSオリジンサーバーを選択します。本機能は必ず**北京/上海/広州/成都**のCOSをオリジンサーバーとして使用します。
- 有効ドメイン名：システムは、このCOSをオリジンサーバーのドメイン名として自動的に選択し、このドメイン名をAPKの公開に使用します。自分で追加や削除が可能です。
- アップロードディレクトリ：オリジナルのAPKをCOS上にアップロードするディレクトリを設定します。 設定の完了後、オリジナルのAPKをこのディレクトリに手動でアップロードする必要があります。
- 出力ディレクトリ：CDNノードが親パケットの処理を完了した後の出力ディレクトリを設定します。 オリジナルのAPKをアップロードした後、システムが自動的に同名の親パケットを処理、生成し、親パケットをこのディレクトリにアップロードします。 **リクエストURLを作成する時は、アップロードディレクトリではなく、このディレクトリを指定してください。**
- 署名方式：現時点ではAndroid V1/V2署名方式を採用したAPKに対する動的パッケージをサポートし、 V2署名はWALLE/VASDOLLYなどのオープンソースのマルチチャネルのパッケージスキームをサポートしています。 同時に、コメント情報の指定したカスタムBlock IDへの書き込みもサポートしています。
- チャネルパラメータ：`comment`に固定され、変更はできません。
- SCFの設定：権限承認後、システムは設定に基づいて自動的にSCFを生成します。

> !SCFコンソールでこのSCFを削除しないでください。

### ステップ2：オリジナルAPKのアップロード

[COSコンソール](https://console.cloud.tencent.com/cos5) にログインし、オリジナルのAPKを指定されたアップロードディレクトリにアップロードします。

> ?オリジナルのAPKのサイズは10GB以下とします。

### ステップ3：親パケットの処理完了待機

APK動的パッケージ機能ページで、**親パケットのステータス**をクリックし、CDNノードの親パケットに対する処理の進捗を確認します。 
![]()

### ステップ4：動的パッケージURLの公開

親パケットの処理が完了したら、動的パッケージURLを公開できます。具体的な例は次のとおりです。

```
バケット：example.cos.ap-chengdu.myqcloud.com
有効ドメイン名：www.example.com
アップロードディレクトリ：/src
出力ディレクトリ：/ext
チャネルパラメータ：comment
チャネル名：pipeline
apk名：test.apk
```

以上に対応する公開URL：`https://www.example.com/ext/test.apk?comment=pipeline`。

ユーザーがこのURLをリクエストすると、CDNエッジが`pipeline`チャネル情報を書き込んだ後のAPKパッケージを取得することができます。







