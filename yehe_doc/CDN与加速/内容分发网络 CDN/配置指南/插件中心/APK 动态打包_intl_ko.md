## 기능 소개

APK 동적 패킹 플러그 인 기능은 단말 사용자 요청 URL의 특정 매개변수를 식별하고, CDN 엣지에서 해당 매개변수의 정보를 동적으로 APK에 입력하여 CDN 엣지에서 APK에 대한 동적 패킹을 구현합니다. APK 동적 패킹은 Tencent Cloud COS를 원본 서버로 사용합니다.

> ? 현재 중국 내 노드에서만 APK 동적 패킹 기능을 지원합니다.

## 적용 시나리오

- App 다중 채널 전송. 예를 들어, 앱 스토어, 제휴 광고, 검색 엔진, 퍼포먼스 광고 등 다양한 채널을 수동 점검 없이 이용하려는 경우
- App 재부팅. APK 패키지에 동적으로 링크를 삽입하여 App을 처음으로 활성화하고 자동으로 지정 페이지에 리디렉션할 경우

## 사용 프로세스

1. CDN 콘솔의 플러그 인 센터에 로그인해 APK 동적 패킹 플러그 인 기능 관련 설정을 완료합니다.
2. 기존 APK를 COS 원본 서버의 지정한 업로드 디렉터리에 업로드합니다.
3. CDN 노드가 부모(Parent) 패키지를 처리할 때까지 기다립니다.
4. 단말 사용자가 매개변수를 지닌 요청을 보냅니다.
5. CDN 엣지가 동적 패킹된 APK 파일을 반환합니다.

![]()

## 구성 가이드

### 1단계: 동적 패킹 설정 추가

[CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인하고 메뉴에서 **플러그 인 센터**를 선택하고 APK 동적 패키징 플러그인 기능을 활성화하여 구성 페이지로 이동합니다. 기능이 활성화되면 페이지 하단의 **기본 구성** 및 **사용 통계**를 클릭하여 구성 목록 페이지 및 사용 통계 페이지로 각각 이동할 수 있습니다. 
<img src="" width="80%">

- 버킷 선택: COS 원본 서버를 선택합니다. 해당 기능은 반드시 **베이징/상하이/광저우/청두**의 COS를 원본 서버로 사용해야 합니다.
- 적용 도메인: 시스템이 자동으로 해당 COS를 원본 서버의 도메인으로 채용해 해당 도메인을 APK 배포에 사용합니다. 직접 추가하거나 삭제할 수도 있습니다.
- 업로드 디렉터리: 기존 APK의 COS 내 업로드 디렉터리를 설정합니다. 설정 후 기존 APK를 수동으로 해당 디렉터리에 업로드합니다.
- 출력 디렉터리: CDN 노드에서 처리하는 부모 패키지의 출력 디렉터리를 설정합니다. 기존 APK를 업로드한 후 시스템은 자동으로 부모 패키지를 처리 및 생성하고 해당 디렉터리에 업로드합니다. **요청 URL을 구성할 때 클라이언트 요청은 업로드 디렉터리가 아닌 해당 디렉터리를 지정하십시오.**
- 서명 방식: 현재 Android APK 서명 체계 V1/V2를 사용하여 APK를 동적으로 패키징할 수 있습니다. V2 서명은 WALLE/VASDOLLY 등 오픈 소스 다중 채널 패키징 솔루션을 지원합니다. 또한 지정된 사용자 정의 Block ID에 주석을 작성할 수도 있습니다.
- 채널 매개변수: `comment`로 고정되어 수정할 수 없습니다.
- SCF 설정: 권한 부여 후, 시스템이 설정에 따라 자동으로 SCF를 생성합니다.

> !SCF 콘솔에서 SCF를 삭제하지 마십시오!

### 2단계: 기존 APK 업로드

[COS 콘솔](https://console.cloud.tencent.com/cos5)에 로그인하고 기존 APK를 지정한 업로드 디렉터리에 업로드합니다.

> ?기존 APK 크기는 10GB를 초과할 수 없습니다.

### 3단계: 설치 부모 패키지 처리 완료 대기

APK 동적 패키징 기능 페이지에서 **부모 패키지 상태**를 클릭하여 CDN 노드의 부모 패키지 처리 진행률을 확인합니다. 
![]()

### 4단계: 동적 패킹 URL 배포

부모 패키지가 처리된 후 다음과 같이 동적 패키징 URL을 해제할 수 있습니다.

```
버킷: example.cos.ap-chengdu.myqcloud.com
적용 도메인: www.example.com
업로드 디렉터리: /src
출력 디렉터리: /ext
채널 매개변수: comment
채널 이름: pipeline
apk 이름: test.apk
```

해당하는 배포 URL: `https://www.example.com/ext/test.apk?comment=pipeline`

해당 URL을 요청하면 CDN 엣지가 `pipeline` 채널 정보가 입력된 APK 패킷을 가져올 수 있습니다.







