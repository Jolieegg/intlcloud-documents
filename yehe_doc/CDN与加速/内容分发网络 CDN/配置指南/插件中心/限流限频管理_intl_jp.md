
## 機能の説明
トラフィック制限の制限管理は指定ドメイン名のエッジ合計帯域幅に速度制限閾値を設定し、閾値を超えるとトラフィック制限方式に応じて対応するトラフィックに一致した制限行動をとり、またはそのドメイン名の1秒あたりの被リクエスト頻度（QPS）に閾値を設定します。

## 適用ケース
1. 業務のニーズに応じて、時間帯を分けて業務のアクセストラフィックを制御します。
2. サイトがトラフィックの不正使用、またはCC、DDoS等の攻撃を受けた場合は、トラフィック制限の頻度制限を設定することによって悪意のあるトラフィックを効果的に制御し、高額の帯域幅のトラフィック請求を避けることができます。

## 設定ガイド
### ステップ1：トラフィック制限の制限管理をアクティブ化し、設定ページに進みます
[CDNコンソール](https://console.cloud.tencent.com/cdn)にログインし、メニュー欄内で**プラグインセンター**を選択し、トラフィック制限の制限管理の機能カードを見つけてクリックし、アクティブ化します。最初にアクティブ化してから、カード底部の**確認に移動**をクリックしてトラフィック制限の制限管理設定リストページに進みます。
![]()
![]()
![]()

### ステップ2：トラフィック制限設定の新規作成
![]()

####  2-1 有効なドメイン名の選択
設定は単一または複数のドメイン名で有効化され、ドロップダウンして対応する有効なドメイン名を選択することができます

####  2-2 トラフィック制限設定の作成
ドメイン名のエッジ合計帯域幅に速度制限閾値を設定します
- 有効時間帯
	1.  時間帯を制限せず、すべての時間でトラフィック制限設定を有効化します
	2.  指定の時間帯：毎日ある時間帯を指定して有効化します。例：12:00\- 24:00、23:00 \- 1:00
- トラフィック制限閾値：エッジ合計帯域幅がこの閾値を超えると設定したトラフィック制限方式に従って速度制限を行います。閾値の最小値は1024Mbps（1Gbps）です
- トラフィック制限方式：
	1. 区別なしの速度制限：閾値を超えると、設定した「制限速度」に応じて速度制限を行います。制限速度は最小100KB/sです
	2. 動的トラフィック制限：閾値を超えると、比率に応じて新しいリクエストを拒否し、エッジ合計帯域幅を再び閾値範囲内に維持し、新しいリクエストに429を返します
	3. PIDトラフィック制限：閾値を超えると、現在のグローバル帯域幅にPIDアルゴリズムを組み合わせてドメイン名下のアクセスするすべてのリソース（例えばURLパス）の速度制限を動的に計算し、最高速度制限閾値を超えないようにします

>?複数のトラフィック制限ポリシー：トラフィック制限の制限管理はトラフィック制限ポリシーを段階的に設定することができます。下にあるトラフィック制限ルールの閾値は上にある閾値より大きくしてください。

#### 2-3 頻度制限設定の作成
ドメイン名には1秒あたりにサポートする最大リクエスト数閾値が設定されています。閾値を超えると新しいリクエストを拒否すると同時に429を返します
- 頻度制限閾値：単位は回/秒で、閾値の範囲は100-5000000回/秒です
- 有効時間帯
	1.  時間帯を制限せず、すべての時間でトラフィック制限設定を有効化します
	2.  指定の時間帯：毎日ある時間帯を指定して有効化します。例：12:00\- 24:00、23:00 \- 1:00

### ステップ3：作成に成功したら、管理ページの管理ルールに進みます
ルールの作成に成功すると、ルールポリシーの設定状態がデフォルトで実行中になり、管理ページで次の操作を行うことができます
- オンまたはオフ：プラグイン機能がオンの状況で、実行中のルールはいつでもオフにでき、アクティブ化していないルールはいつでもオンにできます 
- 修正：有効なドメイン名またはトラフィック制限頻度の制限設定を修正することができます
- 削除：設定状態が「アクティブ化していない」ルールを削除することを許可します
![]()

>?ポリシーの有効時間：トラフィック制限の頻度制限ルールはグローバルポリシーに属し、ルールの配信は複数のエッジノードにデプロイする必要があるため、一定の遅延が存在します。初回の有効化時間は約10分で、その後の修正、ルールのオンオフの有効化時間は約5分です。安定した業務運営のためには、1つのルールに対して頻繁にオンオフの操作を行わないでください。

## 料金説明

トラフィック制限の頻度制限機能は現時点では料金はかかりません。
