CDN은 자가 진단 툴을 제공합니다. 특정 URL에 액세스 오류가 발생할 경우 툴을 이용해 자가 점검을 진행할 수 있으며, 자가 진단 과정에는 도메인에 연결된 DNS 리졸브 확인, 링크 품질 확인, 노드 상태 확인, 원본 서버 확인, 데이터 액세스 일관성 등 일련의 진단 항목이 포함되어 있어 문제를 진단하고 해결 방법을 제시합니다.

>! 진단하는 리소스 URL은 사용자 계정에서의 액세스 상태가 **활성화**된 도메인이어야 합니다. 진단 중 발생하는 대역폭은 과금 대역폭에 포함되므로 진단하는 타깃 리소스 크기는 200MBytes를 초과하지 않는 것을 권장합니다.



## 장애 진단
### 진단 프로세스

특정 리소스 URL에 액세스 오류가 발견되는 경우 **장애 진단**을 통해 점검을 요청할 수 있으며, 요청 순서는 다음과 같습니다.
1. [CDN 콘솔](https://console.cloud.tencent.com/cdn)에 로그인한 후 왼쪽 메뉴에서 [진단 툴]>[자가 진단 툴]을 선택합니다.
2. '장애 진단' 페이지에서 진단할 오류 발생 URL을 입력합니다. URL에는 `http://` 또는 `https://` 접두사를 입력해야 합니다.
 ![](https://main.qcloudimg.com/raw/0b5b89dee36676027aeb15a118b4584e.png)
3. URL 입력 후 [진단 링크 생성]을 클릭하면 페이지에 진단 링크 주소가 표시됩니다.
 ![](https://main.qcloudimg.com/raw/35e6dc6b335db10c63dc729cbe11ddbe.png)
4. 진단 링크를 클릭하면 진단 페이지가 새로 열리며, 진단 정보 수집을 시작합니다. 진단 중 점검 페이지를 닫지 마십시오. 진단이 완료된 후 해당 페이지를 수동으로 닫을 수 있습니다.
    ![](https://main.qcloudimg.com/raw/1e41c147e1e0ae216efc6635a43b1298.png)
5. 진단 링크를 다른 사람에게 발송하여 로컬 장애 점검을 진행할 수도 있습니다. 진단이 완료된 후에는 수동으로 브라우저 페이지를 닫아야 합니다.

>!
>- 모든 URL의 생성된 진단 링크의 유효 시간은 24시간이며, 최대 10번까지 클릭하여 장애를 진단할 수 있습니다.
>- '진단 보고서' 페이지에서 이미 생성된 사용 가능한 진단 링크를 다시 복사할 수 있습니다.

## 진단 보고서
### 보고서 조회
1. 진단이 완료된 후 [진단 보고서]를 클릭하여 페이지로 이동하면 생성된 진단 보고서를 확인할 수 있습니다. 진단 보고서는 테이블에 시간순으로 표시되며, 리스트가 차례대로 표시됩니다.
	- 진단 링크 URL 생성
	- URL의 해당 진단 리전
	- URL의 해당 진단 링크
	- 진단 링크 생성 시간
	- 진단 링크 유효 상태
	- 진단 링크를 사용해 진단할 수 있는 횟수

![](https://main.qcloudimg.com/raw/47c48777ace8428bb065695e1475600e.png)

2. 작업 열에서 [펼치기]를 클릭하면 각 진단으로 생성된 보고서 및 결과를 확인할 수 있습니다.
![](https://main.qcloudimg.com/raw/a439f2dbcadcb6d2790e846416717cea.png)
3. 각 단계에 따라 점검하고, 진단 보고서에 다음과 같이 전체적인 판정이 표시됩니다.
 - 정상
 - 오류
 - 진단 페이지가 오류로 닫힘(대부분 진단이 끝나기 전에 진단 페이지를 닫으면 발생)
4. 오른쪽 [보고서 보기]를 클릭하면 진단 상세 정보 및 오류 상황에 대한 처리 방법을 확인할 수 있습니다.

### 보고서 해석
1. 보고서 1부에는 다음과 같은 진단 정보가 표시됩니다.
 - 진단 보고서 ID
 - 진단할 URL
 - 진단 트리거 시간
![](https://main.qcloudimg.com/raw/a7b7c60533782c95927d4860491594fd.png)

2. 보고서 2부에는 진단 프로세스 및 모듈별 결과에 대한 개요가 표시되며, 직관적으로 오류 모듈을 확인할 수 있습니다. 다음과 같은 내용이 진단 모듈에 포함됩니다.
 - 클라이언트 정보 점검 결과
 - DNS 점검 결과
 - CNAME 점검 결과
 - 네트워크 링크 점검 결과
 - 액세스 노드 점검 결과
 - Origin-pull 노드 점검 결과
 - 원본 서버 점검 결과
![](https://main.qcloudimg.com/raw/1298a6d0b2e72b70ca202a03660b409f.png)

3. 보고서 3부에서는 진단 결과에 대한 상세 설명이 표시됩니다.
 #### 항목1: 클라이언트 정보
획득한 클라이언트 IP 정보, 해당하는 성/ISP, HTTP/HTTPS 요청 User-Agent, Referer, Request Method 등의 정보이며, 클라이언트 정보를 획득하지 못하는 경우 다음 점검을 진행할 수 없습니다.
![](https://main.qcloudimg.com/raw/8219224766176ed87ebb421330170f4a.png)

 #### 항목2: DNS 점검
클라이언트 로컬 DNS IP를 가져와 클라이언트 IP가 DNS IP 종속과 일치하는지 확인하고, 로컬 DNS 설정 오류로 인해 최적의 가속 노드로 스케쥴링할 수 없는 것인지 판단합니다.
![](https://main.qcloudimg.com/raw/4ab79b159c3e983cd6db7c1fefeae9ea.png)

 #### 항목3: CNAME 점검
점검할 도메인의 CNAME 설정을 가져옵니다. 도메인의 CNAME 리졸브에는 반드시 *.cdn.dnsv1.com(기본)의 도메인 확장명이 설정되어 있어야 하며, 그렇지 않을 경우 요청이 CDN 노드에 도달할 수 없습니다.
![](https://main.qcloudimg.com/raw/c3bbbb52440985415d9433b838dbde42.png)
>!CNAME 설정 점검을 통과하지 못해 요청이 노드에 도달하지 못하는 경우 다음 점검이 진행되지 않습니다.

 #### 항목4: 네트워크 링크 점검
클라이언트 로컬을 통해 다수의 인터넷 웹 사이트를 탐지하여 클라이언트 네트워크 상태를 가져옵니다. 로컬 프록시 등 설정으로 인해 웹 사이트에 액세스할 수 없는 경우, 네트워크 링크 탐지에 실패하여 다음 점검을 진행할 수 없습니다.
![](https://main.qcloudimg.com/raw/be249d3593b9956bf4e03393f02bb1d4.png)

 #### 항목5: 액세스 노드 감지
클라이언트에서 요청을 발송하면 도달하는 CND의 노드 IP, 노드 성/ISP, 노드에서 반환하는 상태 코드, 히트 상태, 리소스 MD5와 같은 노드 정보를 수집합니다.
 - 노드에 해당 리소스가 이미 캐시되어 있는 경우 직접 히트되어 Origin-pull 노드 점검을 진행하지 않습니다.
 - 노드에서 미스되는 경우 Origin-pull 노드 점검을 계속 진행합니다.
 - URL에서 피드백하는 상태 코드가 301, 302, 504인 경우 노드 점검 정보를 정상적으로 가져올 수 없어 다음 점검이 진행되지 않습니다.
 - 도메인에 액세스 제어 정책을 설정하여 액세스 노드에서 직접 403을 반환하는 경우 히트 상태가 **히트됨**이 됩니다.
![](https://main.qcloudimg.com/raw/cce938713c83879c50899efb71b9ea2e.png)

 #### 항목6: Origin-pull 노드 점검
 1. 리소스를 CDN 노드에서 직접 반환하고 액세스 노드와 Origin-pull 노드의 히트 상태가 **히트됨**인 경우, CDN은 원본 서버 반환 상태 코드 및 콘텐츠가 노드와 일치하는지 점검하기 위해 원본 서버 점검을 계속 진행합니다.
![](https://main.qcloudimg.com/raw/88ec7bc47877ef3c96b468a2a9c19a00.png)
 2. 리소스를 CDN 노드에서 직접 반환하지 않고 액세스 노드와 Origin-pull 노드 상태가 **미스**인 경우, 원본 서버에서 콘텐츠를 반환합니다.
![](https://main.qcloudimg.com/raw/ce8f450c620a6ed2b13de186a04b677b.png)
 3. 이때, 오류 상태 코드가 발생하는 경우 원본 서버 상태 코드, 파일 MD5, 액세스 노드 모듈이 반환하는 상태 코드, 파일 MD5를 비교하여 해당 오류가 CDN 노드에서 발생한 것인지, 원본 서버에서 발생한 것인지 판단해 수정할 수 있습니다.

>?진단 보고서로 문제가 해결되지 않으면 [티켓 제출](https://console.cloud.tencent.com/workorder/category)을 진행하거나 Tencent Cloud 기술자에게 문의하시기 바랍니다.

