![](https://qcloudimg.tencent-cloud.cn/raw/0ebdc0f0a97859cd5f41d425838a54ce.png)
## 準備作業

### CDNサービスのアクティブ化

CDNを設定する前に、[CDNサービスのアクティブ化](https://intl.cloud.tencent.com/document/product/228/32978)を行う必要があります。CDNサービスがすでにアクティブ化されている場合は、続いて次の操作手順に進んでください。

### 混同しやすい概念：


| 設定名          | 設定の説明                                                     | 使用する場所          |
| ----------------- | ------------------------------------------------------------ | ----------------- |
| アクセラレーションドメイン名          | お客様がCDNに接続するドメイン名で、ユーザーが端末で実際にアクセスするドメイン名です            | ドメイン名の追加-ドメイン名の設定 |
| オリジンサーバーアドレス/オリジンサーバードメイン名 | サーバーのオリジンサーバーに対応するIPアドレス（ドメイン名）です。CDNノードにリクエストされたコンテンツが含まれない場合、このアドレス（ドメイン名）にアクセスしてリクエストされたコンテンツを取得します<br /><br />**オリジンサーバー：**はサービスを提供するサーバーで、ユーザーのリクエストの処理、応答ができます。ユーザーは、オリジンサーバーアドレスを介してアクセスします。オリジンサーバーアドレスはドメイン名またはIPアドレスで構いません | ドメイン名の追加-オリジンサーバーの設定 |
| back-to-origin HOST         | CDNノードのback-to-originのときに実際にリクエストされたサーバーコンテンツです。通常、アクセラレーションドメイン名と同じであり、お客様はビジネスニーズに応じて、back-to-originのときに実際にリクエストされたコンテンツを入力することができます。                           | ドメイン名の追加-オリジンサーバーの設定 |
| CNAMEドメイン名        | お客様のアクセラレーションドメイン名を接続すると、システムは自動的にCNAMEドメイン名に拡張子`.cdn.dnsv1.com`または` .dsa.dnsv1.com`を割り当てます。<br />お客様のアクセラレーションドメイン名をCNAMEドメイン名にマッピングすると、Tencent CloudはCNAMEが指すIPアドレスを動的に変更し、すべてのアクセラレーションドメイン名を更新するので、各アクセラレーションドメイン名が指すIPアドレスを手動で変更する必要はありません。 | CNAMEの設定        |

- **アクセラレーションドメイン名：**ユーザーは「cdntest.com」を介してアクセスします。「cdntest.com」はアクセラレーションドメイン名です。
- **CNAMEドメイン名：**アクセラレーションドメイン名を接続すると、システムは自動的に拡張子が`.cdn.dnsv1.com`または`.dsa.dnsv1.com`のCNAMEドメイン名を割り当てます。`cdntest.com.cdn.dnsv1.com`/`cdntest.com.dsa.dnsv1.com`などです。
- **オリジンサーバーアドレス：**CDNノードが、ユーザーがリクエストしたコンテンツをキャッシュしない場合、CDNノードは1.1.1.1からのコンテンツをリクエストします。1.1.1.1とはオリジンサーバーアドレスです。
- **back-to-origin HOST：**CDNノードが1.1.1.1をリクエストしたときに、実際にリクエストされたアドレスが、エンドユーザーがリクエストした「cdntest.com」とは異なる「originhost.com」にしたい場合は、back-to-origin HOSTを「originhost.com」に設定します。この場合、エンドユーザーが「cdntest.com」を介してback-to-originを行うときに、「originhost.com」のコンテンツにアクセスします。通常、アクセラレーションドメイン名とback-to-origin HOSTドメイン名は同じですが、ビジネスニーズに応じて調整することができます。


## 操作手順

CDNコンソールに入り、左側ナビゲーションバーで**ドメイン名管理**を見つけて、**ドメイン名の追加**をクリックします。
![](https://main.qcloudimg.com/raw/020628a1fba4d8529bf3b5be7f459170.png)

ドメイン名の追加ページに進んだ後、ドメイン名の接続を完了するには、次の3つの部分を設定する必要があります。

- [ドメイン名設定](#m1)
- [オリジンサーバー設定](#m2)
- [サービス設定（オプション）](#m3)

[](id:m1)

### ドメイン名の設定

1. アクセラレーションリージョンの選択
2. アクセラレーションドメイン名の入力
   接続するドメイン名が次のような状況にある場合は、ドメイン名所有権の検証が必要です。検証手順については、以下の[ドメイン名所有検証](https://intl.cloud.tencent.com/document/product/228/42693)をご参照ください。
   - このドメイン名を初めて接続する。
   - このドメイン名が他のユーザーによって接続されている。
   - 接続するドメイン名が汎用ドメイン名である。
3. アクセラレーションタイプの選択
4. その他のオプション項目（後でドメイン名管理で変更できます）

<img src="https://main.qcloudimg.com/raw/6ec038f7f063b01cc1d68ecbfe4cb5c8.png" width="60%">



設定項目の詳細説明 

| 設定項目   | 説明                                                     |
| :------- | :----------------------------------------------------------- |
| アクセラレーションリージョン | 中国本土：グローバルユーザーからのアクセスは、中国本土のアクセラレーションノードにスケジューリングされてサービスを提供します。<br/>中国本土以外（中国香港・マカオ・台湾地区を含む）：グローバルユーザーからのアクセスは、中国本土以外のアクセラレーションノードにスケジューリングされてサービスを提供します。<br/>グローバル：グローバルユーザーからのアクセスは、最も近いノードにスケジューリングされてサービスを行います。<br><br>**注意事項：** <br>中国本土と中国本土以外のアクセラレーションサービスへの課金状況は異なります。[課金説明]（https://intl.cloud.tencent.com/document/product/228/2949）をご参照ください。|
| アクセラレーションドメイン名 | 1. ドメイン名の長さは81文字以内です。<br>2. 中国本土のドメイン名は工信部にてICP登録済みのものとします。<br>3.ドメイン名`a.test.com`、`a.b.test.com`などの形式のサブドメイン名または`*.test.com`、`*.a.test.com`形式の汎用ドメイン名とします。<br>4. アクセスするドメイン名が汎用ドメイン名である場合、または他のユーザーによってアクセスされている場合、または新しいドメイン名を初めてアクセスする場合は、[ドメイン名所有検証](https://intl.cloud.tencent.com/document/product/228/42693)を行う必要があります。<br><br>**注意事項：** <br>1. 汎用ドメイン名にアクセスした後、そのサブドメイン名または第2レベル汎用ドメイン名については、他のアカウントでのアクセスは現在サポートされていません。<br>2. `*.test.com`と`*.a.test.com`の同時アクセスは、現在サポートされていません。<br>　• 中国本土の中国語ドメイン名はまず中国語の形式で関連の登録を行う必要があります。　<br>　• 「中国語.ドメイン名」などの中国語ドメイン名は、サードパーティのツールで「xn--fiq228c.xn--eqrt2g」に変換した後、アクセスすることができます。　<br>　• 「test_qq.tencent.cloud」などのアンダーバーを含むドメイン名は、ホワイトリストへの登録が完了した後、直接追加することができます。<br>3. ドメイン名が悪意のあるドメイン名やハイリスクのドメイン名である場合は、アクセスできません。詳細については、 [使用制限](https://intl.cloud.tencent.com/document/product/228/32981)をご参照ください。 |
| アクセラレーションタイプ | Tencent Cloud CDNは、さまざまな業務タイプに応じてターゲットを絞ったアクセラレーションパフォーマンスの最適化を行いました。より良いアクセラレーション効果を得るために、ご自身の業務により近い業務タイプを選択することをお勧めします。<br><br>**CDN Content Delivery Network**<br>静的アクセラレーション：eコマース系、Webサイト系、ゲーム画像系といった小さなリソースアクセラレーションシナリオに適しています。<br>ダウンロードアクセラレーション：ゲームのインストールパッケージ、オーディオビデオソースファイルのダウンロード、携帯電話のファームウェアの配布といったシナリオのダウンロードに適しています。<br>ストリーミングメディアのオンデマンドアクセラレーション：eラーニング、オンライン動画オンデマンドなどのシナリオに適しています。<br><br>** Enterprise Content Delivery Network(ECDN)**<br>動的・静的アクセラレーション：さまざまなWebサイトのホームページなど、動的・静的データが組み合わされているビジネスシナリオに適しています。<br>動的アクセラレーション：アカウントログイン、注文取り引き、API呼び出し、リアルタイム照会などのシナリオに適しています。<br><br>**注意事項：** <br>アクセラレーションの種類によって課金基準が異なります。[CDN課金の詳細](https://intl.cloud.tencent.com/document/product/228/2949)と[ECDN課金の詳細](https://intl.cloud.tencent.com/document/product/570/37505)をご参照ください。 |
| IPv6アクセス | IPv6アクセススイッチはデフォルトで無効になっています。有効にすると、IPv6プロトコル経由でCDNノードにアクセスできるようになります。<br><br>**注意事項：**<br>• 一部のプラットフォームはアップグレード中であり、当面、IPv6アクセスの有効化はサポートしません。フルリリースまでしばらくお待ちください。<br>• 中国本土でのみIPv6アクセスをサポートしています。<br />ドメイン名のアクセラレーションリージョンがグローバルである場合は、IPv6アクセススイッチを有効にした後、中国本土でのみ有効になります。 |
| 所属プロジェクト      | プロジェクトは、Tencent Cloudのすべてのクラウドサービスの共有リソースセットの概念です。[プロジェクト管理](https://console.cloud.tencent.com/project)ページでプロジェクト関連の操作を実行できます。|
| タグ     | タグキーとタグ値は入力必須項目です。タグを作成していない場合は、[タグ管理](https://console.cloud.tencent.com/tag/taglist)でタグ関連の操作を実行できます。 |

[](id:m2)

### オリジンサーバーの設定

1. オリジンサーバータイプの選択
2. back-to-originプロトコルの選択
3. オリジンサーバーアドレスの入力
4. back-to-origin HOSTの設定

<img src="https://main.qcloudimg.com/raw/947c24efc846a11b25dca0f8ea552422.png" width="70%">

##### **設定項目の詳細説明：**

| 設定項目    | 説明                                                     |
| :-------- | :----------------------------------------------------------- |
| オリジンサーバータイプ  | ユーザー保有オリジンサーバー：<br>すでに安定して稼働しているビジネスサーバー（つまり、オリジンサーバー）のシナリオがあります。<br><br>[COSオリジンサーバー](https://intl.cloud.tencent.com/product/cos):<br>Tencent Cloud COSサービスを使用すると、対応するbucketを直接選択できます。<br><br>サードパーティCOS：<br>Tencent Cloud以外のサードパーティCOSです。現在サポートされているサードパーティは、AWS S3とAlibaba Cloud OSSです。<br><br>**注意事項**：<br>一部のプラットフォームは当面、サードパーティのCOSをサポートしません。フルリリースまでしばらくお待ちください。 |
| オリジンサーバーアドレス | ユーザー保有オリジンサーバー：<br/>1. 複数のIPをオリジンサーバーとして設定することをサポートし、back-to-originのときにポーリングback-to-originを実行します。<br/>2. 設定ポート(0～65535)と重み(1～100)の追加をサポートします。<br> **参照形式：**`オリジンサーバー:ポート:重み`（ポートはデフォルト設定可能：`オリジンサーバー::重み`）<br>**注：** HTTPSプロトコルのみポート443を一時的にサポートします。<br> 3.オリジンサーバーとしてドメイン名の設定をサポートします。このドメイン名は、CDNアクセラレーションドメイン名と同じにすることは**できない**のでご注意ください。<br>**注**：オリジンサーバーのアドレスがすでにアクセスされたCDNアクセラレーションドメイン名である場合、解決がループされ、back-to-originが正常にできなくなります。<br><br>COSオリジンサーバー：<br>1. Tencent Cloud COSのうち1つのバケットをオリジンサーバーとして選択します。<br>2. バケットの設定と実際のビジネスシナリオに応じて、デフォルトのドメイン名または静的ウェブサイトタイプを選択します。<br>3. バケットがプライベートバケットの場合は、CDNを承認し、back-to-originの認証を有効にして、 プライベートバケットへのアクセスを有効にしてください。<br/><br>サードパーティCOS：<br>1. リソースがサードパーティのCOSに保存されている場合は、オリジンサーバーとして有効なバケットアクセスアドレスを入力してください。現在サポートされているサードパーティは、AWS S3およびAlibaba Cloud OSSです。<br>**注**： プロトコルヘッダー`http://`または`http://`プロトコルヘッダー、`my-bucket.oss-cn-beijing.aliyuncs.com`または`my-bucket.s3.ap-east-1.amazonaws.com`を含めることはできません。<br>2. サードパーティのプライベートバケットにback-to-originするには、有効なキーを入力し、back-to-origin認証を有効にして、プライベートバケットへのアクセスを有効にする必要があります。 |
| back-to-originプロトコル  | ここでは、オリジンサーバーのサポート状況に基づいて、Tencent Cloud CDNノードのback-to-origin時のリクエストプロトコルを選択できます。<br>HTTP：ユーザーリクエストがHTTP/HTTPSアクセスの場合、HTTP back-to-originを使用します。<br><br>HTTPS：ユーザーリクエストがHTTP/HTTPSアクセスの場合、HTTPS back-to-originを使用します（オリジンサーバーはHTTPSアクセスをサポートする必要があります）。<br><br>Follow protocol：ユーザーリクエストがHTTPアクセスの場合、HTTP back-to-originを使用し、HTTPSアクセスにはHTTPS back-to-originを使用します（オリジンサーバーはHTTPSアクセスをサポートする必要があります）。 |
| back-to-origin Host | back-to-originドメイン名です。CDNノードがback-to-originのときにアクセスした、オリジンサーバーのIPアドレスの下にある具体的なサイトドメイン名のことです。<br><br>ユーザー保有オリジンサーバー：<br>デフォルトは現在のアクセラレーションドメイン名です。汎用ドメイン名にアクセスする場合、デフォルトは汎用ドメイン名であり、実際のback-to-origin HOSTはアクセスドメイン名です。実際の業務状況に応じて、ご自身で変更することができます。<br><br>COSソース：<br>デフォルトはバケットアクセスアドレスです。これはソースサイトアドレスと一致しており、変更できません。<br><br>サードパーティCOS：<br>デフォルトはバケットアクセスアドレスです。これはオリジンサーバーと一致しており、変更できません。|

[](id:m3)

### サービス設定（オプション）

Tencent Cloud CDNは、一般的に使用されるサービス設定を提供します。お客様は、個人的なニーズに応じて選択できます。現在、サービス設定を行う必要がない場合は、ドメイン名にアクセスしてからサービス設定を行うこともできます。

<img src="https://main.qcloudimg.com/raw/6e918f4e91d4c5249172589475f292a1.png" width="80%">

##### **設定項目の詳細説明：**

| 設定項目   | 説明                                                     |
| :------- | :----------------------------------------------------------- |
| パラメータ無視 | ノードがリソースをキャッシュするには、Key-Valueマッピングに従います。ここでのKeyはリソースURLです。<br> パラメータの無視を有効にすると、KeyはURLの「?」以降のパラメータを無視してマッピングします。<br> パラメータの無視を有効にしないと、Keyは完全なリソースURLになります。<br> 静的アクセラレーションタイプは、**デフォルトでは無効**になっており、ダウンロードおよびストリーミングメディアVODアクセラレーションタイプは、**デフォルトでは有効**になっています。|
| Back-to-Origin of Range | back-to-origin時にパート化するかどうかを設定します。有効化するにはオリジンサーバーがパート化をサポートしている必要があります。<br><br/>オリジンサーバータイプがCOSオリジンサーバーである場合、またはサービスタイプがダウンロード、ストリーミングメディアVODアクセラレーションである場合、Back-to-Origin of Rangeが**デフォルトで有効**になっています |
| キャッシュルール | ノードキャッシュの有効期限の設定のことです。静的アクセラレーションタイプの場合、通常の動的ファイル（php、jsp、asp、aspxなど）はデフォルトでキャッシュされず、その他すべてのファイルはデフォルトで30日間キャッシュされます。ダウンロードやストリーミングメディアVODアクセラレーションの場合、すべてのファイルのキャッシュ有効期限はデフォルトで30日です。<br><br>設定されたノードキャッシュの有効期限は最長有効期限であり、ノードのストレージリソースの影響を受けます。実際のキャッシュ時間は、状況に応じて決定されます。 |

## 設定の完了

ドメイン名追加操作を完了した後、ドメイン名の設定をネットワーク全体のノードに配信するには約5～10分かかります。しばらくお待ちください。
<img src="https://main.qcloudimg.com/raw/d5bcb556ac1b89946ec15642d3249676.png" width="80%">

## 後続作業

アクセスが完了した後、Tencent Cloud CDNは対応するCNAMEアドレスをアサインします。CDNサービスを有効にするには、まずCNAMEを設定する必要があります。詳細については、[CNAMEの設定](https://intl.cloud.tencent.com/document/product/228/3121)をご参照ください。
