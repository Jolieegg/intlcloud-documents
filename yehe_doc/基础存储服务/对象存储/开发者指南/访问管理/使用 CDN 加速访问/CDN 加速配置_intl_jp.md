## ユースケース

- レスポンス遅延およびダウンロード速度に対する要件が比較的厳しいケース。
- 地域、国、大陸を越えて数GBから数TBのデータを転送する必要があるケース。
- 同一のコンテンツを集中的に繰り返しダウンロードする必要があるケース。

>!ダウンロードリクエストがTencent Cloud VPC内（例えばTencent Cloud CVMを使用したバケットへのアクセスなど）の場合は、COSの標準ドメイン名をそのまま使用することをお勧めします。カスタムCDNアクセラレーションドメイン名を使用すると、ユーザーはパブリックネットワークを経由してCDNノードにアクセスしたことになり、CDN back-to-originトラフィック料金、CDNトラフィック料金などが追加で発生します。
>

## 関連説明

ドメイン名の定義、CDN back-to-origin認証およびCDN認証設定に関しては、[CDNアクセラレーションの概要](https://intl.cloud.tencent.com/document/product/436/18669)のドキュメントでご紹介しているため、ここには記載しません。

CDN back-to-origin認証、CDN認証設定はカスタムCDNアクセラレーションドメイン名およびCOSドメイン名のオリジンサーバーバケットへのアクセス方式に影響する場合があります。具体的には下表のとおりです。

| バケットへのアクセス権限       | CDN back-to-origin認証を有効にしているか | CDN認証設定を有効にしているか | カスタムCDNアクセラレーションドメイン名によって<br>オリジンサーバーにアクセス可能か | COSオリジンサーバードメイン名によって<br>オリジンサーバーにアクセス可能か | 適用ケース     |
| ------------------- | ------------ | ------------ | --------------- | --------------- | ------------ |
| パブリック読み取り              | 無効         | 無効         | アクセス可          | アクセス可          | 全サーバーパブリックアクセス |
| パブリック読み取り              | 有効         | 無効         | アクセス可          | アクセス可          | 非推奨       |
| パブリック読み取り              | 無効         | 有効         | URLを使用した認証が必要 | アクセス可          | 非推奨       |
| パブリック読み取り              | 有効         | 有効         | URLを使用した認証が必要 | アクセス可          | 非推奨       |
| プライベート読み取り+CDNサービス権限承認 | 有効         | 有効         | URLを使用した認証が必要 | COSを使用した認証が必要 | 全リンク保護   |
| プライベート読み取り+CDNサービス権限承認 | 無効         | 有効         | URLを使用した認証が必要       | COSを使用した認証が必要 | 非推奨       |
| プライベート読み取り+CDNサービス権限承認 | 有効         | 無効         | アクセス可          | COSを使用した認証が必要 | オリジンサーバー保護    |
| プライベート読み取り+CDNサービス権限承認 | 無効         | 無効         | アクセス不可        | COSを使用した認証が必要 | 非推奨       |
| プライベート読み取り              | 無効         | 有効または無効   | アクセス不可        | COSを使用した認証が必要 | CDN利用不可 |

>!上記の表中の**オリジンサーバー保護**のケースでは、CDN認証設定を有効にしていない場合、CDNエッジノードにキャッシュしたデータが悪意をもってプルされるおそれがあるため、同時にCDN認証設定を有効にすることでデータの安全性を保障するよう、強く推奨します。

## CDNアクセラレーションの設定


ユーザーはCOSコンソール上でバケットにカスタムドメイン名をバインドした後、カスタムドメイン名でCDNアクセラレーションを有効にし、最後にカスタムドメイン名によってバケットへのアクセスをアクセラレーションすることができます。カスタムドメイン名をバインドする際、ユーザーはご自身でカスタムドメイン名のサービスプロバイダにCNAME解決の追加を依頼する必要があります。

>! 現在COSでカスタムアクセラレーションドメイン名を使用している場合はCDNを有効にする必要があります。ご自身の状況に応じて判断してください。
1. ドメイン名で国内のCDNにアクセスするには、ICP登録が必要です。ただしICP登録はTencent Cloudを通じて行わなくてもよく、アクセスするドメイン名が確実にICP登録されていればアクセスできます。
2. ドメイン名で海外のCDNにアクセスする場合は、ICP登録の必要はありません。ただし、Tencent Cloud上で保存するデータおよび操作行為については、関係国の法律法令、ならびに[『Tencent Cloudサービス契約』](https://intl.cloud.tencent.com/document/product/301/12905)を遵守する必要があることに必ずご注意ください。

### 前提条件


1. ドメイン名を登録していること。Tencent Cloudの[ドメイン名登録](https://console.cloud.tencent.com/domain)またはその他のサービスプロバイダを通じてドメイン名を登録できます。
2. ドメイン名のICP登録を行っていること。ドメイン名で国内のCDNにアクセスするには、ドメイン名のICP登録を完了していることが必要です。

### 操作手順

>!カスタムドメイン名の追加およびCDNアクセラレーションの有効化は、COSコンソールとCDNコンソールのどちらでも行うことができます。CDNコンソールからカスタムドメイン名を追加したい場合は、 [ドメイン名へのアクセス](https://intl.cloud.tencent.com/document/product/228/5734)をご参照ください。

#### 1. バケットの選択
[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側ナビゲーションバーの**バケットリスト**をクリックし、CDNアクセラレーションを有効化したいバケットをクリックして、バケットに進みます。

#### 2. カスタムCDNアクセラレーションドメイン名の追加

**ドメイン名と伝送管理>カスタムCDNアクセラレーションドメイン名**をクリックし、**カスタムCDNアクセラレーションドメイン名**の設定項目で**ドメイン名の追加**をクリックし、設定可能な状態にします。
  - **ドメイン名**：バインド対象のカスタムドメイン名（例えば`www.example.com`）を入力します。入力するドメイン名はICP登録済みであること、およびDNSサービスプロバイダが対応するCNAMEを設定していることが必要です。詳細については、[CNAME設定](https://intl.cloud.tencent.com/document/product/228/3121)をご参照ください。アクセスするカスタムCDNアクセラレーションドメイン名が次に該当する場合は、ドメイン名所有権の検証を行う必要があります。詳細については、[ドメイン名所有権の検証](https://intl.cloud.tencent.com/document/product/228/42693)のドキュメントをご確認ください。
     - このドメイン名を初めて接続する
     - このドメイン名が他のユーザーによって接続されている
     - 接続するドメイン名が汎用ドメイン名である
  - **アクセラレーションリージョン**：中国本土、中国本土以外およびグローバルアクセラレーションをサポートしています。グローバルアクセラレーションとは、すべてのリージョン間でのバケットアクセラレーションをサポートすることを指します。
  - **オリジンサーバーのタイプ**：デフォルトでは**デフォルトオリジンサーバー**です。オリジンサーバーにしているバケットで静的ウェブサイトを有効にし、かつ静的ウェブサイトのアクセラレーションを行いたい場合は、オリジンサーバーのタイプを**静的ウェブサイトのオリジンサーバー**に設定することができます。具体的には、[CDNアクセラレーションの概要](https://intl.cloud.tencent.com/document/product/436/18669)をご参照ください。
  - **認証**：back-to-origin認証をオンにします。プライベート読み取りバケットに対しては、**back-to-origin認証を有効化**してオリジンサーバーを保護してください。
>!
>プライベート読み取りバケットに対して、back-to-origin認証とCDNサービス権限承認を同時に有効化した場合、CDNがオリジンサーバーへアクセスする際に署名を必要としないため、CDNキャッシュリソースがパブリックネットワーク配信を行い、データセキュリティに影響します。CDN認証を有効化することをお勧めします。
>
  - back-to-origin認証の有効化
back-to-origin認証は、CDNエッジノードのサービスIDを検証し、不正アクセスを阻止するために用いられます。具体的には次のとおりです。
     - パブリック読み取りバケット：CDNエッジノードに何の権限承認を行わなくても、バケットに直接アクセスできるため、back-to-origin認証を有効にする必要はありません。
     - プライベート読み取りバケット：CDNエッジノードはback-to-origin認証によるサービスIDの検証を受ける必要があり、検証に合格したCDNエッジノードのみがバケット内のオブジェクトにアクセスできます。**back-to-origin認証**の有効化を選択します。

**back-to-origin認証**を有効化した後、右側の**保存**をクリックし、約5分待つと、カスタムドメイン名の追加とCDNアクセラレーションのデプロイが完了します。
  - CDN認証の有効化
>!
>カスタムドメイン名でCDNアクセラレーションを有効化すると、このドメイン名によって誰でもオリジンサーバーに直接アクセスできるようになります。データに一定のプライバシーが存在する場合は、必ずCDN認証設定を有効にして、オリジンサーバーデータを保護してください。
>
カスタムドメイン名のデプロイが完了すると、CDN認証欄にCDN認証機能設定リンクが表示されます。**設定**をクリックすると、CDNコンソールに直接進んでCDN認証設定を行うことができます。具体的な操作方法については、[認証設定](https://intl.cloud.tencent.com/document/product/228/35237)をご参照ください。

  - **CDNキャッシュの自動更新**：有効化すると、COSバケットのファイル更新ルールをトリガーした際にCDNキャッシュを自動更新します。COSの関数の計算で設定できます。操作ガイドは[CDNキャッシュ更新の設定](https://intl.cloud.tencent.com/document/product/436/37273)をご参照ください。
  - **HTTPS証明書**：カスタムCDNアクセラレーションドメイン名に HTTPS証明書を追加する必要がある場合は、[CDNコンソール](https://console.cloud.tencent.com/cdn/certificate)で設定できます。


#### 3. ドメイン名の解決

カスタムドメイン名でCDNにアクセスすると、システムから自動的にCNAMEドメイン名（`.cdn.dnsv1.com`を拡張子とするもの）が割り当てられます。お客様はドメイン名サービスプロバイダにCNAME設定を完了するよう依頼する必要があります。具体的には[CNAME設定](https://intl.cloud.tencent.com/document/product/228/3121)をご参照ください。

>!CNAMEドメイン名には直接アクセスできません。



#### 4. 機能の無効化

上記の手順が完了すると、 カスタムドメイン名によってバケット内のリソースにアクセスできるようになります。カスタムCDNアクセラレーションを無効化したい場合は、次の方法で行うことができます。

カスタムCDNアクセラレーションドメイン名管理画面で、**編集**をクリックするとドメイン名のステータスを変更できます。ドメイン名のステータスを**オンライン**から**オフライン**に変更し、**保存**をクリックしてデプロイされるまで待ちます。約5分で機能が無効化されます。CDNコンソール上では対応するカスタムアクセラレーションドメイン名のステータスが**有効化済み**から**無効化済み**に変わります。

>!カスタムドメイン名を削除したい場合、カスタムドメイン名のステータスが**オンライン**の場合は、ドメイン名を直接削除することはできません。ステータスを必ず**オフライン**にしてからドメイン名を削除してください。無効化または削除の操作は[CDNコンソール](https://console.cloud.tencent.com/cdn)で行うことができます。詳細については、[ドメイン名の操作](https://intl.cloud.tencent.com/document/product/228/5736)をご参照ください。


