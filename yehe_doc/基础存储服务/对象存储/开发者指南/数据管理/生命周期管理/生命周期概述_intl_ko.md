## 개요

COS(Cloud Object Storage)는 객체 기반의 라이프사이클 구성을 지원합니다. 라이프사이클 규칙을 사용하여 해당 객체에 대해 수행할 작업을 정의할 수 있습니다.

>?버킷마다 최대 1,000개까지 라이프사이클 규칙을 추가할 수 있습니다.

## 사용 사례

### 로그 기록

라이프사이클이 구성되면 COS에 저장된 로그는 30일 후에 자동으로 보관되거나 2년 후에 삭제될 수 있습니다.

### 핫/콜드 데이터 티어링

핫 데이터는 업로드 후 짧은 시간 동안 자주 액세스하다가 일정 시간이 지나면 액세스가 거의 또는 전혀 이루어지지 않습니다. 따라서 30일 전에 업로드된 데이터는 STANDARD_IA 스토리지 클래스에, 60일 전에 업로드된 데이터는 ARCHIVE에 저장하도록 라이프사이클 규칙을 설정할 수 있습니다. 이 프로세스를 데이터 전환이라고 합니다.

### 아카이브 관리

파일 아카이브 관리에 COS를 사용하는 경우 금융, 의료 및 기타 산업의 컴플라이언스 요구 사항에 따라 파일의 모든 기존 버전을 장기간 저장해야 합니다. 이 경우 ARCHIVE 스토리지 클래스에서 파일의 기록 버전을 전환하고 저장하도록 라이프사이클을 구성할 수 있습니다.

## 구성 항목
라이프사이클 규칙을 생성하려면 다음 요소를 구성해야 합니다.

### 리소스
라이프사이클 실행 중에 히트할 데이터를 지정합니다. 범위 내에서 다루는 라이프사이클의 범위 및 데이터 유형을 사용자 정의할 수 있습니다. 라이프사이클 실행 중에 지정된 범위가 스캔되고 범위 내에서 구성된 데이터 유형에 대해 작업이 수행됩니다. 다음 규칙에 따라 범위를 지정할 수 있습니다.
- 접두사 지정: 디렉터리 이름 또는 파일 이름 접두사 매칭을 지원합니다.
- 태그 지정: 데이터를 태그로 필터링할 수 있습니다.

다음 데이터 유형을 구성할 수 있습니다.
- 현재 버전의 파일: 버킷의 최신 버전 객체입니다.
- 이전 버전의 파일: 버전 관리가 활성화된 후 저장된 이전 버전의 객체입니다. 버전 관리에 대한 자세한 내용은 [버전 제어 개요](https://intl.cloud.tencent.com/document/product/436/19883)를 참고하십시오.
- 삭제 마커: 객체가 삭제되었음을 나타내는 마커입니다. 라이프사이클 기능은 모든 기록 버전이 삭제된 후 마커를 자동으로 제거할 수 있습니다. 삭제 마커에 대한 자세한 내용은 [삭제 마커](https://intl.cloud.tencent.com/document/product/436/36716)를 참고하십시오.
- 조각 파일: 불완전한 멀티파트 업로드로 인해 생성된 조각입니다.


### 작업
객체가 히트될 때 수행할 작업:
- 데이터 전환: 지정된 기간 이후 객체를 STANDARD_IA, INTELLIGENT TIERING, ARCHIVE 또는 DEEP ARCHIVE로 전환합니다.
- 만료: 지정된 만료 시간이 지난 객체를 삭제합니다.


### 시간
상기 작업을 트리거하기 위한 시간 조건:
일 수 기준: 객체의 마지막 수정 날짜를 기준으로 객체에 정의된 작업을 수행할 시기를 지정할 수 있습니다.

## 사용 설명

>?라이프사이클 사용 방법은 [라이프사이클 설정](https://intl.cloud.tencent.com/document/product/436/17031)을 참고하십시오.

### 규칙 시간 설명

#### 파일 수정 시간
라이프사이클은 객체 수정 시간을 기반으로 트리거 규칙 실행을 지원합니다. [PUT Object](https://intl.cloud.tencent.com/document/product/436/7749), [PUT Object - Copy](https://intl.cloud.tencent.com/document/product/436/10881), [POST Object](https://intl.cloud.tencent.com/document/product/436/14690) 및 [Complete Multipart Upload](https://intl.cloud.tencent.com/document/product/436/7742) API와 같은 파일 쓰기 작업만 객체 수정 시간을 업데이트합니다. 라이프사이클을 기반으로 전환된 객체의 수정 시간은 업데이트되지 않습니다.

#### 실행 일수 설명
규칙에서 정한 일수는 24시간을 기준으로 하며, 24시간 미만은 1일로 계산하지 않습니다.

예를 들어 1일 오후 3시에 파일을 수정하고 1일 후에 삭제되는 라이프사이클 규칙을 설정한 경우, 라이프 사이클 작업은 2일 0시에 파일 스캔을 시작하여, 2일 0시를 기준으로 최종 수정 시간이 1일을 넘은 파일에 대한 삭제 작업을 실행합니다. 1일 당일 업로드한 파일은 최종 수정 시간을 기준으로 1일을 초과하지 않았기 때문에 3일 0시까지 기다려야만 기록을 스캔하고 삭제를 실행할 수 있습니다.

#### 최대 규칙 일수
라이프사이클은 최대 3650일까지 설정할 수 있습니다.

#### 적용 시간
라이프사이클의 적용은 매일 스캔과 실행 두 가지 작업으로 나뉩니다.
 - 스캔: COS는 현지 시간(GMT+8) 기준으로 매일 0시에 라이프사이클 규칙을 가져와 적용 범위 내의 모든 객체를 스캔합니다.
 - 실행: 스캔에서 규칙이 지정한 날짜에 해당하는 객체가 스캔되면, 전환 또는 삭제 작업을 실행합니다.

예를 들어, 사용자가 2023년 1월 20일에 규칙 A를 설정하여 test.txt 파일의 수정 시간을 기준으로 10일 후에 삭제하도록 지정했다면, 2023년 1월 21일 0시부터 test.txt 파일의 수정 시간을 매일 0시에 스캔합니다. 만약 해당 파일의 마지막 수정 시간이 2023년 1월 15일인 경우, 2023년 1월 26일 0시에 실행되는 스캔 작업에서 파일이 삭제 조건을 충족시켰다고 판단되면, 스캔이 완료되면서 삭제 작업을 실행합니다.

> ! 규칙 스캔과 실행 기간 중 규칙 상태를 변경하지 마십시오.. 변경하면 기존 규칙이 종료되어 전환 또는 삭제 작업이 올바르게 실행되지 않을 수 있습니다.


### 데이터 전환



#### 단방향 원칙
데이터 전환은 단방향(STANDARD > STANDARD_IA > ARCHIVE 또는 STANDARD > ARCHIVE)이며 역방향으로 수행할 수 없습니다. [PUT Object - Copy](https://intl.cloud.tencent.com/document/product/436/10881)(비 ARCHIVE/DEEP ARCHIVE 전용) 또는 [POST Object restore](https://intl.cloud.tencent.com/document/product/436/12633)(ARCHIVE 및 DEEP ARCHIVE 전용)만 호출하여 colder 스토리지 클래스에서 hotter 스토리지 클래스로 데이터를 복구할 수 있습니다.

#### 최종 일관성
동일한 객체 집합에 대해 여러 규칙이 구성되어 있고 서로 충돌하는 경우(만료 시 삭제 구성 제외) COS는 **객체를 coldest 스토리지 클래스로 전환**하는 규칙을 실행합니다.

예를 들어 규칙 A와 B가 각각 파일 수정 후 90일 후에 **객체를 STANDARD_IA로 전환** 및 **ARCHIVE로 전환**하도록 구성되어 있고 둘 다 동일한 객체 test.txt에 도달하면 규칙 B가 실행됩니다.

| 규칙 | 리소스 | 운영 | 시간 조건 | 실행 |
|----|----|----|----|----|
| 규칙 A | test.txt | 객체를 STANDARD_IA 클래스로 전환 | 파일 수정 후 90일 | 규칙 충돌로 인해 실행 실패 |
| 규칙 B | test.txt | 객체를 ARCHIVE 클래스로 전환 | 파일 수정 후 90일 | 실행 성공 |

>! 
>- COS에서 동일한 객체 세트에 대해 충돌하는 라이프사이클 규칙을 구성하지 않는 것이 좋습니다. 이로 인해 요금이 달라질 수 있습니다.
>- 객체를 전환해도 객체가 업로드되거나 수정된 시간은 변경되지 않습니다.
>

### 만료 삭제

#### 처리 로직
객체가 만료 시 지정된 삭제 라이프사이클 규칙과 일치하면 Tencent Cloud는 해당 객체를 비동기 삭제 큐에 추가합니다. 실제 삭제에는 약간의 지연이 있을 수 있습니다. GET 또는 HEAD 객체 작업을 수행하여 객체의 현재 상태를 가져올 수 있습니다.

#### 최종 일관성
같은 그룹에 속한 객체에 여러 규칙을 설정하고, 충돌 상황이 존재할 경우, COS는 최단 기간의 만료 시간을 기준으로 실행하고, **만료 삭제의 실행 효과는 전환 스토리지 유형보다 큽니다.**

예를 들어 규칙 C와 D가 각각 파일 수정 180일 후 **객체를 STANDARD_IA로 전환**하고 **객체를 삭제**하도록 구성되어 있고 둘 다 동일한 객체 test.txt에 도달하면 규칙 D가 실행됩니다.

| 규칙 | 리소스 | 운영 | 시간 조건 | 실행 |
|----|----|----|----|----|
| 규칙 C | test.txt | 객체를 STANDARD_IA 클래스로 전환 | 파일 수정 후 180일 | 규칙 충돌로 인해 실행 실패 |
| 규칙 D | test.txt | 객체 삭제 | 파일 수정 후 180일 | 실행 성공 |


>! COS에서 동일한 객체 세트에 대해 충돌하는 라이프사이클 규칙을 구성하지 않는 것이 좋습니다. 이로 인해 요금이 달라질 수 있습니다.
>


### 비용 참고

#### 수행 설명

 - 라이프사이클 기능이 삭제 작업을 수행하면 백엔드 삭제 요청이 생성됩니다. 전환 작업을 수행하면 백엔드 삭제 및 쓰기 요청이 생성됩니다. 상기 작업으로 생성된 요청은 요청 청구서에 포함됩니다. 예를 들어 라이프사이클을 통해 STANDARD 스토리지 클래스의 'test.txt' 파일을 STANDARD_IA로 전환하면 두 개의 요청이 생성됩니다. 하나는 STANDARD의 데이터를 삭제하는 데 사용되고 다른 하나는 STANDARD_IA의 데이터를 쓰는 데 사용됩니다.

 - 예외 상황이 발생하거나 버킷에 객체가 너무 많은 경우 라이프사이클 실행이 실패할 수 있습니다. 다른 이유로 인한 실패의 경우 GET 또는 HEAD Object 작업을 수행하여 현재 객체 상태를 가져옵니다.
 - Tencent Cloud는 라이프사이클 실행이 완료되지 않으면 정확한 청구서를 제공할 수 없습니다.

#### 기간 제한

 - STANDARD_IA/INTELLIGENT TIERING, ARCHIVE 및 DEEP ARCHIVE 스토리지 클래스의 최소 스토리지 기간은 각각 30일, 90일 및 180일입니다. 전환 또는 삭제 작업 자체에 대해 추가 스토리지 요금이 발생하지 않습니다. COS는 30/90/180일 미만의 라이프사이클 구성을 무시하고 요청 시 올바른 구성만 수행합니다.

 - 예를 들어 STANDARD_IA의 객체가 30일 이전에 전환되면 전환일부터 ARCHIVE 보관 요금이 발생하기 시작하고 30일까지 STANDARD_IA 보관 요금이 계속 부과됩니다. 또 다른 예는 보관된 객체가 90일 동안 저장되기 전에 만료 시 삭제되는 경우 90일까지 ARCHIVE 스토리지 요금이 계속 발생한다는 것입니다. DEEP ARCHIVE와 동일한 방식으로 작동합니다.

- #### 크기 제한
STANDARD_IA, ARCHIVE 및 DEEP ARCHIVE 스토리지 클래스에는 객체에 대한 최소 크기 제한이 있습니다. 예를 들어 64KB보다 작은 객체가 STANDARD_IA 스토리지 클래스에 업로드되면 64KB로 계산됩니다. 사용자 요금을 줄이기 위해 라이프사이클 실행은 64KB보다 작은 객체의 스토리지 클래스를 전환하지 않습니다. 

>? 라이프사이클은 64KB보다 작은 객체의 스토리지 클래스를 전환하지 않습니다.

