## 概要

バケットコピーはオブジェクトのある設定を対象とし、バケットコピールールを設定することで、異なるバケット間で自動的、非同期的に**増分オブジェクト**のコピーを行うことができるものです。バケットコピーを有効にすると、COS（Cloud Object Storage）はソースバケット内のオブジェクトの内容（オブジェクトメタデータやバージョンIDなど）をターゲットバケットに正確にコピーし、コピーされたオブジェクトレプリカは完全に一致する属性情報を有します。また、ソースバケット内でオブジェクトに対して行う操作（オブジェクトの追加、削除などの操作）もターゲットバケットにコピーされます。

>!
>- バケットのコピー機能を有効にするには、同時にソースバケットとターゲットバケットの両方でバージョン管理機能を有効にしておく必要があります。
>- バケットコピーを有効にする際は、データのコピー時にオブジェクトレプリカのストレージタイプを明確に指定した場合を除き、オブジェクトレプリカはソースオブジェクトと同じストレージタイプとなります。
>- COSはコピー時にソースバケットのアクセス制御リスト（ACL）をコピーします。現時点でCOSでは、異なる2つのアカウントのバケットをソースバケットとターゲットバケットとすることはできません。
>



## ユースケース

- **リモートディザスタリカバリ：**COSはオブジェクトデータに対し99.9999999999%の可用性をご提供していますが、戦争、自然災害などの様々な不可抗力要素によるデータ消失の可能性は存在します。データ消失に伴う損失が許容できないものであり、異なるバケットでデータレプリカを明示的に保全したい場合は、バケットコピーによってデータのリモートディザスタリカバリを実現できます。あるデータセンターが不可抗力要素によって破壊された場合でも、もう1つのバケットのデータセンターが使用可能なレプリカデータを提供することができます。
- **コンプライアンス要件：**COSはデフォルトでは物理ディスク内で、マルチレプリカおよびイレージャーコーディング方式でデータの可用性を保障していますが、業界によってはコンプライアンス要件が存在し、異なるバケット間でデータレプリカを保存するよう規定されている場合があります。このため、バケットコピーを有効にすることで、異なるバケットのデータコピーを実現し、これらのコンプライアンス要件を満たすことができます。
- **アクセス遅延の減少：**お客様の顧客が異なる地理的位置からオブジェクトにアクセスする際、バケットコピーによって、顧客の地理的位置に最も近いバケット内でオブジェクトレプリカを保全することで、顧客のアクセス遅延を最大限に短縮でき、製品体験の向上に役立てることができます。
- **操作上の理由：**2つの異なるバケットのどちらにもコンピューティングクラスターがあり、かつこれらのコンピューティングクラスターが同じデータセットを処理する必要がある場合は、バケットコピーによってこれらの異なるバケット内でオブジェクトレプリカを保全することができます。
- **データマイグレーションおよびバックアップ：**業務の発展による必要性に応じて、業務データをあるバケットから別のバケットにコピーすることで、データマイグレーションおよびデータバックアップを実現できます。

## 注意事項

#### コピー時間の制限

COSがオブジェクトのコピーに要する時間は、オブジェクトのサイズ、バケットのリージョン間の距離、オブジェクトのアップロード方式などの要素に左右されます。同期時間は上記の要素により異なり、数分間から数時間の幅があります。

- オブジェクトのサイズ。大きなオブジェクトのコピーにはより多くの時間が必要です。大きなオブジェクトについてはマルチパートアップロード方式を利用することで、オブジェクトのアップロードおよび同期時間を短縮することをお勧めします。
- バケットのリージョン間の距離。リージョン間の距離が遠いほど、同期の際にデータ転送時間がより長くかかります。
- オブジェクトのアップロード方式。シンプルアップロード方式は同時実行ができず、1本の接続上でデータをシリアルにアップロードまたはダウンロードするだけですが、マルチパートアップロード方式では同時実行が可能なため、大容量ファイルのアップロードの際はマルチパートアップロードを使用することで、アップロードおよびバケットコピーの速度を速めることができます。オブジェクトのアップロード方式に関する詳細な説明については、[シンプルアップロード](https://intl.cloud.tencent.com/document/product/436/14113)および[マルチパートアップロード](https://intl.cloud.tencent.com/document/product/436/14112)のドキュメントをご参照ください。

#### ライフサイクル関連

バケットコピーにあたってはユーザーがバージョン管理機能を有効にしておく必要があります。バージョン管理機能は、バケット内にオブジェクトの複数の過去のバージョンを存在させるもので、ストレージを比較的多く消費します。COSバケットコピーの過程ではデータリクエスト料金、ダウンストリームトラフィックコストおよびデータストレージコストを消費します。このうちデータストレージコストはターゲットバケットの所在リージョンのストレージコスト価格に従います。バケットコピーおよびバージョン管理によるコストを削減したい場合、またはデータの保存方法をカスタマイズしたい場合は、業務の背景を踏まえて、[ライフサイクルの管理](https://intl.cloud.tencent.com/document/product/436/17028)によってストレージコスト抑制またはデータ保存方法のカスタマイズを実現することができます。

- ターゲットバケット内のオブジェクトレプリカがソースバケット内と同様のライフサイクルルールに従うようにしたい場合は、ターゲットバケットにソースバケットと同一のライフサイクルルールを追加してください。
- ターゲットバケットにライフサイクルルールを設定する場合、バケットコピー後のオブジェクトレプリカの作成時間は、それがターゲットバケット内に生成された時間ではなく、ソースバケット内での作成時間に対応することに注意する必要があります。
- ソースバケットにライフサイクルルールを設定し、あるオブジェクトがバケットコピーを実行中に同時にライフサイクルルールによって削除される必要がある場合も、オブジェクトのバケットコピーは完了でき、ターゲットバケット内のオブジェクトレプリカも引き続き保存されます。

#### バージョン管理関連

バケットコピーの設定には、ユーザーがソースバケットとターゲットバケットの両方でバージョン管理機能を設定しておく必要があります。バージョン管理機能の詳細な内容については、[バージョン管理の概要](https://intl.cloud.tencent.com/document/product/436/19883)をご参照ください。バージョン管理をオンにした場合は、バージョン管理をオフにすることでバケットコピー機能に生じる影響に注意する必要があります。

- バケットコピー機能を有効にしているバケット内でバージョン管理を無効にすることを試してみると、COSはエラーを返し、「先にバケットコピールールを削除してからバージョン管理を無効にする必要があります」とのメッセージを表示します。
- あるターゲットバケット内でバージョン管理を無効にすることを試してみると、COSは、「バージョン管理をオフにするとバケットコピー機能に影響があります。バージョン管理を引き続きオフにする場合、このバケットをターゲットバケットとするCOSのバケットコピールールは失効します」とのメッセージを表示します。
