## 概要

Cloud Object Storage（COS）コンソール、APIは、バケットタグに基づいてバケットリストをフィルタリングする機能を提供しています。この機能はタグの権限を承認することで実装します。

## 権限承認の手順


1. ルートアカウントOwnerを使用して、[CAM] (https://console.cloud.tencent.com/cam/policy)コンソールにログインし、ポリシー設定ページに進みます。
2. 次の手順に従って、サブアカウントSubUserに、指定のタグを持つバケットへのアクセス権限を承認します。**ポリシージェネレーター**または**ポリシー構文**で実装できます。
<dx-tabs>
::: ポリシージェネレーターの承認
1. [CAM](https://console.cloud.tencent.com/cam/policy)のポリシー設定ページに進みます。
2. **カスタムポリシーの新規作成 > ポリシージェネレーターに従って作成**をクリックします。
3. 権限承認の設定ページに移動します。設定情報は以下のとおりです。
	- **効果**：許可を選択します。デフォルトは変わりません。
	- **サービス**：COSを選択します。
	- **アクション**：**読み取り操作 > GetService(バケットリストのプル)**を選択します。
	- **リソース**：**すべてのリソース**を選択します。
	- **条件**：**その他の条件を追加**をクリックします。サイドウィンドウで次の情報の設定を行います。
		- **条件キー**：`qcs:resource_tag`を選択します。
		- **演算子**：`string_equal`を選択します。
		- **条件値**：`key&val`形式でタグを入力し、keyをタグキーに、valueをタグ値にそれぞれ置き換えます。
4. **次のステップ**をクリックし、ポリシー名を入力します。
5. **完了**をクリックすれば、作成完了です。
:::
::: ユーザーポリシー構文の承認
1. [CAM](https://console.cloud.tencent.com/cam/policy)のポリシー設定ページに進みます。
2. **カスタムポリシーの新規作成 > ポリシー構文に従って作成**をクリックします。
3. 空白テンプレートによる作成を選択し、**次のステップ**をクリックします。
4. 次のポリシー形式に従って入力します。このうち、keyとvalueはそれぞれ指定のタグキーとタグ値に置き換えます。
```
{
    "version": "2.0",
    "statement":[
        {
            "effect": "allow",
            "action":[
                "name/cos:GetService"
            ],
            "resource": "*",
            "condition":{
                "for_any_value:string_equal":{
                    "qcs:resource_tag": [
                        "key&value"
                    ]
                }
            }
        }
    ]
}
```
5. **完了**をクリックすれば、作成完了です。
:::
</dx-tabs>
3. ポリシーをサブアカウントSubUserにバインドします。ポリシーページで、ステップ2で作成したポリシーを見つけ、右側の**ユーザー/グループ/ロールのバインド**をクリックします。
4. ポップアップウィンドウで、サブアカウントSubUserにチェックを入れ、**OK**をクリックすると、サブアカウントSubUserをそのポリシーにバインドできます。


## コンソールでの確認


1. サブアカウントSubUserで[COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. バケットリストページには、**このサブアカウントがアクセス権限を持つバケットのリストが自動的に表示されます**。

上記の手順によって、指定のタグ（key、value）を持つバケットへのアクセス権限がサブアカウントに承認されました。


## インターフェースの呼び出し


>!
> - コンソールと異なり、GetService APIインターフェースの呼び出しでは、サブアカウントがアクセス権限を持つバケットのリストは自動表示されません。タグパラメータを渡す必要があります。
> - 現在GetServiceインターフェースで渡すことができるタグは1つのみです。


1. サブアカウントSubUserのキーを使用してリクエストを送信します。
2. GetServiceインターフェースを呼び出し、(key,value)などのタグフィルタリングパラメータを渡します。リクエストの例は次のとおりです。詳細については[GET Service（List Buckets）](https://intl.cloud.tencent.com/document/product/436/8291)をご参照ください。

```
GET /?tagkey=key1&tagvalue=value1 HTTP/1.1
Date: Fri, 24 May 2019 11:59:51 GMT
Authorization: Auth String
```


