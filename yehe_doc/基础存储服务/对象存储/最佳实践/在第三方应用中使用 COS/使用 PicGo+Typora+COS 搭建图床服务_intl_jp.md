## 概要

画像ホスティングサービスは、画像ストレージ、画像加工処理、画像のネットワーク全体への配信などの機能を提供します。世界中に無数にあるブログウェブサイトおよびコミュニティフォーラムに対し、バックエンドでの画像サービスのサポートを提供します。開発者は、Tencent Cloudの**Cloud Object Storage（COS）**を使用し、画像ホスティングサービスを構築することができます。COSは、Tencent Cloudが提供する大量のファイルをストレージする分散型ストレージサービスです。これまでよりもさらに豊富な機能、優れた性能、信頼性の高い保障を提供します。

COSを画像ホスティングシーンに用いるメリットは、以下のとおりです。

- **低コスト：**ストレージ単価が低く、従量課金のため、使用した分のみのご請求となります。
- **速度制限無し：**アップロード、ダウンロードに速度制限がないため、長い時間をかけてloadingを待つ必要がありません。アクセス品質もさらに良くなりました。
- **高可用性：**高レベルのSLA可用性保障を有しています。ストレージのデータは99.9999999999%もの耐久性を保障します。
- **容量無制限：**ファイル分散型ストレージで、大量のファイルをサポートします。必要に応じた容量を使用します。


## 実践シーン

### シーン1：画像追加の際にCOSを使用し、画像ホスティングサービスを構築する

このシーンで使用するのは、以下のツールです。
- PicGo：複数のクラウドストレージ設定、クイック画像リンク作成をサポートするツールです。
- Typora：軽量級のMarkdownエディタです。複数の出力形式をサポートし、ローカルの画像をワンクリックで画像ホスティングへアップロードします。

### 操作手順

1. PicGoをインストールし、Tencent Cloud COSサービス関連のパラメータを設定します。
>?今回の実践で使用するのはPicGo 2.3.1バージョンです。その他のバージョンでは設定手順に若干の違いがあるため、適宜調整してください。
>
[PicGo公式サイト](https://molunerfinn.com/PicGo/) でPicGoをダウンロードしてからインストールし、画像ホスティングで**Tencent Cloud COS**を見つけ、以下の関連パラメータ項目を入力します。

  - COSバージョン：COS v5を選択します。
  - Secretldの設定：開発者は所有するプロジェクト身分識別IDを、身分認証に用います。[APIキー管理](https://console.cloud.tencent.com/capi)ページで作成し、取得することができます。
  - SecretKeyの設定：開発者は所有するプロジェクト身分キーを、[APIキー管理](https://console.cloud.tencent.com/capi)ページで取得することができます。  
  - Bucketの設定：バケットは、COSでデータをストレージするコンテナとして使用されます。バケットの詳細については、[バケット概要](https://intl.cloud.tencent.com/document/product/436/13312)ドキュメントをご参照ください。
  - AppIdの設定：開発者はCOSにアクセスする際に所有するユーザーの次元における唯一のリソース識別として、識別リソースを用います。[APIキー管理](https://console.cloud.tencent.com/capi)ページで取得することができます。
  - ストレージリージョンの設定：バケットの所属リージョンの情報です。列挙値については、[アベイラビリティリージョン](https://intl.cloud.tencent.com/document/product/436/6224)ドキュメントをご参照ください。例えばap-beijing、ap-hongkong、eu-frankfurtなどです。
  - ストレージパスの設定：画像をCOSバケットに格納する際のパスです。
  - カスタムドメイン名の設定：選択可能です。上方のストレージ容量にカスタムオリジンサーバードメイン名を設定する場合、入力が可能です。説明については[カスタムオリジンサーバードメイン名の有効化](https://intl.cloud.tencent.com/document/product/436/31507)をご参照ください。
  - URLサフィックスの設定：URLのサフィックスにCOSデータ処理パラメータを追加することで、画像の圧縮、トリミング、形式変換などの操作を行うことができます。関連の説明については[画像処理](https://www.tencentcloud.com/document/product/436/40118)をご参照ください。
2. typoraを設定します（オプション）。
>?編集ニーズがMarkdownシーンではない場合は、このステップを無視してかまいません。前のステップでインストールしたPicGoのみを画像ホスティングツールとして使用します。
>
設定ガイドは以下のとおりです。
 1. typora上の好みの設定の**画像**について、以下の設定を行います。

    - **画像挿入時**にて、**画像アップロード**を選択します。
    - **アップロードサービスの設定**にて、**PicGo(app)**を選択し、先ほどインストールしたPicGo.exeの場所を設定します。
 2. typoraを再起動し、設定を有効化します。
 3. typoraエディタエリアに移動し、直接画像をドラッグあるいはペーストすれば、画像がアップロードされ、COSファイルのリンクに自動で置き換えることができます。（ペースト後に、自動でCOSのリンクに置き換わらない場合は、PicGoのserver設定が開いているかどうかをチェックしてください）。



### シーン2：元の画像ホスティングリポジトリの画像を迅速にTencent Cloud COSに移行する

ある画像ホスティングサービスを例にすると、ローカル画像ホスティングフォルダを探すか、オンライン上から完全なフォルダをダウンロードして、フォルダ内のすべての画像をCOSバケットに保存することができます。最後にリンクドメイン名を統一して変換すれば、サイトを元に戻すことができます。

### 操作手順

#### ステップ1：画像ホスティングサービスの画像をダウンロードする

元の画像ホスティングウェブサイトにログインし、これまでのアップロード済み画像フォルダをダウンロードします。

#### ステップ2：COSバケットの作成およびリンク不正アクセス防止の設定

1.Tencent Cloudアカウントの登録をし、アクセス権限が**パブリック読み取り・プライベート書き込み**のバケットを作成します。操作ガイドは[バケットの作成](https://intl.cloud.tencent.com/document/product/436/13309)をご参照ください。
2.バケット作成後、バケットのリンク不正アクセス防止設定を開き、画像が不正使用されるのを防ぎます。操作ガイドは[リンク不正アクセス防止の設定](https://intl.cloud.tencent.com/document/product/436/13319)をご参照ください。

#### ステップ3：アップロードフォルダをバケットに保存

先ほど作成したバケットからアップロードフォルダをクリックし、先ほど準備した画像フォルダをCOSバケットにアップロードします。
>?画像数が多い場合は、[COSBrowserクライアント](https://intl.cloud.tencent.com/document/product/436/11366) を使用すれば、画像を迅速にアップロードできます。
>



#### ステップ4：リンクドメイン名のグローバルな自動置き換え

COSコンソールバケットの概要ページに、バケットデフォルトドメン名をコピーします（カスタムCDNアクセラレーションドメイン名のバインドでも可）。共通コードエディタを使用し、プロジェクトグローバル検索置き換えに対して失効したリンクプレフィックスをCOSバケットのデフォルトドメイン名にします。
>?デフォルトドメイン名については、[リージョンとアクセスドメイン名](https://intl.cloud.tencent.com/document/product/436/6224)をご参照ください。

- vscode検索置き換え事例：
![](https://qcloudimg.tencent-cloud.cn/raw/6d0707a821a6c7f0a978f113afdf05b9.png)

- sublime text検索置き換え事例：
![](https://qcloudimg.tencent-cloud.cn/raw/97855e83ce68cd23254c98f4849e2d41.png)






