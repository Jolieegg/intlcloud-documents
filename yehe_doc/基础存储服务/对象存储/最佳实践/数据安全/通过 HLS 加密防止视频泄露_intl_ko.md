## 개요

Cloud Object Storage(COS) 데이터 처리는 HTTP 라이브 스트리밍(HLS) 비디오에 대한 암호화 기능을 제공합니다. 액세스 권한이 없는 사용자는 암호화된 영상을 볼 수 없습니다. HLS 암호화는 KMS(키 관리 서비스) 및 Token 서비스와 함께 사용해야 합니다. 본 문서는 완전한 인증 및 KMS 세트를 구축할 수 있는 서비스에 적합한 솔루션을 안내합니다.

>! HLS 암호화만 지원합니다.
>

## 구현 원리

![](https://qcloudimg.tencent-cloud.cn/raw/fe49915c6d9de74677b6ef4f03ac5158.jpg)

>? 이 솔루션에서 COS는 KMS에 연결됩니다.
>

### 암호화 절차

1. COS에 동영상을 업로드하고 HLS 암호화를 요청합니다.
2. COS는 KMS에 암호화 키를 요청합니다.
3. COS는 트랜스 코딩을 통해 HLS 비디오를 암호화합니다.
4. 암호화 후 COS는 암호화된 동영상 파일을 CDN(Content Delivery Network)을 통해 전달합니다.

### 복호화 절차

1. 최종 사용자는 플레이어 터미널에 로그인하고 서비스 측에서 식별합니다. 신원 확인이 성공하면 서비스 측에서 플레이어 터미널에 Token을 할당하고 Token화된 재생 URL을 플레이어에게 반환합니다.
2. URL을 얻은 후 플레이어는 M3U8 파일의 URI를 구문 분석하고 URI에서 키를 요청합니다.
3. 리스크 관리 관리 서비스는 요청의 유효성을 확인한 다음 KMS API를 호출하여 키를 쿼리합니다.
4. KMS는 복호화 키를 플레이어 터미널에 반환합니다. 플레이어는 재생용 키를 사용하여 M3U8 파일을 해독합니다.

## 암호화 작업 순서

1. [COS 콘솔](https://console.cloud.tencent.com/cos5)에 로그인합니다.
2. 왼쪽 사이드바에서 **버킷 리스트**를 클릭하여 버킷 리스트 관리 페이지로 이동합니다.
3. 동영상을 저장할 버킷의 이름을 클릭합니다.
4. 왼쪽 사이드바에서 **데이터 처리 워크플로 > 공통 구성 > 템플릿** 탭을 선택하여 템플릿 구성 페이지로 이동합니다.
5. **오디오/비디오 트랜스 코딩**을 선택하고 **트랜스 코딩 템플릿 생성**을 클릭합니다.
6. 트랜스 코딩 템플릿 생성 창에서 다음 항목을 구성합니다.

 - 템플릿 이름: 최대 64자, 중국어, 영어, 숫자, 밑줄`_`, 하이픈`-`, 별표`*`를 포함할 수 있습니다.
 - 컨테이너 형식: HLS를 선택합니다.
 - 트랜스 코딩 지속 시간: 입력 파일 지속 시간 또는 사용자 지정 구성을 선택할 수 있습니다.
 - 고급 구성: 
    - 비디오 암호화: 활성화합니다.
    - UriKey: 사용자가 구축한 KMS URL입니다.
7. **확인**을 클릭하면 [Configuring Workflow](https://intl.cloud.tencent.com/document/product/436/46408) 또는 [작업 구성](https://intl.cloud.tencent.com/document/product/436/46409) 시 이 템플릿을 적용하여 동영상을 암호화할 수 있습니다.
