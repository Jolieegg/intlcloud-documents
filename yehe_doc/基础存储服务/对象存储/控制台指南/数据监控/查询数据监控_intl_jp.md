## 概要

Cloud Object Storage（COS）は、ストレージデータのモニタリング機能を提供します。COSのデータ統計のモニタリングデータウィンドウには、リクエスト数、トラフィック、リターンコード、読み取りデータなどのデータが表示されます。モニタリングデータウィンドウから、異なるストレージタイプのデータ量と傾向を時間帯別に照会することができます。次に、ルートアカウントまたはサブアカウントで、単一バケットのモニタリングデータを確認する方法についてご説明します。

>?ユーザーアカウントにストレージされているすべてのデータのサマリー情報を確認したい場合は、COSコンソールの[データモニタリング](https://console.cloud.tencent.com/cos5/monitor/overview)に移動すると確認できます。


## ルートアカウントから照会する場合の操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションバーで**バケットリスト**をクリックし、バケットリストページに進みます。
3. データ統計を行いたいバケットを見つけ、右側の**モニタリング**をクリックします。
もしくはデータ統計を行いたいバケットをクリックし、このバケットの詳細ページの左側ナビゲーションバーで**データ監視**をクリックすることもできます。
4. モニタリングデータページで、下図のような情報を確認します。
![](https://qcloudimg.tencent-cloud.cn/raw/87aaf4548bd730e774c7c784acca064a.png)
具体的なモニタリング項目の説明は次のとおりです。
 - Storage：さまざまなストレージタイプのストレージ使用量を照会できます。
 - オブジェクト数：バケット内に存在するオブジェクトの数です。オブジェクト数には、ファイルフラグメントの数も含まれます。
 - ファイルフラグメント数：バケット内に存在するファイルフラグメントの数です。オブジェクトのアップロード中に一時停止またはキャンセルされたファイルはフラグメントとなり、バケットにストレージされます。
>?
>- フォルダ内のオブジェクト数を確認したい場合は、[フォルダの詳細確認](https://intl.cloud.tencent.com/document/product/436/31633)のドキュメントをご参照ください。
>- バージョン管理機能を有効にした場合、同じ名前のオブジェクトのバージョン履歴はすべて独立した1つのオブジェクトとなり、オブジェクト数に計上されます。
>
 - リクエスト：総リクエスト数（Get総リクエスト数、Put総リクエスト数を含む）および標準、低頻度ストレージタイプのデータ読み取り/書き込みリクエスト数の照会をサポートします。
 - トラフィック：パブリックネットワークトラフィック、プライベートネットワークトラフィック、CDN back-to-originトラフィック/地域間コピートラフィック、パブリック・プライベートネットワークの総アップロードトラフィックの照会をサポートします。
 - リターンコード：2xx、3xx、4xx、5xxステータスコードの数と割合の照会をサポートします。
 - データ取得：低頻度データから取得した統計データの照会をサポートします。
>?
>- **現在のデータ**ページの**詳細メトリクス**では、ユーザーはさまざまな統計項目（ストレージ使用量、オブジェクト数、リクエスト数、トラフィックなど）に応じて、さまざまな時間間隔（今日、昨日、直近7日間、直近30日間、カスタム時間帯など）を選択して照会を行うことができます。
>- **今月の累計**ウィンドウでは、各ストレージタイプにおけるオブジェクトの今月の1日あたり平均ストレージ容量と総トラフィック（累計パブリックネットワークトラフィック、累計CDN back-to-originトラフィックおよび累計クロスリージョンレプリケーショントラフィック）を確認することができます。
>- ストレージの使用量とオブジェクトについては、2020年3月1日以降のデータの表示のみをサポートしています。より詳細なデータについては、[課金センター](https://console.cloud.tencent.com/expense/bill/dosageDownload)に移動して、対応する時間帯とエクスポートするデータを選択して表示してください。
>

## サブアカウントから照会する場合の操作手順

サブアカウントからモニタリングレポートを照会したい場合は、まずサブアカウントにモニタリングレポートを照会する権限を付与します。次に、コンソール経由でサブアカウントを使用すれば、モニタリングレポートを照会することができます。

**ポリシーテンプレート**または**アクセスポリシーのカスタマイズ**という方法で、サブアカウントにモニタリングレポートへのアクセス権限を付与することができます。


<a id="celie"></a>
### ポリシーテンプレートによる承認

1. ルートアカウントで[CAMコンソール](https://console.cloud.tencent.com/cam)にログインし、**ユーザー>ユーザーリスト**を選択して、ユーザーリストページに進みます。
2. 権限承認を行いたいサブアカウントを見つけ、右側操作バーの下にある**承認**をクリックします。

3. ポップアップしたウィンドウでQcloudMonitorFullAccessポリシーを検索してチェックを入れ、**OK**をクリックしてポリシーをサブアカウントに追加すると、そのサブアカウントを使用してモニタリングレポートを確認できるようになります。

>! ポリシーテンプレートは、CMにアクセスするための**すべての権限**を付与します。アカウントのセキュリティを確保する必要がある場合は、サブアカウントの読み取り権限のアクセスポリシーをカスタマイズ設定することができます。
>

### アクセスポリシーのカスタマイズによる承認

1. ルートアカウントを使用して[CAMコンソール](https://console.cloud.tencent.com/cam)にログインします。
2. 左側ナビゲーションバーで、**ポリシー > カスタムポリシーの新規作成 > ポリシー構文で作成**をクリックします。
3. 空白テンプレートを選択し、**次のステップ**をクリックします。

4. 下図のように、以下のポリシー構文を**ポリシー内容**入力ボックスに入力します。
業務上の必要性に応じて、ポリシー名を見つけやすい名前に変更することができます。
ポリシー構文：
```shell
{
    "version": "2.0",
    "statement":[
        {
            "effect": "allow",
            "action":[
                "monitor:GetMonitorData"
            ],
            "resource": "*"
        }
    ]
}
```
![](https://qcloudimg.tencent-cloud.cn/raw/36aeff8aa2093ebb7d267639a65c485b.png)
4. **ポリシーの作成**をクリックします。
ポリシーの作成に成功したら、サブアカウントに対してポリシーの権限を付与することができます。操作手順については、[ポリシーテンプレートから設定](#celie)をご参照ください。
