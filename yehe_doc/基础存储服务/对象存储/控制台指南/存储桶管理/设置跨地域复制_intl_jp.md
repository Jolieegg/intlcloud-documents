## 概要

クロスリージョンレプリケーション機能を有効にすると、ソースバケットの**インクリメンタルオブジェクト**を別のリージョンのターゲットバケットに自動的かつ非同期的にコピーすることができます。ソースバケット内のオブジェクトに対して管理操作（例えばオブジェクトの追加や削除など）を実行すると、COSは、これらの操作をターゲットバケットに自動的にコピーします。お客様は実際の必要性に応じて、クロスリージョンレプリケーションの有効または無効を選択できます。その他の情報については、[クロスリージョンレプリケーションの概要](https://intl.cloud.tencent.com/document/product/436/19237)をご参照ください。

##  前提条件

クロスリージョンレプリケーション機能を有効にする前に、ソースバケットとターゲットバケットの両方が**異なるリージョン**にあり、かつ、[バージョン管理の有効化](https://intl.cloud.tencent.com/document/product/436/19881)機能が有効になっていることを確認してください。


## クロスリージョンレプリケーションの有効化

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側ナビゲーションバーの【バケットリスト】をクリックし、クロスリージョンレプリケーションを設定したいソースバケットを選択してクリックし、バケットの詳細インターフェースに進みます。
   ![](https://main.qcloudimg.com/raw/e7262775af485aa2913b855d6064802d.png)
2. 左側の【障害復旧管理】>【クロスリージョンレプリケーション】をクリックし、下から【クロスリージョンレプリケーション】の管理項目を見つけて、【ルールの追加】をクリックし、クロスリージョンレプリケーションルールの設定ステータスに進みます。
   ![](https://main.qcloudimg.com/raw/910b0ddbe6f3bb0093544b5c21a07ca0.png)
3. クロスリージョンレプリケーションルールを設定するには、ソースバケットとターゲットバケットの両方のバージョン管理機能が有効になっている必要があります。ソースバケットとターゲットバケットのどちらもバージョン管理機能が有効でない場合、バージョン管理を有効にしてからクロスリージョンレプリケーションのルールを設定してください。ルールの設定が完了したら、【OK】をクリックすれば完了です。
	 ![](https://main.qcloudimg.com/raw/2a167db6422d4de507d3851d9965ab37.png)

設定項目の説明は次のとおりです。

- **ソースリージョン**：お客様のソースバケットが属するリージョンです。
- **適用範囲**：コピーしたいソースバケット内のオブジェクトの範囲です。設定されていない場合、バケット内のすべてのオブジェクトがデフォルトでコピーされます。プレフィックスが指定されている場合、特定のプレフィックスを持つコンテンツがコピーされます（例えば、`logs/`プレフィックスを持つファイルの場合、`logs/`を入力します）。
- **リソースパス**：お客様のソースバケットのパスです。
- **ターゲットバケット**：コピーされたオブジェクトを保存するバケットです。その所属リージョンは、ソースバケットのリージョンと同じにできません。現在のアカウント以外のバケットを選択することはサポートされていません。
- **ターゲットストレージタイプ**：ターゲットバケットにコピーされたオブジェクトのストレージタイプです。デフォルトでは、ソースバケット内のオブジェクトのタイプに追従します。他のストレージタイプを選択して、ターゲットバケットにコピーされたオブジェクトのタイプを変更することができます。現在、標準ストレージと低頻度ストレージの2種類をサポートしています。
- **削除マーカーの同期**：バージョン管理が有効な場合、バージョンIDを指定せずにファイルを削除すると、ソースバケットに削除マーカーが追加されます。削除マーカーの同期を選択した場合、クロスリージョンレプリケーションはこのタグをターゲットバケットにコピーします。削除マーカーの非同期を選択した場合、ターゲットバケットは削除マーカーを新たに追加しません。どちらの状況でも、ターゲットバケットは対応するファイルを削除せず、ユーザーはバージョンIDを指定してオブジェクトの過去バージョンにアクセスすることができます。バージョン管理と削除タグの詳細情報については、[バージョン管理の概要](https://intl.cloud.tencent.com/document/product/436/19883)のドキュメントをご参照ください。

>
> - ルールの設定が完了すると、ルールに対して管理操作を実行することができます。ボタンをクリックすると現在のルールを有効または無効にでき、編集ボタンをクリックすると現在のルールを変更することができます。
> - クロスリージョンレプリケーションルールを最初に設定したときに、適用範囲をバケットのすべての内容をコピーするように設定した場合、新しいルールを追加することはできません。現在のルールを編集するか、現在のルールを削除して再度追加することで変更することができます。
> - クロスリージョンレプリケーションルールを最初に設定したときに、適用範囲をいずれかの項目のプレフィックスの内容に設定した場合でも、現在のルールを編集することで、バケットのすべての内容に適用範囲を変更できます。

## クロスリージョンレプリケーションの無効化

クロスリージョンレプリケーション機能を無効化するには、ステータスボタンを無効にする、およびルールを削除するという2種類の方法があります。

- **ステータスボタンの無効化による方法**：いずれかのルールのステータスボタンを無効にして、現在のルールを一時的に使用禁止にします。この操作により、現在のクロスリージョンレプリケーション機能が一時停止され、コピーされたデータがターゲットバケット、ソースバケットに保持され、ソースバケットの増分データはターゲットバケットにコピーされなくなります。再度使用する場合は、有効化ボタンをクリックします。
- **ルールの削除**：【クロスリージョンレプリケーション】の管理項目で追加したルールを削除します。ルールを削除すると、設定したクロスリージョンレプリケーションルールは無効になり、コピーしたデータはターゲットバケットに保持され、ソースバケットの増分データのクロスリージョンレプリケーション操作は行われなくなります。再度使用する場合は、ルールを再度追加する必要があります。
  ![](https://main.qcloudimg.com/raw/f26250880b0f298531e66a49ccea8dc5.png)

>
> - 完了していないクロスリージョンレプリケーション操作は、クロスリージョンレプリケーションが無効になると中止され、続行できなくなります。
> - バケットに対してクロスリージョンレプリケーションを再度有効にすると、有効化が完了した後に追加されたオブジェクトに対してのみクロスリージョンレプリケーション操作が実行されます。
