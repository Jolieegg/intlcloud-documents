## 概要

ドメイン名で[Content Delivery Network（CDN）](https://intl.cloud.tencent.com/document/product/228/2939)にアクセスすると、すべてのユーザー側のリソースリクエストがCDNノードにディスパッチされて応答します。ノードがこのリソースをキャッシュしている場合は、コンテンツは直接返されます。どのCDNノードもこのリソースをキャッシュしていない場合は、リクエストはドメイン名が設定されたオリジンサーバーに透過的に送信され、必要なリソースをプルします。

CDNノードは大部分のユーザーリクエストに応答することから、クライアントがユーザーアクセスを分析しやすいよう、ネットワーク全体のアクセスログを1時間ごとの粒度でパッケージ化します。

CDNログのバックアップは、Tencent CloudのCloud Object Storage(COS)が[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583)をベースとしてユーザーに提供する、CDNログをCOSにダンプする機能です。ユーザーがCDNログをダンプすることを支援し、アクセス行為の分析やサービス品質のモニタリングなどを行いやすくします。

ユーザーが指定したバケットにログのバックアップルールを設定すると、SCFは所定の時間粒度に従ってCDNログを取得し、COSバケットにダンプします。

## 注意事項

- 以前にCOSコンソールでバケットにCDNログのバックアップルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成したCDNログバックアップ関数を確認できます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- COSへのCDNログのバックアップは、広州、上海、中国香港、北京、成都、シンガポール、ムンバイ、トロント、シリコンバレーなどのSCFがリリースされているすべてのリージョンでサポートされています。その他のサポートされているリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > データのバックアップ**をクリックし、**CDNログのバックアップ**を見つけます。
3. **バックアップルールの設定**をクリックし、ルール設定ページに進みます。
4. **関数の追加**をクリックします。
>! SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
>
5. ポップアップしたウィンドウで、以下の情報を設定します。
![](https://main.qcloudimg.com/raw/381a243bc2333c2a4dbd56f436826a33.png)
 - **関数名**：関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **関連バケット**：CDNログを格納するCOSバケットです。
 - **トリガーサイクル**：CDNログバックアップは、時限式トリガーでバックアップ・ダンプ操作をトリガーします。トリガーサイクルは、日次・カスタムサイクルに対応します。
 - **Cron表現**：トリガーサイクルがカスタムに設定されている場合、Cronを使用して具体的なトリガーサイクルルールを指定することができます。現在、Cronは現地標準時（Local Standard Time）で実行されています。設定ポリシーの詳細については、[Cron関連ドキュメント](https://intl.cloud.tencent.com/document/product/583/9708)をご参照ください。
 - **CDNドメイン名**：1つまたは複数の指定されたドメイン名のダンプを選択できます。
 - **配布パス**：ログファイルを配布するパスで、ルートディレクトリまたは指定されたパスのプレフィックスを選択できます。
 - **SCF権限承認**：CDNログのバックアップには、お客様のCDNサービスからログファイルを読み取り、お客様が指定したバケットにダンプするための権限承認が必要です。そのため、この権限承認を追加する必要があります。
6. 設定を追加して**確定**をクリックし、CDNログのバックアップルールが作成されるまで待ちます。作成が完了すると、リストページで作成したCDNログのバックアップルールを確認できます。
新規作成したCDNログのバックアップルールに対しては、次のような操作が可能です。
 - **ログ**をクリックして、CDNログのバックアップ履歴を確認します。バックアップでエラーが発生した場合は、**ログ**をクリックしてSCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
 - **その他 > 編集**をクリックして、CDNログのバックアップルールを変更します。
 - **その他 > 削除**をクリックして、使用しないCDNログのバックアップルールを削除します。
