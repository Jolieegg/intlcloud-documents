## 概要

複数ファイルのマージは、Tencent CloudのCloud Object Storage(COS)が[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583) をベースとしてユーザーに提供する、ファイルの内容をマージする機能です。ファイルの内容のマージ機能によって、COSにおける複数のファイルのバイナリーコンテンツを、指定された順序で完全に内容をマージし、新しいファイルを生成することができます。

ユーザーは、複数ファイルのマージルールをバケットに追加した後、マージされるファイルのURLsを指定し、SCF関数をトリガーしてファイルの内容をマージするアクションを実行し、マージされたファイルをバケット内の指定したパスに配布する必要があります。


## 注意事項

- マージされた新しいファイルは、50TB以下とします。
- この機能はバイナリーファイルのみをマージし、オーディオ・ビデオスプライシングやピクチャースプライシングには使用できません。
- 以前にCOSコンソールでバケットに複数ファイルのマージルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成した複数ファイルのマージ関数を確認できます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- 複数ファイルのマージは、広州、上海、北京、成都、中国香港、シンガポール、ムンバイ、トロント、シリコンバレーなどのSCFがリリースされているすべてのリージョンでサポートされています。その他のサポートされているリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。
- マージ中にエラーが報告された場合、作成した関数の右側にある**ログの確認**をクリックすると、SCFコンソールにジャンプし、ログエラーの詳細を確認することができます。
- アーカイブストレージとディープアーカイブストレージタイプは、マージをサポートしていません。このタイプのファイル内容をマージしたい場合は、あらかじめ復元してから行ってください。復元操作の詳細については、[アーカイブオブジェクトの復元](https://intl.cloud.tencent.com/document/product/436/30961)をご参照ください。
- COS複数ファイルのマージ機能は、SCFサービスに依存しており、ユーザーには[無料利用枠](https://intl.cloud.tencent.com/document/product/583/12282)が提供されていますが、無料利用枠を超える部分については、[SCF製品価格](https://intl.cloud.tencent.com/document/product/583/12281)に従って課金されます。複数ファイルのマージ機能を使用する場合、マージするファイルが多いほど、消費するリソースも多くなり、マージの回数が多いほど、消費する呼び出し回数も多くなります。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > 拡張機能**をクリックし、**複数ファイルのマージ**を見つけます。
3. **APIアクセスの設定**をクリックし、**複数ファイルのマージ**設定ページに進みます。
>! SCFをアクティブにしていない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
>
4. **関数の追加**をクリックし、ポップアップウィンドウに以下の情報を設定します。
 - **関数名**：関数名は、関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **実行構成**：この関数の実行方法を選択します。同期実行を選択した場合、マージタスクが実行された後に、この関数が応答し、実行結果を返します。非同期実行を選択した場合、この関数はダイレクトに応答し、バックグラウンドでマージタスクを実行しつづけます。
 ![img](https://qcloudimg.tencent-cloud.cn/raw/bebd7661688228c917c8e33e2eee2021.png)
 - **認証方式**：この関数の認証方式を選択します。
    - SCF認証を選択した場合、この関数を呼び出す権限を持つIDによって関数がトリガーされる必要があります。
    - 認証不要を選択した場合、リクエストを受信する適切なAPI Gatewayを選択する必要があります。 お客様のリージョンにAPI Gatewayがない場合、**API Gatewayサービスの新規作成**を選択してください。選択されたリージョンに、当社がその関数の要件を満たすAPI Gatewayを設定します。
 - **ゲートウェイサービス/APIパス/リクエストメソッド**：API Gatewayの設定に関する詳細な説明については、[API Gateway製品概要](https://intl.cloud.tencent.com/document/product/628/11755)をご参照ください。
 - **SCF承認**：ファイル内容をマージするには、SCFがバケットから対応するファイルを読み取り、マージされた新しいファイルを指定した場所にアップロードするための承認が必要です。SCFサービスを承認するには、このオプションにチェックを入れる必要があります。
5. 設定を追加し、**確定**をクリックしてしばらくすると、関数が追加されたことを確認できます。
![](https://qcloudimg.tencent-cloud.cn/raw/7da27a3179c3b061e9063eaa8265d0d6.png)
6. **ガイドを使用**をクリックして、この関数で設定する必要のあるパラメータフィールドの説明を確認します。そのうち本文のコンテンツパラメータは、json形式で渡されます。設定例については、[APIによる複数ファイルのマージ](https://intl.cloud.tencent.com/document/product/436/42533)をご参照ください。
![](https://qcloudimg.tencent-cloud.cn/raw/ce8b8c37806c09fff61a9d39f587e5fa.png)
7. **次のステップ**をクリックして、呼び出しテストページに進みます。
8. **クリックして呼び出す**をクリックすると、コンソールは前の手順で設定したパラメータに基づいて関数を呼び出します。**応答結果**で関数の応答結果を確認することができます。
![](https://qcloudimg.tencent-cloud.cn/raw/f0b9865f0fc56f17dcb6926d12fffd3a.png)
9. 新規作成した関数に対しては、次のような操作も可能です。
 - **ログ**をクリックして、複数ファイルのマージ関数の履歴を確認します。関数でエラーが発生した場合は、**ログ**をクリックしてSCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
 - **その他 > 編集**をクリックして、ファイルのマージルールを変更します。
 - **その他 > 削除**をクリックして、不要になったファイルのマージ関数を削除します。


