## 概要

ファイルハッシュ値の計算は、Tencent CloudのCloud Object Storage（COS）が[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583) をベースとしてユーザーに提供する、クラウドのファイル整合性チェックソリューションです。ファイルがCOSにアップロードされると、ハッシュ値が自動的に計算され、ファイルのカスタムヘッダーに追加されるため、ファイルの整合性を確認しやすくなります。

## 注意事項


- 以前にCOSコンソールでバケットにファイル名のハッシュ値の計算ルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成したハッシュ値の計算関数を確認できます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- ファイル名のハッシュ値の計算は、広州、上海、北京、成都、中国香港、シンガポール、ムンバイ、トロント、シリコンバレーなどのSCFがリリースされているすべてのリージョンでサポートされています。その他のサポートされているリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。
- ハッシュ値の計算中にエラーが報告された場合、作成した関数の右側にある**ログ**をクリックすると、SCFコンソールにジャンプし、ログエラーの詳細を確認することができます。
- アーカイブストレージとディープアーカイブストレージタイプは、ハッシュ値の計算をサポートしていません。このタイプのファイルのハッシュ値を計算したい場合は、あらかじめ復元してから行ってください。復元操作の詳細については、[アーカイブオブジェクトの復元](https://intl.cloud.tencent.com/document/product/436/30961)をご参照ください。
- COSファイルハッシュ値の計算機能は、SCFサービスに依存しており、ユーザーには[無料利用枠](https://intl.cloud.tencent.com/document/product/583/12282)が提供されていますが、無料利用枠を超える部分については、[SCF製品価格](https://intl.cloud.tencent.com/document/product/583/12281)に従って課金されます。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > 拡張機能**をクリックし、**ファイルハッシュ値の計算**を見つけます。
3. **ハッシュルールの設定**をクリックし、ルール設定ページに進みます。
>! SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
>
4. **関数の追加**をクリックし、ポップアップウィンドウに以下の情報を設定します。

 - **関数名**：関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **関連バケット**：ハッシュ値を計算するファイルが存在するCOSバケットです。
 - **イベントタイプ**：イベントとは、SCFをトリガーする操作のことです。アップロード操作を例に取ると、アップロード方法は、`PUT Object`インターフェースか`POST Object`インターフェースを呼び出して行います。選択したイベントが**Putメソッドによって作成**された場合、`PUT Object`インターフェースからアップロードされたファイルのみがハッシュ値の計算をトリガーします。
 - **トリガー条件**：ファイルアップロード時にSCFをトリガーする条件のことです。指定された範囲を選択した場合、ファイルが指定されたプレフィックスまたは拡張子にアップロードされたときにのみSCFをトリガーします。バケット全体を選択した場合、ファイルがバケットの任意の場所にアップロードされたときにトリガーされます。
 - **SCF承認**：ファイルハッシュ値を計算するには、SCFがバケットから対応するファイルを読み取り、計算されたハッシュ値の結果をファイルのカスタムヘッダーに追加するための承認が必要です。SCFサービスを承認するには、このオプションにチェックを入れる必要があります。
5. 設定を追加し、**確定**をクリックしてしばらくすると、関数が追加されたことを確認できます。
![img](https://qcloudimg.tencent-cloud.cn/raw/9c92852411105dbb48c41fcab36febd1.png)
新規作成した関数に対しては、次のような操作も可能です。
 - **ログ**をクリックして、ファイルハッシュ値の計算関数の履歴を確認します。関数でエラーが発生した場合は**ログ**をクリックしてSCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
 - **その他 > 編集**をクリックして、ファイルハッシュ値の計算ルールを変更します。
 - **その他 > 削除**をクリックして、不要になったファイルハッシュ値の計算関数を削除します。
