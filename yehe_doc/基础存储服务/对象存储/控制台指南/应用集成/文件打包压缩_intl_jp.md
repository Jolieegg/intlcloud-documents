## 概要

ZIP複数ファイルのパッケージ圧縮は、Tencent CloudのCloud Object Storage（COS）が[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583) をベースとしてユーザーに提供するデータ処理ソリューションです。ユーザーは、マルチファイルのパッケージ圧縮ルールをバケットに追加した後、パッケージ圧縮ファイルが必要なURLsを指定すると、SCF関数がトリガーされてパッケージ圧縮のアクションを実行し、最終的に圧縮されたパッケージがバケットの指定したパスに配布されます。


## 注意事項

- ZIP複数ファイルのパッケージ圧縮によって生成される最終的な圧縮パッケージは、50GB以下とします。
- 以前にCOSコンソールでバケットに複数のZIPファイルのパッケージ圧縮ルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成した複数のZIPファイルのパッケージ圧縮関数を確認することができます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- 複数のZIPファイルのパッケージ圧縮は、広州、上海、北京、成都、中国香港、シンガポール、ムンバイ、トロント、シリコンバレーなどのSCFがリリースされているすべてのリージョンでサポートされています。その他のサポートされているリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。
- パッケージ圧縮中にエラーが報告された場合、作成した関数の右側にある**ログの確認**をクリックすると、SCFコンソールにジャンプし、ログエラーの詳細を確認することができます。
- アーカイブストレージとディープアーカイブストレージタイプは、パッケージ圧縮をサポートしていません。このタイプのファイルオブジェクトをパッケージ圧縮したい場合は、あらかじめ復元してから行ってください。復元操作の詳細については、[アーカイブオブジェクトの復元](https://intl.cloud.tencent.com/document/product/436/30961)をご参照ください。
- COSパッケージ圧縮機能は、SCFサービスに依存しています。ユーザーには[無料利用枠](https://intl.cloud.tencent.com/document/product/583/12282)が提供されていますが、無料利用枠を超える部分については、[SCF製品価格](https://intl.cloud.tencent.com/document/product/583/12281)に従って課金されます。パッケージ圧縮機能を使用する場合、パッケージ化するファイルが多いほど、消費するリソースも多くなり、パッケージ圧縮の回数が多いほど、消費する呼び出し回数も多くなります。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > 拡張機能**をクリックし、 **ZIP複数ファイルパッケージ化**を見つけます。
3. **APIアクセスの設定**をクリックし、ページ設定に進みます。
>! SCFをアクティブにしていない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
>
4. **関数の追加**をクリックしてポップアップウィンドウに以下の情報を設定します。
 - **関数名**：関数名は、関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **実行構成**：この関数の実行方法を選択します。同期実行を選択した場合、圧縮タスクが実行された後に、この関数が応答し、実行結果を返します。非同期実行を選択した場合、この関数はダイレクトに応答し、バックグラウンドで圧縮タスクを実行しつづけます。
 - **認証方式**：この関数の認証方式を選択します。
    - SCF認証を選択した場合、この関数の呼び出し権限を持つIDによって関数がトリガーされる必要があります。

    - 認証不要を選択した場合、リクエストを受信する適切なAPI Gatewayを選択する必要があります。 ご自身のリージョンにAPI Gatewayがない場合、**API Gatewayサービスの新規作成**を選択してください。選択されたリージョンに、当社がその関数の要件を満たすAPI Gatewayを設定します。

 - **APIパス/リクエストメソッド**：API Gatewayの設定に関する詳細な説明については、[API Gateway製品概要](https://intl.cloud.tencent.com/document/product/628/11755)をご参照ください。
 - **SCF承認**：ファイルをパッケージ圧縮するには、SCFがバケットから対応するファイルを読み取り、パッケージ圧縮された圧縮パッケージを指定した場所にアップロードするための承認が必要です。SCFサービスを承認するには、このオプションにチェックを入れる必要があります。
5. 設定を追加し、**確定**をクリックしてしばらくすると、関数が追加されたことを確認できます。

6. **ガイドを使用**をクリックして、この関数で設定する必要のあるパラメータフィールドの説明を確認します。そのうちClientContextパラメータは、json形式で渡されます。設定例については、[APIによる複数ファイルのパッケージ圧縮](https://intl.cloud.tencent.com/document/product/436/41619)をご参照ください。

7. **次のステップ**をクリックして、呼び出しテストページに進みます。
8. **クリックして呼び出す**をクリックすると、コンソールは前の手順で設定したパラメータに基づいて関数を呼び出します。**応答結果**で関数の応答結果を確認することができます。

9. 新規作成した関数に対しては、次のような操作も可能です。
 - **ログ**をクリックして、パッケージ圧縮関数の履歴を確認します。関数でエラーが発生した場合は、この操作によって、SCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
 - **その他 > 編集**をクリックし、ファイルパッケージの圧縮ルールを変更します。
 - **その他 > 削除**をクリックして、不要になったファイルパッケージ圧縮関数を削除します。
