## 概要

ファイル名のフォーマットは、Tencent CloudのCloud Object Storage(COS)が[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583) をベースとしてユーザーに提供する、クラウドのファイルリネームソリューションです。ファイルがCOSにアップロードされると、命名ルールに従って自動的にファイルをリネームすることができます。既存のファイル名を置き換えるための変数プレースホルダーの使用もサポートしています。

## 注意事項

- 以前にCOSコンソールでバケットにファイル名のフォーマットルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成したファイル名のフォーマット関数を確認できます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- ファイル名のフォーマットは、広州、上海、北京、成都、中国香港、シンガポール、ムンバイ、トロント、ソウル、シリコンバレーなどのSCFがリリースされているすべてのリージョンでサポートされています。その他のサポートされているリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。
- リネーム中にエラーが発生した場合、作成した関数の右側にある**ログの確認**をクリックすると、SCFコンソールにジャンプし、ログエラーの詳細を確認することができます。
- アーカイブストレージとディープアーカイブストレージタイプは、ファイル名のフォーマットをサポートしていません。このタイプのファイルの名前をフォーマットしたい場合は、あらかじめ復元してから行ってください。復元操作の詳細については、[アーカイブオブジェクトの復元](https://intl.cloud.tencent.com/document/product/436/30961)をご参照ください。
- ファイル名のフォーマット機能は、SCFサービスに依存しており、ユーザーには[無料利用枠](https://intl.cloud.tencent.com/document/product/583/12282)が提供されていますが、無料利用枠を超える部分については、[SCF製品価格](https://intl.cloud.tencent.com/document/product/583/12281)に従って課金されます。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > 拡張機能**をクリックし、**ファイル名フォーマット**を見つけます。
3. **フォーマットルールの設定**をクリックし、ルール設定ページに進みます。
>! SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
>
4. **関数の追加**をクリックし、ポップアップウィンドウに以下の情報を設定します。

 - **関数名**：関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **関連バケット**：フォーマットされる名前のファイルがあるCOSバケットです。
 - **イベントタイプ**：イベントとは、SCFをトリガーする操作のことです。アップロード操作を例に取ると、アップロード方法は、`PUT Object`インターフェースか`POST Object`インターフェースを呼び出して行います。選択したイベントが**Putメソッドによって作成**された場合、`PUT Object`インターフェースを介してアップロードされたファイルのみがファイル名のフォーマットをトリガーします。
 - **トリガー条件**：ファイルアップロード時にSCFをトリガーする条件のことです。指定された範囲を選択した場合、ファイルが指定されたプレフィックスまたは拡張子にアップロードされたときにのみSCFをトリガーします。バケット全体を選択した場合、ファイルがバケットの任意の場所にアップロードされたときにトリガーされます。
 - **SCF承認**：ファイル名のフォーマットには、SCFがお客様のバケットから対応するファイルを読み取り、既存のファイル名を変更するための承認が必要です。SCFサービスを承認するには、このオプションにチェックを入れる必要があります。
5. 設定が完了したら、**次のステップ**をクリックして、フォーマットルールの設定に進みます。

 - **ターゲット名テンプレート**：テンプレートの名前をフォーマットしたい場合に、テンプレートパラメータとしてデフォルト変数の使用をサポートします。デフォルト変数の形式は`${変数名}`で、デフォルト変数は現在、以下のようにサポートされています。
<table>
	<tr><th>変数名</th><th>意味</th></tr>
	<tr><td>Bucket</td><td>先に設定した関連バケット名</td></tr>
	<tr><td>Region</td><td>関連バケットが配置されているリージョン</td></tr>
	<tr><td>Key</td><td>COS上のソースファイルのKey値です。例：abc/test.jpg</td></tr>
	<tr><td>InputName</td><td>ソースファイルのファイル名（拡張子なし）です。例：test</td></tr>
	<tr><td>InputNameAndExt</td><td>ソースファイルのファイル名（拡張子あり）です。例：est.jpg</td></tr>
	<tr><td>InputPath</td><td>ソースファイルが配置されているディレクトリです。例：test/</td></tr>
	<tr><td>Ext</td><td>ソースファイルの拡張子です。例：.jpg</br>注：この変数には、デフォルトで`.`が付いています。この変数をファイル名の拡張子として使用する場合、`.`を追加する必要はありません。</td></tr>
	<tr><td>Year</td><td>選択したタイムゾーンに従って、そのタイムゾーンの現在の年が示されます</td></tr>
	<tr><td>Month</td><td>選択したタイムゾーンに従って、そのタイムゾーンの現在の月が表示されます</td></tr>
	<tr><td>Day</td><td>選択したタイムゾーンに従って、そのタイムゾーンの現在の日にちが表示されます</td></tr>
	<tr><td>Hour</td><td>選択したタイムゾーンに従って、そのタイムゾーンの現在の時間が表示されます</td></tr>
	<tr><td>Minute</td><td>選択したタイムゾーンに従って、そのタイムゾーンの現在の分が表示されます</td></tr>
	<tr><td>Second</td><td>選択したタイムゾーンに従って、そのタイムゾーンの現在の秒が表示されます</td></tr>
	<tr><td>CRC64</td><td>ファイルのCRC64値</td></tr>
	<tr><td>MD5</td><td>ファイルのMD5値</td></tr>
	<tr><td>SHA1</td><td>ファイルのSHA1値</td></tr>
	<tr><td>SHA256</td><td>ファイルのSHA256値</td></tr>
</table>
 - **ソースファイルを削除するかどうか**：名前をフォーマットした後にソースファイルを削除するかどうかを選択できます。デフォルトは「いいえ」で、名前のフォーマット後は新しいファイルとしてバケットに保存されます。
 - **デフォルトタイムゾーン**：タイムゾーンを選択してください。ネームテンプレートのデフォルトタイム変数は、選択されたタイムゾーンに従って示されます。例えば、UTC+08:00を選択すると、デフォルトの時刻は、東8エリアの現在の年、月、日、時、分、秒になります。
 - **コールバックアドレス**：コールバックアドレスを追加することができます。各ファイル名のフォーマットが完了すると、システムは、https://www.callback.comなど、このアドレスにコールバック通知を送信します。
6. 設定を追加し、**確定**をクリックしてしばらくすると、関数が追加されたことを確認できます。

新規作成した関数に対しては、次のような操作が可能です。
 - **ログ**をクリックして、SCFコンソールにすばやくジャンプし、ログエラーの詳細を確認します。
 - **詳細**をクリックして、設定したフォーマット済みの名前関数ルールの詳細を確認します。
 - **その他 > 編集**をクリックして、ファイル名のフォーマットルールを変更します。
 - **その他 > 削除**をクリックして、不要になったファイル名のフォーマット関数を削除します。
