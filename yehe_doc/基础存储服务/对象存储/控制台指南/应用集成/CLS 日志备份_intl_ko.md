## 소개

CLS 로그 백업은 Tencent Cloud COS가 [Serverless Cloud Function](https://www.tencentcloud.com/document/product/583)을 기반으로 제공하는 기능으로, 사용자가 Cloud Log Service(CLS) 로그를 COS에 저장할 수 있도록 합니다.

사용자가 지정 버킷에 로그 백업 규칙을 설정하면 SCF가 일정 시간 간격으로 CLS 로그를 획득하여 COS 버킷에 저장합니다.

CLS 로그 백업은 제품 생태계 다운 플로우를 통해 로그 데이터를 COS에 전송하여 로그 백업 시나리오 니즈를 충족시키고, 로그 데이터의 가치를 발굴합니다. 로그 백업은 비동기화 과정으로, 로그 데이터가 생성되면, SCF가 트리거를 통해 자동으로 데이터를 COS에 백업하여 저장합니다.



## 주의 사항

- COS 콘솔에서 버킷에 CLS 로그 백업 규칙을 추가한 적이 있는 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 기존에 생성한 CLS 로그 백업 함수를 볼 수 있습니다. 해당 함수를 삭제하지 **마십시오.** 삭제할 경우 규칙이 적용되지 않을 수 있습니다.
- 광저우, 상하이, 베이징, 중국 홍콩, 청두, 싱가포르, 뭄바이, 토론토, 실리콘밸리 등 SCF를 런칭한 리전은 CLS 로그의 COS 백업을 지원합니다. 지원 리전에 대한 자세한 내용은 [SCF 제품 문서](https://www.tencentcloud.com/document/product/583)를 참고하십시오.

## 작업 단계

1. [COS 콘솔](https://console.cloud.tencent.com/cos5)에 로그인합니다.
2. 왼쪽 사이드바에서 **애플리케이션 통합 > 데이터 백업**을 클릭하고 **CLS 로그 백업**을 찾습니다.
3. **백업 규칙 설정**을 클릭하여 규칙 설정 페이지로 이동합니다.
4. **함수 추가**를 클릭합니다.
>! SCF 서비스가 활성화되지 않은 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf)에서 SCF 서비스를 활성화하고 안내에 따라 서비스 권한 부여를 완료하십시오.
>
5. 팝업 창에서 다음과 같이 정보를 설정합니다.

	- **함수 이름**: 함수의 고유 식별자로, 생성 후에는 수정할 수 없습니다. [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 해당 함수를 조회할 수 있습니다.
	- **연결 버킷**: CLS 로그 파일을 저장할 COS 버킷입니다.
	- **로그셋**: [로그셋](https://intl.cloud.tencent.com/document/product/614/32849) 은 CLS의 프로젝트 관리 단위로, 서로 다른 프로젝트의 로그를 구분하기 위해 사용됩니다. 메시지 소스의 로그셋을 선택할 수 있으며, 해당 로그셋은 반드시 함수가 있는 리전에 위치해야 합니다.
	- **로그 토픽**: 로그 토픽(Topic)은 CLS의 기본 관리 단위로, CLS 트리거를 관리 및 설정하는 최소 단위입니다. 한 로그셋에 여러 개의 로그 토픽이 포함될 수 있습니다. 메시지 소스의 로그 토픽을 선택할 수 있습니다.
	- **최대 대기 시간**: 대기 시간 설정을 통해 로그 획득 빈도를 컨트롤 할 수 있으며, 3 - 300초 사이로 설정 가능합니다. 만약 최대 대기 시간인 300초로 설정하였을 경우, SCF는 300초 이내의 로그 데이터를 수집하고, 로그 파일로 패키징하여 백업합니다.
	- **SCF 라이선스**: CLS 로그 백업은 SCF에 권한을 부여하여 CLS 서비스를 이용할 때 로그 파일을 읽고 지정 버킷에 저장하므로 해당 라이선스 추가가 필요합니다.
6. **다음 단계**를 클릭하여 다음 정보를 설정합니다.

	- **압축 설정**: 로그를 압축한 후 백업할 것인지 선택합니다. 압축 후 용량은 최대 128KB까지 지원합니다. 현재 지원되는 압축 형식은 gzip, lzop, snappy입니다.
	- **파티션 형식**: strftime 구문에 따라 디렉터리를 자동으로 생성합니다. 예: 파티션 형식이 `%Y/%m/%d/%Y%m%d%H%M`인 경우, 2021/06/25/202106252232 디렉터리가 생성됩니다.
	- **디렉터리 접두사**: 로그 백업 경로, 루트 디렉터리 또는 지정된 경로 접두사에 백업할 수 있습니다.
	- **전달 파일 예시**: 최종 백업된 파일명 형식은 `{COS 버킷}{디렉터리 접두사}{파티션 형식}_{random}.{type}`입니다.
7. 설정을 추가하고 **확인**을 클릭한 후 CLS 로그 백업 규칙이 생성될 때까지 기다립니다. 생성이 완료되면 리스트에서 이미 생성된 CLS 로그 백업 규칙을 조회할 수 있습니다.

   새로 생성한 CLS 로그 백업 규칙에 다음과 같은 작업을 진행할 수 있습니다.
	- **로그**를 클릭해 CLS 로그 백업 기록을 조회합니다. 백업 시 오류가 보고된 경우 **로그**를 클릭하고 빠르게 SCF 콘솔에 리디렉션하여 로그 오류 상세 내용을 조회할 수 있습니다.
	- **더 보기 > 편집**을 클릭하여 CLS 로그 백업 규칙을 수정합니다.
	- **더 보기 > 삭제**를 클릭하여 사용하지 않는 CLS 로그 백업 규칙을 삭제합니다.
