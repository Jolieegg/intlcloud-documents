## 소개

Ckafka 메시지 백업은 Tencent Cloud COS가 [Serverless Cloud Function(SCF)](https://www.tencentcloud.com/document/product/583)을 기반으로 제공하는 기능으로, Ckafka 메시지를 COS에 저장합니다. Ckafka 메시지를 저장하면 편리하게 데이터 분석 및 다운로드 등의 작업을 진행할 수 있습니다.

Ckafka는 오픈 소스인 Apache Kafka 메시지 큐 엔진을 기반으로, 처리 성능이 뛰어나고 확장성이 높은 메시지 큐 서비스를 제공합니다. 자세한 내용은 [Ckafka 제품 개요](https://intl.cloud.tencent.com/document/product/597/10066)를 참고하십시오.

버킷에 백업 함수 규칙을 설정하면, CKafka 인스턴스에 메시지가 발생할 때 SCF가 일정 시간 간격으로 메시지를 획득하고 COS 버킷에 저장합니다.

## 주의 사항

- COS 콘솔에서 버킷에 Ckafka 메시지 백업 규칙을 추가한 적이 있는 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 기존에 생성한 Ckafka 메시지 백업 함수를 확인할 수 있습니다. 이 함수를 삭제하지 **마십시오.** 삭제할 경우 규칙이 적용되지 않을 수 있습니다.
- 광저우, 상하이, 중국홍콩, 베이징, 청두, 싱가포르, 뭄바이, 토론토, 실리콘밸리 등 SCF를 런칭한 리전은 Ckafka 메시지 백업을 지원합니다. 지원 리전에 대한 자세한 내용은 [SCF 제품 문서](https://www.tencentcloud.com/document/product/583)를 참고하십시오.

## 작업 단계

1. [COS 콘솔](https://console.cloud.tencent.com/cos5)에 로그인합니다.
2. 왼쪽 사이드바에서 **애플리케이션 통합 > 데이터 백업**을 클릭하고 **Ckafka 메시지 백업**을 찾습니다.
3. **백업 규칙 설정**을 클릭하여 규칙 설정 페이지로 이동합니다.
4. **함수 추가**를 클릭합니다.
>! SCF 서비스가 활성화되지 않은 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf)에서 SCF 서비스를 활성화하고 안내에 따라 서비스 권한 부여를 완료하십시오.
>
5. 팝업 창에서 다음과 같이 정보를 설정합니다.

 - **함수 이름**: 함수의 고유 식별자로, 생성 후에는 수정할 수 없습니다. [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 해당 함수를 조회할 수 있습니다.
 - **연결 버킷**: Ckafka 메시지를 저장할 COS 버킷입니다.
 - **시간 간격**: 메시지 양에 따라 메시지를 취합할 시간 간격을 선택하며, 시간 간격은 5~15분으로 설정할 수 있습니다. 저장 성능의 보장을 위해 취합할 파일 수는 Partition 수 및 partition_max의 설정 값과 연관되어 있습니다. Partition에 대한 자세한 내용은 [파티션](https://intl.cloud.tencent.com/document/product/597/32275)을 참고하십시오.
 - **SCF 라이선스**: CKafka 메시지 백업은 Ckafka 서비스에서 관련 인스턴스 메시지를 읽고 메시지를 지정한 버킷에 저장할 수 있는 SCF 라이선스가 필요합니다. 따라서 해당 라이선스를 추가해야 합니다.
6. **다음 단계**를 클릭하여 Ckafka를 설정합니다. 설정 항목에 관한 설명은 다음과 같습니다.

 - **인스턴스 선택**: 메시지 소스의 Ckafka 인스턴스를 선택합니다. 리전 내 Ckafka 인스턴스만 지원합니다.
 - **제목 선택**: 메시지 소스의 제목을 선택합니다.
 - **시작 위치**: 메시지 덤프 백업 시 이전 메시지 처리 방식은 topic offset으로 설정합니다.
 - **액세스 주소**: 반드시 VPC 내부 네트워크의 액세스 주소여야 하며, 기본 네트워크의 CKafka 인스턴스의 경우 라우팅 정책을 추가해 주십시오. 자세한 사항은 [라우팅 정책 추가](https://intl.cloud.tencent.com/document/product/597/32555)를 참고하십시오.
>! 해당 VPC 서브넷에는 가용 IP가 있어야 하며, DHCP를 지원해야 합니다.
>
7. **다음 단계**를 클릭하여 설정을 전송합니다. 설정 항목에 대한 설명은 다음과 같습니다.

**전송 경로**: 백업 파일의 전송 경로 접두사로, 입력하지 않은 경우 기본적으로 버킷의 루트 경로에 저장되며, 접두사를 지정하는 경우 반드시 슬래시 /로 끝나야 합니다.
8. 설정을 추가한 후 **확인**을 클릭하면 추가된 함수를 확인할 수 있습니다.
새로 생성한 함수에 다음과 같은 작업을 진행할 수 있습니다.
 - **로그**를 클릭해 Ckafka 메시지 백업 기록을 조회합니다. 백업 시 오류가 보고된 경우 **로그**를 클릭하고 빠르게 SCF 콘솔에 리디렉션하여 로그 오류 상세 내용을 조회할 수 있습니다.
 - **더 보기 > 편집**을 클릭하여 Ckafka 메시지 백업 규칙을 수정합니다.
 - **더 보기 > 삭제**를 클릭하여 사용하지 않는 Ckafka 메시지 백업 규칙을 삭제합니다.

