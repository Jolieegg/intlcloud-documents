## 概要

CLSログのバックアップは、Tencent CloudのCloud Object Storage(COS)が[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583) をベースとしてユーザーに提供する、ログサービス（Cloud Log Service）のログをCOSにダンプする機能です。

ユーザーが指定したバケットにログのバックアップルールを設定すると、SCFは所定の時間粒度に従ってCLSログを取得し、COSバケットにダンプします。

CLSログバックアップは、製品エコシステムのダウンストリームリンクを開き、ログデータをCOSに配信することで、ログバックアップシナリオのニーズをさらに満たし、ログデータの価値を引き出すことができます。ログバックアップは非同期プロシージャで、ログデータが発生すると、SCFはトリガーにより自動的にCOSにデータをバックアップして保存します。



## 注意事項

- 以前にCOSコンソールでバケットにCLSログのバックアップルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成したCLSログバックアップ関数を確認できます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- COSへのCLSログのバックアップは、広州、上海、北京、中国香港、成都、シンガポール、ムンバイ、トロント、シリコンバレーなどのSCFがリリースされているすべてのリージョンでサポートされています。その他のサポートされているリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > データのバックアップ**をクリックし、 **CLSログのバックアップ**を見つけます。
3. **バックアップルールの設定**をクリックし、ルール設定ページに進みます。
4. **関数の追加**をクリックします。
>! SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
>
5. ポップアップしたウィンドウで、以下の情報を設定します。

	- **関数名**：関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
	- **関連バケット**：CLSログを格納するCOSバケットです。
	- **ログセット**：[ログセット](https://intl.cloud.tencent.com/document/product/614/32849)は、Cloud Log Serviceのプロジェクト管理単位であり、さまざまなログを区別するために使用されます。メッセージのソースのログセットを選択することができますが、このログセットは関数があるリージョンに存在する必要があります。
	- **ログトピック**：ログトピック(Topic)は、Cloud Log Serviceの基本的な管理単位であり、またCloud Log Serviceトリガーを管理および設定するための最小単位でもあります。1つのログセットに、複数のログトピックを含めることができます。メッセージソースのログトピックを選択することができます。
	- **最大待機時間**：待機時間を設定することで、ログを取得する頻度を制御することができます。3～300秒の設定に対応しています。最大待機時間を300秒と仮定した場合、SCFはログデータを300秒間収集して、ログファイルに一元的にパッケージ化してバックアップすることを意味します。
	- **SCF権限承認**：CLSログのバックアップには、お客様のCLSサービスからログを読み取り、お客様が指定したバケットにダンプするための権限承認が必要です。そのため、この権限承認を追加する必要があります。
6. **次のステップ**をクリックし、以下の情報を設定します。

	- **圧縮設定**：圧縮後にログをバックアップするかどうかを選択でき、圧縮後、最大128KBまでのログに対応します。現在サポートされている圧縮方法は、gzip、lzop、snappyです。
	-**パーティション形式**：ディレクトリはstrftimeの構文に従って自動的に発行されます。例えば、`%Y/%m/%d/%Y%m%d%H%M`という形式のパーティションでは、2021/06/25/202106252232というディレクトリが発行されます。
	- **ディレクトリプレフィックス**：ログのバックアップパスで、ルートディレクトリまたは指定されたパスプレフィックスへのバックアップを選択できます。
	- **ファイルサンプルの配布**：最終的なバックアップファイルのファイル名の形式は、`{COSバケット}{ディレクトリプレフィックス}{パーティション形式}_{random}.{type}`です。
7. 設定を追加して**確定**をクリックし、CLSログのバックアップルールが作成されるまで待ちます。作成が完了すると、リストページで作成したCLSログのバックアップルールを確認できます。

   新規作成したCLSログのバックアップルールに対しては、次のような操作が可能です。
	- **ログ**をクリックして、CLSログのバックアップ履歴を確認します。バックアップでエラーが発生した場合は、**ログ**をクリックしてSCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
	- **その他 > 編集**をクリックして、CLSログのバックアップルールを変更します。
	- **その他 > 削除**をクリックして、使用しないCLSログのバックアップルールを削除します。
