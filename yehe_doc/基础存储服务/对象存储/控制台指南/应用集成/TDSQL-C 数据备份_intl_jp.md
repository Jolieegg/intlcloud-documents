## 概要

TDSQL-C MySQLデータバックアップは、Tencent CloudのCloud Object Storage(COS)が提供する[Serverless Cloud Function（SCF）](https://www.tencentcloud.com/document/product/583)をベースにしてユーザーに提供するデータベースバックアップ機能です。ユーザーがTDSQL-C MySQLクラウドデータベースのバックアップファイルをオブジェクトストレージにダンプして永続的に保存できるように支援し、データの消失や破損を防ぐことができます。ユーザーが指定されたバケットにバックアップ関数ルールを設定すると、SCFはTDSQL-C MySQLのバックアップファイルを定期的にスキャンし、ファイルをバケットにダンプします。

## 注意事項

- TDSQL-C MySQLデータバックアップ関数は、Tencent CloudのTDSQL-C MySQLデータベースのbinlogバックアップファイルをバックアップします。TDSQL-C MySQLデータベースのbinlog定期バックアップを有効化したことがない場合、バックアップ関数を実行することはできません。Tencent CloudのTDSQL-C MySQLデータベースバックアップのその他の情報については、[TDSQL-C MySQLバックアップとロールバックの概要](https://intl.cloud.tencent.com/document/product/1098/48391)をご参照ください。
- 論理バックアップおよびスナップショットバックアップは、現時点ではこの機能によるCOSへのバックアップをサポートしていません。
- 以前にCOSコンソールでバケットにTDSQL-C MySQLデータバックアップルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成したTDSQL-C MySQLデータバックアップ関数を確認することができます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
- TDSQL-C MySQLデータバックアップは、広州、上海、北京、成都、中国香港、シンガポール、シリコンバレーなどのリージョンでサポートされています。その他のサポートリージョンについては、[TDSQL-C MySQLリージョンドキュメント](https://intl.cloud.tencent.com/document/product/1098/46427)をご参照ください。

## 操作手順

### アプリケーション統合でのバックアップの設定

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションで**アプリケーション統合 > データバックアップ**をクリックし、**TDSQL-C MySQLのバックアップ**を見つけます。
3. **バックアップルールの設定**をクリックし、ルール設定ページに進みます。
4. **関数の追加**をクリックします。

>! SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。

5. ポップアップしたウィンドウで、以下の情報を設定します。

 - **関数名**：関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **関連バケット**：TDSQL-C MySQLバックアップファイルを格納するバケットです。

>!バックアップ対象のTDSQL-C MySQLデータの所在リージョンは、関連バケットの所属リージョンと同一である必要があります。

 - **トリガーサイクル**：TDSQL-C MySQLデータのバックアップ関数は、時限式トリガーでバックアップ・ダンプ操作をトリガーします。トリガーサイクルは、日次・週次・カスタムサイクルに対応します。
 - **Cron表現**：トリガーサイクルがカスタムに設定されている場合、Cronを使用して具体的なトリガーサイクルルールを指定することができます。Cronは現在、現地標準時で実行されています。詳細な設定ポリシーについては、[Cron関連ドキュメント](https://intl.cloud.tencent.com/document/product/583/9708)をご参照ください。
 - **データベースインスタンス**：現在のバケットがあるリージョンのTDSQL-C MySQLデータベースインスタンスのリストです。
 - **配布パス**：バックアップファイルの配布パスのプレフィックスは、入力しないとデフォルトでバケットルートパスに保存されます。
 - **SCF権限承認**：TDSQL-C MySQLデータのバックアップには、SCFがお客様のTDSQL-C MySQLバックアップからデータベースインスタンスとそのバックアップファイルを読み取り、お客様が指定したバケットにダンプするための権限承認が必要です。そのため、この権限承認を追加する必要があります。

6. 設定を追加して**確定**をクリックすると、関数が追加されたことを確認できます。
   新規作成した関数に対しては、次のような操作が可能です。

 - **ログ**をクリックして、TDSQL-C MySQLデータのバックアップ履歴を確認します。バックアップでエラーが発生した場合は、**ログ**をクリックしてSCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
 - **その他 > 編集**をクリックして、TDSQL-C MySQLデータのバックアップルールを変更します。
 - **その他 > 削除**をクリックして、使用しないTDSQL-C MySQLデータのバックアップルールを削除します。


### バケット設定項目でのバックアップの設定

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションバーで**バケットリスト**を選択し、TDSQL-C MySQLデータのバックアップを設定する必要のあるバケットをクリックし、バケット管理ページに進みます。
3. 左側の**関数の計算**をクリックし、**TDSQL-C MySQLバックアップ関数**設定項目を見つけます。

>! SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。

4. **関数の追加**をクリックします。
5. ポップアップしたウィンドウで、以下の情報を設定します。

 - **関数名**：関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
 - **トリガーサイクル**：TDSQL-C MySQLデータのバックアップ関数は、時限式トリガーでバックアップ・ダンプ操作をトリガーします。トリガーサイクルは、日次・週次・カスタムサイクルに対応します。
 - **Cron式**：トリガーサイクルがカスタムに設定されている場合、Cronを使用して具体的なトリガーサイクルルールを指定することができます。Cronは現在、北京時間であるUTC+8中国標準時（China Standard Time）で実行されています。詳細な設定ポリシーについては、[Cron関連ドキュメント](https://intl.cloud.tencent.com/document/product/583/9708)をご参照ください。
 - **データベースインスタンス**：現在のバケットがあるリージョンのTDSQL-C MySQLデータベースインスタンスのリストです。
 - **配布パス**：バックアップファイルの配布パスのプレフィックスは、入力しないとデフォルトでバケットルートパスに保存されます。
 - **SCF権限承認**：TDSQL-C MySQLデータのバックアップには、SCFがお客様のTDSQL-C MySQLバックアップからデータベースインスタンスとそのバックアップファイルを読み取り、お客様が指定したバケットにダンプするための権限承認が必要です。そのため、この権限承認を追加する必要があります。

6. 設定を追加して**確定**をクリックすると、関数が追加されたことを確認できます。
   新規作成した関数に対しては、次のような操作が可能です。

 - **ログ**をクリックして、TDSQL-C MySQLデータのバックアップ履歴を確認します。バックアップでエラーが発生した場合は、**ログ**をクリックしてSCFコンソールにすばやくジャンプし、ログエラーの詳細を確認することもできます。
 - **その他 > 編集**をクリックして、TDSQL-C MySQLデータのバックアップルールを変更します。
 - **その他 > 削除**をクリックして、使用しないTDSQL-C MySQLデータのバックアップルールを削除します。
