## 소개

TDMQ 메시지 백업은 Tencent Cloud COS가 [SCF](https://www.tencentcloud.com/document/product/583)를 기반으로 제공하는 기능이며, TDMQ 메시지를 COS에 저장합니다. TDMQ 메시지를 저장하면 데이터 분석 및 다운로드 등의 작업을 편리하게 진행할 수 있습니다.

오픈 소스 Apache [Pulsar ](https://pulsar.apache.org/) 프로젝트를 기반으로 하는 TDMQ는 재무 수준에서 Tencent Cloud가 개발한 분산 메시징 미들웨어로 리전 간 강력한 일관성, 높은 안정성 및 동시성을 특징으로 합니다. 자세한 내용은 [TDMQ 제품 개요](https://intl.cloud.tencent.com/document/product/1110/42904)를 참고하십시오.

지정 버킷에 백업 함수 규칙을 설정하면, TDMQ에 메시지가 생성될 때 SCF에서 일정 시간 간격으로 메시지를 획득하고 COS 버킷에 저장합니다.

## 주의 사항

- COS 콘솔에서 버킷에 TDMQ 메시지 백업 규칙을 추가한 적이 있는 경우, [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 기존에 생성한 TDMQ 메시지 백업 함수를 볼 수 있습니다. 해당 함수를 삭제하지 **마십시오.** 삭제할 경우 규칙이 적용되지 않을 수 있습니다.
- 현재 COS로 TDMQ 메시지 백업을 지원하는 리전은 광저우, 상하이, 중국 홍콩, 베이징, 청두, 싱가포르, 실리콘밸리입니다.

## 작업 단계

1. [COS 콘솔](https://console.cloud.tencent.com/cos5)에 로그인합니다.
2. 왼쪽 사이드바에서 **애플리케이션 통합 > 데이터 백업**을 클릭하고 **TDMQ 메시지 백업**을 찾습니다.
3. **백업 규칙 설정**을 클릭하여 규칙 설정 페이지로 이동합니다.
4. **함수 추가**를 클릭합니다.
>! SCF 서비스가 활성화되지 않은 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf)에서 SCF 서비스를 활성화하고 안내에 따라 서비스 권한 부여를 완료하십시오.
>
5. 팝업 창에서 다음과 같이 정보를 설정합니다.

 - **함수 이름**: 함수의 고유 식별자로, 생성 후에는 수정할 수 없습니다. [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 해당 함수를 조회할 수 있습니다.
 - **연결 버킷**: TDMQ 메시지를 저장할 COS 버킷입니다.
 - **시간 세분성**: 메시지 양에 따라 메시지를 취합할 시간 간격을 선택하며, 시간 간격은 5 - 15분으로 설정할 수 있습니다. 단일 메시지 파일은 최대 5,000개로 제한되며, 메시지 파일은 최대 500MB로 제한됩니다.
 - **SCF 라이선스**: TDMQ 메시지 백업은 TDMQ 서비스에서 관련 메시지를 읽고 메시지를 지정한 버킷에 저장할 수 있는 SCF 라이선스가 필요합니다. 따라서 해당 라이선스를 추가해야 합니다.
6. **다음 단계**를 클릭하여 TDMQ 설정을 진행합니다. 설정 항목에 대한 설명은 다음과 같습니다.

 - **클러스터 선택**: 메시지 소스의 TDMQ 클러스터를 선택합니다. 리전 내 TDMQ 클러스터만 지원합니다.
 - **네임스페이스**: 클러스터의 네임스페이스를 선택합니다.
 - **제목 선택**: 메시지 소스의 제목을 선택합니다.
 - **구독 선택**: 해당 주제 구독을 선택합니다. 현재 구독이 요구 사항을 충족하지 않는 경우 [TDMQ 콘솔](https://console.cloud.tencent.com/tdmq/cluster?rid=1)로 이동하여 구독을 생성할 수 있습니다.
 - **시작 위치**: 이전 메시지의 시작 위치
 - **역할 선택**: TDMQ 역할을 선택합니다. TDMQ의 '역할'은 TDMQ 내부 전용 개념으로 Tencent Cloud의 '역할'과 다르며, 사용자가 TDMQ 내부에서 권한을 구분하는 최소 단위입니다. 사용자는 여러 역할을 추가할 수 있으며, 각각 다른 네임스페이스의 생성 및 소비 권한을 부여할 수 있습니다.
 -**역할 키**: TDMQ의 역할 키를 선택합니다. TDMQ의 '키'는 일종의 인증 툴입니다. 사용자는 클라이언트에게 키를 추가해 TDMQ에 액세스하며 메시지를 생성 및 소비할 수 있습니다. 키와 역할은 일대일 대응되고, 모든 역할은 각자 유일한 키를 가지고 있습니다.
 - **액세스 주소**: VPC 사설망 액세스 주소가 필요하며 TDMQ 클러스터가 VPC에 연결되어 있어야 합니다. 자세한 내용은 [VPC 액세스](https://intl.cloud.tencent.com/document/product/1110/42932)를 참고하십시오.
>! 해당 VPC 서브넷에는 가용 IP가 있어야 하며, DHCP를 지원해야 합니다.
>
7. **다음 단계**를 클릭하여 설정을 전송합니다. 설정 항목에 대한 설명은 다음과 같습니다.
**전송 경로**: 백업 파일의 전송 경로 접두사입니다. 입력하지 않은 경우 기본적으로 버킷의 루트 경로에 저장되며, 지정 접두사는 반드시 슬래시 `/`로 끝나야 합니다.
8. 설정을 추가한 후 **확인**을 클릭하면 추가된 함수를 확인할 수 있습니다.
새로 생성한 함수에 다음과 같은 작업을 진행할 수 있습니다.
 - **로그**를 클릭해 TDMQ 메시지 백업 기록을 조회합니다. 백업 시 오류가 보고된 경우 **로그**를 클릭하고 빠르게 SCF 콘솔에 리디렉션하여 로그 오류 상세 내용을 조회할 수 있습니다.
 - **더 보기 > 편집**을 클릭하여 TDMQ 메시지 백업 규칙을 수정합니다.
 - **더 보기 > 삭제**를 클릭하여 사용하지 않는 TDMQ 메시지 백업 규칙을 삭제합니다.
