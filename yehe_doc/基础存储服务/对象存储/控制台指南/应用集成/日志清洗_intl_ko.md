## 소개

로그 클리닝은 Tencent Cloud COS가 [Serverless Cloud Function(SCF)](https://www.tencentcloud.com/document/product/583)을 기반으로 사용자에게 제공하는 로그 파일 처리 솔루션입니다. 사용자가 [로그 관리 서비스](https://intl.cloud.tencent.com/document/product/436/16920)를 활성화하거나 직접 로그 파일을 업로드할 때, COS에서 사전 설정한 SCF를 자동으로 트리거하고 함수에 지정한 SQL 인덱스 명령을 통해 파일에 있는 로그 정보를 자동으로 필터링 및 클리닝하며 지정한 버킷 및 경로에 결과를 전송합니다.

## 주의 사항

- 로그 클리닝 기능은 COS 데이터 인덱스 인터페이스를 사용합니다. 제한 사항에 대한 자세한 내용은 [Select 개요](https://intl.cloud.tencent.com/document/product/436/32472)를 참고하십시오.
- COS 콘솔에서 버킷에 로그 클리닝 백업 규칙을 추가한 적이 있는 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 기존에 생성한 로그 클리닝 함수를 확인할 수 있습니다. 이 로그 클리닝 함수를 삭제하거나 수정하지 **마십시오.** 삭제 및 수정할 경우 규칙이 적용되지 않을 수 있습니다.
- 현재 로그 클리닝 기능은 광저우, 상하이, 베이징, 청두 리전에서만 지원됩니다.
- COS의 로그 클리닝 기능은 SCF 서비스에 종속됩니다. SCF 서비스는 사용자에게 [Free Tier](https://intl.cloud.tencent.com/document/product/583/12282)를 제공하며 무료 한도를 초과한 부분에 대해서는 [SCF Pricing](https://intl.cloud.tencent.com/document/product/583/12281)에 따라 청구됩니다.

## 작업 단계

1. [COS 콘솔](https://console.cloud.tencent.com/cos5)에 로그인합니다.
2. 왼쪽 사이드바에서 **애플리케이션 통합 > 확장 기능**을 클릭하고 **로그 클리닝**을 찾습니다.
3. **로그 클리닝 설정**을 클릭하여 규칙 설정 페이지로 이동합니다.
4. **함수 추가**를 클릭합니다.
>! SCF 서비스가 활성화되지 않은 경우 [SCF 콘솔](https://console.cloud.tencent.com/scf)에서 SCF 서비스를 활성화하고 안내에 따라 서비스 권한 부여를 완료하십시오.
> 
5. 팝업 창에서 다음과 같이 정보를 설정합니다.

	- **함수 이름**: 함수의 고유 식별자로, 생성 후에는 수정할 수 없습니다. [SCF 콘솔](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)에서 해당 함수를 조회할 수 있습니다.
	- **연결 버킷**: 로그를 저장할 COS 버킷입니다.
	- **이벤트 유형**: 이벤트란 SCF를 트리거하는 작업입니다. 업로드 작업을 예로 들면, 업로드 방식은 `PUT Object` 인터페이스 호출 또는 `POST Object` 인터페이스 호출일 수 있습니다. 이벤트를 **Put 메소드 생성**으로 선택하면 `PUT Object` 인터페이스를 통해 업로드하는 로그 파일만 로그 클리닝이 트리거됩니다.
>! 파일을 간편 업로드, 멀티파트 업로드, 리전 간 복제 등 다양한 방식을 통해 버킷에 업로드한 경우 **전체 생성** 이벤트 선택을 권장합니다.
>
	- **트리거 조건**: 로그 파일을 어떤 경로에 업로드할 때 SCF가 트리거되는 조건을 의미합니다. 특정 범위를 선택하는 경우 로그 파일을 특정 범위의 경로에 업로드할 때 SCF가 트리거되며, 모든 버킷을 선택하는 경우 버킷의 임의 위치에 로그 파일을 업로드할 때 항상 트리거됩니다.
	- **SCF 권한 부여**: 로그 클리닝 시, 사용자의 버킷에서 로그 파일을 읽어오고 클리닝 후의 로그 파일을 지정한 위치에 업로드하는 SCF 권한이 필요하므로 해당 권한을 추가해야 합니다.
6. **다음 단계**를 클릭하여 로그 클리닝을 설정합니다. 설정 항목에 대한 설명은 다음과 같습니다.

	- **원본 파일 설정**: 실제 상황에 따라 인덱스가 필요한 파일 유형, 행/열 세퍼레이터, 리스트 헤더, 압축 포맷을 선택합니다.
	**SQL 표현식**: 실행할 인덱스 명령을 작성합니다. Tencent Cloud에서 제공하는 SQL 템플릿을 사용할 수도 있으며, SQL 관련 명령어에 대한 설명은 [SQL 함수](https://intl.cloud.tencent.com/document/product/436/32474)를 참고하십시오.
	- **내보내기 설정**: 실제 상황에 따라 내보낼 포맷, 행/열 세퍼레이터, 이스케이프 설정을 선택합니다.
7. **다음 단계**를 클릭하여 설정을 전송합니다. 설정 항목에 대한 설명은 다음과 같습니다.

	- **전송 버킷**: 로그 파일 클리닝 완료 후 생성되는 파일이 저장되는 버킷입니다.
	- **전송 경로**: 로그 파일 클리닝 완료 후 생성되는 파일이 저장되는 구체적인 경로입니다. 트리거 순환을 방지하기 위해 전송 경로의 접두사를 트리거 조건과 동일하게 지정하지 마십시오.
>! 설정한 저장 접두사와 트리거 조건 접두사에 포함관계가 있는 경우 트리거 순환이 발생할 수 있으므로 최대한 해당 상황이 발생하지 않도록 주의하십시오. 예를 들어 전송 접두사가 prefix/target/이고, 트리거 조건 접두사가 prefix/이면, prefix/test.csv 로그 파일 업로드 시 자동으로 로그 클리닝 산출 파일인 prefix/target/test.cos_select_result.csv가 버킷에 생성 및 저장되며, 클리닝 순환이 트리거됩니다.
> 
8. 설정을 추가한 후 **확인**을 클릭하면 추가된 함수를 확인할 수 있습니다.
새로 생성한 함수에 다음과 같은 작업을 진행할 수 있습니다.
 - **로그**를 클릭하여 로그 클리닝 실행 이력을 확인합니다. 로그 클리닝에 오류가 발생한 경우, **로그**를 클릭하여 SCF 콘솔로 빠르게 이동해 로그 오류 상세 정보를 확인할 수 있습니다.
 - **더 보기 > 편집**을 클릭하여 로그 클리닝 규칙을 수정합니다.
 - **더 보기 > 삭제**를 클릭하여 사용하지 않는 로그 클리닝 규칙을 삭제합니다.

