## 概要

Content Delivery Network（CDN）のキャッシュ更新は、Tencent CloudのCloud Object Storage（COS）が[Serverless Cloud Function(SCF)](https://www.tencentcloud.com/document/product/583)をベースとしてユーザー向けに提供するデータ更新機能です。ユーザーがCDNエッジノードにキャッシュされたデータを自動的に更新するのを支援することができます。ユーザーがバケットにトリガールールを追加した後、そのバケット内のファイルが更新された際に、COSがあらかじめ設定したSCFが自動的にトリガーされて、キャッシュされたデータが自動的に更新されます。

> !
> - 以前にCOSコンソールでバケットにキャッシュ更新ルールを追加したことがある場合は、[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)で、作成したキャッシュ更新関数を確認できます。この関数を削除すると、ルールが有効にならない場合がありますので削除**しないで**ください。
> - CDNキャッシュ更新機能は、広州、上海、北京、成都、中国香港、シンガポール、ムンバイ、トロント、シリコンバレーなど、SCFがリリースされているすべてのリージョンでサポートされています。その他のサポートリージョンについては、[SCF製品ドキュメント](https://www.tencentcloud.com/document/product/583)をご参照ください。
> - CDNキャッシュ更新機能は、ネットワークリンクの不安定さなどの要因により、失敗する場合があります。機能のパフォーマンスが期待どおりではない場合、COSコンソールで作成した関数の右側にある**ログの確認**をクリックすると、SCFコンソールにジャンプしてログエラーの詳細を確認し、エラーの原因を突き止めることができます。
> - CDNキャッシュ更新機能は、SCFサービスに依存しています。ユーザーにはSCFサービス[無料利用枠](https://intl.cloud.tencent.com/document/product/583/12282)が提供されていますが、無料利用枠を超える部分については、[SCF製品価格](https://intl.cloud.tencent.com/document/product/583/12281)に従って課金されます。CDNキャッシュ更新機能を使用する場合は、更新の回数が多いほど、消費する呼び出し回数も多くなります。

## 操作手順

1. [COSコンソール](https://console.cloud.tencent.com/cos5)にログインします。
2. 左側ナビゲーションバーで**バケットリスト**をクリックし、CDNキャッシュ更新ルールを追加する必要のあるバケットをクリックし、バケット管理ページに進みます。
3. 左側ナビゲーションバーで、**関数の計算 > CDNキャッシュ更新関数**をクリックします。
![](https://main.qcloudimg.com/raw/b6618ad14cff7d6daf37520d78371cd2.png)
> !SCFサービスをアクティブ化していない場合は、[SCFコンソール](https://console.cloud.tencent.com/scf)に移動してSCFサービスをアクティブ化し、プロンプトに従ってサービス権限承認を行えば完了です。
4. **関数の追加**をクリックし、ポップアップウィンドウに以下の情報を設定します。
![](https://main.qcloudimg.com/raw/9881bbc4d5cf620c4cfac9060b061ce5.png)
	- **関数名**：関数名は、関数の一意の識別名として、作成後に変更することはできません。[SCFコンソール](https://console.cloud.tencent.com/scf/list?rid=1&ns=default)でこの関数を確認できます。
	- **イベントタイプ**：イベントとは、SCFをトリガーする操作です。アップロード操作を例に取ると、アップロード方法は、[PUT Object](https://intl.cloud.tencent.com/document/product/436/7749)インターフェースを呼び出すか、[Post Object](https://intl.cloud.tencent.com/document/product/436/14690)インターフェースを呼び出して行われます。選択したイベントが`PUTタイプ`の場合、`PUT Object`インターフェース経由でファイルをアップロードする操作のみがSCFをトリガーし、CDNエッジノードのキャッシュを更新します。
	- **トリガー条件**：イベントのトリガーとなるファイルソースの範囲を、すべてのバケットや指定したプレフィックス、指定した拡張子などで指定することができます。プレフィックスまたは拡張子を指定した後、ルールはマッチングするファイルソースに対してのみ有効になります。
	- **指定ドメイン名**：更新が必要なCDNドメイン名のことです。
	- **SCF承認**：CDNキャッシュ更新には、SCFがCDNの`PurgeUrlsCache`インターフェースを呼び出して、CDNキャッシュ更新のデータをクリアするための承認が必要です。これにより、CDNはCOSへback-to-originを行い、最新データをプルすることができます。
5. 設定を追加して**確定**をクリックすると、関数が追加されたことを確認できます。
 - **ログ**をクリックすると、CDNキャッシュ更新の履歴を確認することができます。
 - **削除**をクリックすると、不要なCDNキャッシュ更新ルールが削除されます。
