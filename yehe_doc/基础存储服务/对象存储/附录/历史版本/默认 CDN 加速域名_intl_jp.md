>!2022年5月9日より、Cloud Object Storage（COS）サービスではデフォルトのCDNアクセラレーションドメイン名の新規追加をサポートしないことになりました。すでに有効化している、または過去に有効化したことのあるデフォルトのCDNアクセラレーションドメイン名には影響はなく、引き続きご利用いただけますが、デフォルトのCDNアクセラレーションドメイン名の代わりにカスタムCDNアクセラレーションドメイン名を使用することをお勧めします。カスタムCDNアクセラレーションドメイン名の操作ガイドについては、[カスタムCDNアクセラレーションドメイン名の有効化](https://intl.cloud.tencent.com/document/product/436/31506)のドキュメントをご参照ください。

### 設定についての説明

デフォルトのCDNアクセラレーションドメイン名は、COSがバケットに自動的に割り当てるCDNアクセラレーションドメイン名であり、形式は`BucketName-APPID.file.myqcloud.com`です。CDNアクセラレーションドメイン名を有効にすると、このドメイン名によってアクセスのアクセラレーションを体験できます。

#### 操作手順

#### 1. バケットの選択
[COSコンソール](https://console.cloud.tencent.com/cos5)にログインし、左側ナビゲーションバーの**バケットリスト**をクリックし、アクセラレーションしたいバケットをクリックして、バケット管理ページに進みます。

#### 2. 設定ページに進む
>!Tencent Cloud CDNサービスをまだご利用でないユーザーは**ドメイン名管理**に進むことができません。先に[CDNコンソール](https://console.cloud.tencent.com/cdn)でCDNサービスをアクティブ化する必要があります。

左側の**ドメイン名と伝送管理>デフォルトのCDNアクセラレーションドメイン名**をクリックし、**デフォルトのCDNアクセラレーションドメイン名**設定項目を見つけます。デフォルトのCDNアクセラレーションドメイン名は初期ステータスでは**無効**になっています。**編集**をクリックし、現在のステータスを**有効**に設定した後、次の設定項目説明に従って設定を行います。

 - **アクセラレーションドメイン名**：デフォルトのCDNアクセラレーションドメイン名は、COSがバケットに自動的に割り当てるCDNアクセラレーションドメイン名であり、形式は`BucketName-APPID.file.myqcloud.com`です。CDNアクセラレーションドメイン名を有効にすると、このドメイン名によってアクセスのアクセラレーションを体験できます。
 - **アクセラレーションリージョン**：中国本土、中国本土以外およびグローバルアクセラレーションをサポートしています。グローバルアクセラレーションとは、すべてのリージョン間でのバケットアクセラレーションをサポートすることを指します。
 - **オリジンサーバーのタイプ**：デフォルトでは**デフォルトオリジンサーバー**です。オリジンサーバーにしているバケットで静的ウェブサイトを有効にし、かつ静的ウェブサイトのアクセラレーションを行いたい場合は、オリジンサーバーのタイプを**静的ウェブサイトのオリジンサーバー**に設定することができます。具体的には、[CDNアクセラレーションの概要](https://intl.cloud.tencent.com/document/product/436/18669)をご参照ください。
 - **オリジンサーバードメイン名**：COSオリジンサーバーのドメイン名であり、バケットの作成時に、システムがバケット名およびリージョンに基づいて自動的に生成するもので、デフォルトのCDNアクセラレーションドメイン名と区別する必要があります。

#### 3. back-to-origin認証の有効化（オプション）

>!プライベート読み取りバケットに対して、back-to-origin認証とCDNサービス権限承認を有効化すると、CDNエッジノードがオリジンサーバーへアクセスする際に署名を必要としないため、CDNキャッシュリソースがパブリックネットワーク配信を行い、データセキュリティに影響する場合があります。このためCDN認証を有効化することを強く推奨します。

back-to-origin認証は、CDNエッジノードのサービスIDを検証し、不正アクセスを阻止するために用いられます。具体的には次のとおりです。
- パブリック読み取りバケット：CDNエッジノードに何の権限承認を行わなくても、バケットに直接アクセスできるため、back-to-origin認証を有効にする必要はありません。
- プライベート読み取りバケット：CDNエッジノードはback-to-origin認証によるサービスIDの検証を受ける必要があり、検証に合格したCDNエッジノードのみがバケット内のオブジェクトにアクセスできます。


（1）CDNサービス権限承認の完了

>?back-to-origin認証を有効にする前に、CDNサービス権限承認を追加しておく必要があります。

操作手順は次のとおりです。
CDNサービス権限承認の追加とは、CDNエッジノードに対し、バケットの操作を行えるサービスIDを付与することを指します。具体的には次のとおりです。
- パブリック読み取りバケット：CDNエッジノードに何の権限承認も行わなくても、バケットに直接アクセスできるため、CDNサービス権限承認を追加する必要はありません。
- プライベート読み取りバケット：CDNエッジノードに特別なサービスIDを付与しなければバケットにアクセスすることはできません。**CDNサービス権限承認の追加**をクリックして、CDNエッジノードに対しサービスIDを付与し、**上記の権限承認に同意します**を選択し、**OK**をクリックします。

CDNサービス権限承認を完了すると、CDNエッジノードはバケットに対しGet Object、Head Object、Options Objectの3つの操作を行えるようになります。システムはバケットアクセスポリシーを自動的に書き込みます。ポリシーの例は次のとおりです。これ以降、CDNノードはback-to-originが必要な場合にその他の操作を行う必要がなくなります。

```xml
  {
    "Statement": [
      {
        "Action": [
          "name/cos:GetObject",
          "name/cos:HeadObject",
          "name/cos:OptionsObject"
        ],
        "Effect": "allow",
        "Principal": {
          "qcs": [
            "qcs::cam::uin/100000000001:service/cdn"
          ]
        },
        "Resource": [
          "qcs::cos:ap-chengdu:uid/1250000000:examplebucket-1250000000/*"
        ]
      }
    ],
    "version": "2.0"
  }
```

（2）権限承認が完了したことを確認後、**back-to-origin認証**をクリックして有効化できるようになります。




#### 4. CDNアクセラレーションの有効化
**保存**をクリックすると、デフォルトのCDNアクセラレーションドメイン名がデプロイ中と表示されます（設定は約5分で完了します）。

#### 5. CDN認証の設定

>!デフォルトのCDNアクセラレーションを有効化すると、このドメイン名によって誰でもオリジンサーバーに直接アクセスできるようになります。データに一定のプライバシーが存在する場合は、必ず**認証設定を有効**にして、オリジンサーバーデータを保護してください。

 - デフォルトのCDNアクセラレーションドメイン名とback-to-origin認証を有効にすると、デフォルトのCDNアクセラレーションドメイン名管理画面の下にCDN認証ステータスの表示があらわれます。表示された**認証設定**から、対応するドメイン名の**アクセス制御**ページに直接ジャンプして設定を行うことができます。

 - もしくは、[CDNコンソール](https://console.cloud.tencent.com/cdn)に進み、**ドメイン名管理**をクリックした後、デフォルトのCDNアクセラレーションドメイン名をクリックして選択し、最後に**アクセス制御**>**認証設定**をクリックします。具体的な設定手順については[認証設定](https://intl.cloud.tencent.com/document/product/228/35237)をご参照ください。

#### 6. 機能の無効化

上記の手順が完了すると、 デフォルトのCDNアクセラレーションの有効化が完了します。デフォルトのCDNアクセラレーションを無効化したい場合は、次の方法で行うことができます。

- デフォルトのCDNアクセラレーションドメイン名管理画面で**編集**をクリックし、ステータスを**有効**から**無効**に変更し、**保存**をクリックします。デプロイには約5分かかります。デプロイの完了後、CDNコンソール上でそのドメイン名のステータスは**有効化済み**から**無効化済み**に変わります。
- [CDNコンソール](https://console.cloud.tencent.com/cdn)でドメイン名の無効化/削除操作を行うことができます。詳細については、[ドメイン名の操作](https://intl.cloud.tencent.com/document/product/228/5736)をご参照ください。



>!CDNコンソールで削除するのは、デフォルトのCDNアクセラレーションドメイン名がCDNアクセラレーションを行った際のレコードのみであり、デフォルトのCDNアクセラレーションドメイン名自体を完全に抹消するわけではありません。CDNアクセラレーションを再度有効化したい場合は、COSコンソール上でデフォルトのCDNアクセラレーションドメイン名を再び有効化することができます。
>


