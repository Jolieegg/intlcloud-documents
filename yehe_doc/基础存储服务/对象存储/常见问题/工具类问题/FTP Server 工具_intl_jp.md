### FTP機能をアクティブ化するにはどうすればよいですか。

COSはWeb方式のリクエストをサポートする永続ストレージであり、ネイティブのFTPアクセス方式はご提供していません。FTPプロトコルを使用するには中継が必要です。**Tencent Cloud公式サイトで提供する[FTP Serverツール](https://www.qcloud.com/document/product/436/7214)を基に、ご自身でサービスを構築し使用することをお勧めします。**
FTPプロトコルは旧式のプロトコルのため、データの完全性のチェックや伝送セキュリティの保障ができず、CAM権限システムとの連結もできないため、FTPプロトコルを使用したアクセスを継続することは強く非推奨とします。Tencent Cloudが今後FTPプロトコルおよび中継ソフトウェアをサポートすることもありません。 
データを同期する必要がある場合は、[COS Migrationツール](https://intl.cloud.tencent.com/document/product/436/15392)または[COSCMDツール](https://intl.cloud.tencent.com/document/product/436/10976)を直接使用することをお勧めします。

### 設定ファイルの中のmasquerade_addressというオプションにはどのような役割がありますか。masquerade_addressはどんなときに設定する必要がありますか。

masquerade_addressはクライアントに提供するサーバーアドレスを設定するためのものです。FTP serverをNATによってパブリックIPにマッピングされたホスト上で実行する場合は、masquerade_addressオプションを、クライアントがアクセスできるFTP ServerパブリックIPに設定することで、このIPとサーバーを使用してデータ通信を完了するようクライアントに通知することができます。

例えば、FTPサーバーを運用するマシン上で ifconfigを実行すると、パブリックネットワークにマッピングされたネットワークカードIPは10.xxx.xxx.xxxとなり、マッピングしたパブリックネットワークIPは119.xxx.xxx.xxxとみなされます。この際、FTPサーバーが明示的にmasquerade_address をパブリックネットワークIP（119.xxx.xxx.xxx）として設定しない場合、FTPサーバーはPassiveモードでプライベートネットワークアドレス（10.xxx.xxx.xxx）を使用してクライアントにパケットを返すことがあります。 この場合、クライアントはFTPサーバーに接続できますが、クライアントにデータパケットを正しく返すことができないという状況が発生します。

したがって通常は、クライアントがサーバーに接続する際に使用するIPアドレスと同じmasquerade_addressにすべて設定することをお勧めします。



### masquerade_addressオプションを正しく設定すると、ftp serverには正常にログインできましたが、FTPコマンド：listまたはgetなどのデータ取得コマンドを実行すると、「サーバーがルーティングできないアドレスを返します」または「ftp: connect: No route to host」などのエラーが表示されます。どのように対処すればよいですか。

このケースの大半は、ftp serverマシンのiptablesまたはファイアウォールポリシーがすべてのICMPプロトコルパケットをrejectまたはdropしていることが原因です。一方、FTPクライアントはFTP Serverがパッシブモードで返すデータを取得してIP接続した後、最初にICMPパケットを送信してIPの接続性を検出しようとします。 このため、クライアントには「サーバーがルーティングできないアドレスを返します」などのエラーが表示されます。

推奨する対処方法は、iptablesポリシーを必要に応じて、制限したいICMPパケットのタイプのみをrejectまたはdropするように設定することです。外部のpingタイプのICMPパケットのみを禁止したい場合は、ポリシーを`iptables -A INPUT -p icmp --icmp-type 8 -s 0/0 -j [REJECT/DROP]`に変更することができます。
あるいは、アクセスが必要なftp serverのクライアントIPのみを単独で開放することもできます。

### 大容量ファイルをアップロードする際、途中でキャンセルしましたが、COSにアップロード済みのファイルが残っているのはなぜですか。

COSの最新バージョンに対応したFTP Serverは完全なストリーミングアップロード機能を提供しており、ユーザーのファイルアップロードがキャンセルまたは中断されると、大容量ファイルのアップロード完了操作がトリガーされるとともに、すでにアップロードされたデータを1つの完全なファイルとして構成します。ユーザーが再アップロードしたい場合は、元のファイル名に上書きしてアップロードするか、または不完全なファイルを手動で削除してから再アップロードすることができます。


### アップロードしたファイルが上限を超えた場合はどうなりますか。

実際にアップロードされた単一ファイルのサイズが設定ファイルの制限を超えた場合、システムはIOErrorを返し、ログにエラー情報を表示します。

そのほかに問題がありましたら、[お問い合わせ](https://intl.cloud.tencent.com/contact-sales)ください。その際、完全な`cos_v5.log`ログを添付していただければ、問題の調査と解決に役立ちます。

### COS FTP Serverの設定において、アップロードできるファイルの上限を設定する必要があるのはなぜですか。

COSのマルチパートアップロード数は最大10000パートまでで、なおかつ各パートのサイズは1MB～5GBに制限されています。ここでアップロードファイルの最大サイズを設定するのは、1つのアップロードパートのサイズを適切に計算するためです。

FTP Serverはデフォルトでは200GB以内の単一ファイルのアップロードをサポートしていますが、ユーザーが大きすぎるサイズを設定することはお勧めしません。単一ファイルサイズの設定が大きくなるほど、アップロード時のパートのバッファもそれに応じて増大し、ユーザーのメモリリソースを浪費する可能性があるからです。このため、ご自身の実際の状況に応じて、単一ファイルサイズの制限を適切に設定することをお勧めします。



