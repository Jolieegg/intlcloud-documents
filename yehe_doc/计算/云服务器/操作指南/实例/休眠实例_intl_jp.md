### **ユースケース**

インスタンスを休止状態にすると、オペレーティングシステムはメモリ内のデータ（オペレーティングシステムで実行されている各アプリケーションとその使用状況）をインスタンスのシステムディスクに保存します。ユーザーがインスタンスを次回起動すると、オペレーティングシステムは前回保存したメモリデータを読み取り、休止前のCVMインスタンスの実行状態に自動的に復元されます。

シャットダウンとの違いは、シャットダウン後のインスタンスを再起動すると、オペレーティングシステムがバックグラウンドサービスとアプリケーションサービスを再起動するということです。

ある時間帯でインスタンスを実行する必要がなく、特定の操作（設定調整やシステムの再インストール）も行う必要がない場合、インスタンスを休止状態にすることをおすすめします。


### **使用の前提条件**

1. インスタンスの休止は現在、国際ステーションシリコンバレー地域が利用できますが、今後、他の地域も利用できるようになります；

2. 今のところ、標準型S3インスタンスおよびメモリが150 GIB未満のものが休止機能をオンにすることができます。他のインスタンスタイプへの適用についてまだ開発中です；

3. イメージはカスタムイメージ：Ubuntu20、CentOS 8.xであり、休止機能をオンにすることができます；

4. システムディスクはクラウドディスクであり、休止機能をオンにすることができます；

5. インスタンスに休止agentを実装しました。

### **注意事項**

1. インスタンスの作成時に休止機能をオンにすると、この機能をオフにすることはできません；

2. インスタンスの作成時に休止機能がオフになっている場合、インスタンスを休止状態にすることはできません；

3. 従量課金の場合は、「休止状態に入ると課金されない」と「インスタンス保留状態に入っても課金される」がサポートされますが、スポットインスタンスでは休止状態に入っても課金されます。

4. インスタンスの作成時に休止状態がオンになっている場合、次の操作はサポートされません：

  - 構成の調整がサポートされません。
    
  - システムの再インストールがサポートされません。
    
  - スナップショットの作成がサポートされていません。
    
  - ディスク媒体の調整がサポートされません。
    
  - カスタムイメージの作成がサポートされません。
    

5. Auto Scalingグループ内のインスタンスは休止をサポートしていません。

>!
>1. インスタンス内で休止操作が行われた場合、休止料金がかかります。
>2. 休止に失敗すると、インスタンスは自動的に「実行中」状態になります。


### **操作手順**

1. 作成時に休止状態をオンにする

インスタンスを作成するときは、まず休止機能をオンにします。オンにしないと、インスタンスを休止状態にすることはできません。

2. 休止agentのインストール

  - cvmインスタンスの内部にログインします。

  - agentスクリプトのダウンロード：wget https://store-1252113659.cos.na-siliconvalley.myqcloud.com/suspend.py 

  - agentのインストール：   

    - centosマシンの場合：python3 suspend.py

    - ubuntuマシンの場合：sudo python3 suspend.py


3. インスタンスを休止状態にする

CVMインスタンスが休止状態になり、休止agentがインストールされると、実行中のインスタンスを休止状態にすることができます。

  - CVMコンソール-インスタンスとイメージ-インスタンスページにアクセスし、休止したいインスタンスを選択し、「インスタンスの設定-休止」をクリックします；

  - 従量課金されたインスタンスでは、「休止状態に入ると課金されない」と「インスタンス保留状態に入っても課金される」を選ぶことができますが、スポットインスタンスでは休止状態に入っても課金されます。

  - OKをクリックすると、インスタンスはstopped状態になります。インスタンスを起動する必要がある場合は、スタートアップを選択してください。