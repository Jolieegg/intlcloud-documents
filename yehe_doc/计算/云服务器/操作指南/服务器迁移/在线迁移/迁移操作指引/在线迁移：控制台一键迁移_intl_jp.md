このドキュメントでは、コンソールの「ワンクリック移行」方法を通じて移行元サーバーを Tencent Cloud CVM に移行する方法について説明します。

## 概要
ワンクリック移行は[オンライン移行](https://intl.cloud.tencent.com/document/product/213/35639)を簡潔化したソリューションであり、移行元サーバーへのログインやツールのダウンロードなどの複雑な操作が不要になり、ワンクリックで移行タスクを一括作成し、移行元サーバー上のOSやアプリケーションなどのデータをTencent Cloudに一括移行することができます。
ワンクリック移行は、Linux と Windows の両方のOSをサポートします。また、Tencent Cloud CVMコンソールのオンライン移行ページで移行の進行状況を確認することもできます。

## 制限事項
- 「ワンクリック移行」方法を使用するには、移行元サーバーでクラウドアシスタント (Alibaba Cloud ECS Cloud Assistant など) をインストールし、パブリック IP を構成し、VPC (クラシックネットワークをサポートしない) を使用する必要があります。
- 現在、ワンクリック移行では Alibaba Cloud サーバーの Tencent Cloud への移行のみをサポートしており、他のプラットフォームはサポートしません。
- コンソールのワンクリック移行機能は継続的に最適化されているため、現在は特定のシナリオでのみサポートされています。ご要望を満たせない場合、 [オンライン移行：クライアントから移行元のインポート]( https://www.tencentcloud.com/document/product/213/55046)方法を使用することをお勧めします。この移行方法はより強力な互換性を持っています。


## 移行ワークフロー
コンソールのワンクリック移行によるオンライン移行の流れを次の図に示します。
<img style="width:850px; max-width: inherit;" src="https://staticintl.cloudcachetci.com/yehe/backend-news/rx7I359_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230428170703.png" />

## 移行手順

### 手順1：移行の準備
[](id:TencentAccessKey)
- **Tencent Cloudコンソールからアクセスキーを取得します**
CAMコンソールの[APIキー管理](https://console.cloud.tencent.com/cam/capi)ページでAPI キーを作成し、**SecretId と SecretKey **を取得します。詳細については、[アクセスキー](https://intl.cloud.tencent.com/document/product/598/34228)をご参照ください。
>?サブアカウントを使用してコンソールで移行を実行する場合、ルートアカウントで[CAMコンソール](https://console.cloud.tencent.com/cam/policy)にログインし、サブアカウントにQcloudCSMFullAccess とQcloudCVMFullAccess 権限を付与する必要があります。
[](id:AliAccessKey)
- **移行元クラウドプラットフォームでアクセスキーを取得します**
Alibaba CloudのAccessKeyIDとAccessKeySecretを取得する手順は以下の通りです：
 1. Alibaba Cloud RAMコンソールにログインして、**Identities** > [**Users**](https://ram.console.aliyun.com/users)ページに入ります。
 2. **Create User**をクリックし、アクセス方法から**OpenAPI Access（他のアクセス方法を選択しても有効にならない）**を選択して、作成を確認した後、AccessKeyID とAccessKeySecretの情報を保存します。詳細な操作手順については、[RAM ユーザーの準備](https://help.aliyun.com/document_detail/93720.html)をご参照ください。
 3. ユーザリストから作成したユーザに**権限を追加**します。ECS 読み取り専用権限 (AliyunECSReadOnlyAccess) と ECS クラウドアシスタント管理権限 (AliyunECSAssistantFullAccess) を追加します。詳細な操作手順については、[Grant permissions to a RAM user](https://help.aliyun.com/document_detail/116146.html)をご参照ください。
-**移行元サーバーのアプリケーションの一時停止（オプション）**
移行中に既存のアプリケーションへの影響を回避するために、移行元サーバー上のすべてのアプリケーションを停止することをお勧めします。
- **移行元サーバーと移行先CVM上のデータのバックアップ（オプション）**
移行前に次の方法でデータをバックアップすることをお勧めします。
 - 移行元サーバー：スナップショット機能またはその他の方法を使用して、移行元サーバー上のデータをバックアップできます。
 - 移行先CVM： [スナップショットの作成](https://intl.cloud.tencent.com/document/product/362/5755)などの方式を選択して、移行先CVMのデータをバックアップできます。
-**移行先CVMの確認**
 移行先がCVMインスタンスの場合は、移行先のCVMを確認する必要があります。
  <table>
<tr>
	<th style="width: 15%;">移行先CVM </th>
	<td>
	  <ol style="margin: 0;">
		<li>
		ストレージ容量：移行先CVMのクラウドディスク（システムディスクとデータディスクを含む）には、移行元サーバーから移行されたデータを保存するための十分な容量が必要です。</li>
		<li>セキュリティグループ：セキュリティグループでポート80、443、および3389を開放します。</li>
		<li>
		帯域幅：移行をより円滑に進めるためには、移行元と移行先の両方の環境の帯域幅を最大化することをお勧めします。移行プロセス中に消費されるトラフィックは、移行されたデータの量とほぼ同じになります。必要に応じて、移行前にネットワーク課金モデルを調整します。</li>
<li>
		ネットワーク設定：移行元または移行先サーバーが IPv6 のみをサポートし、IPv4 をサポートしていない場合は、<a href="https://intl.cloud.tencent.com/document/product/213/44340">client.jsonファイルのパラメータ説明をご参照ください。</li>
	  </ol>
	</td>
  </tr>
</table>
-**ワンクリック移行ページに入ります**
  1. CVMコンソールにログインし、**サービス移行** > [**オンライン移行**](https://console.cloud.tencent.com/cvm/csm/online?rid=1)ページに入ります。**移行元のインポート**をクリックして、[移行元のインポート](https://console.cloud.tencent.com/cvm/csm/online/importSource) ページに移動します。
  2. **ワンクリック移行**を選択して、移行タスクを一括で作成することができます。<br>


### 手順2：移行タスクの作成
1. **タスクの設定**
タスクの名前と説明を入力します。
2. **移行元の設定**
移行元のサービスプロバイダーはデフォルトではAlibaba Cloud ECSを選択します。**移行元サーバーへのアクセス権限を持っていることを確認する**ために、下図に示すように、Alibaba CloudアカウントのAccessKeyとSecretKey（[取得方法](#AliAccessKey)）を入力して検証する必要があります：
>!キーを大切に保管してください。移行完了後に、キーを削除または無効化することをお勧めします。

![](https://staticintl.cloudcachetci.com/yehe/backend-news/6iz5493_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230407161205.png)
3. **移行先の設定**
移行先のサービスプロバイダーはデフォルトではTencent Cloud CVMを選択します。**Tencent Cloud CVMの権限を取得**するために、Tencent Cloud APIキーのSecretIdとSecretKey（[取得方法](#TencentAccessKey)）を入力する必要があります。[APIキー管理](https://console.cloud.tencent.com/cam/capi)からキーの情報をそのままコピーできます。APIキーが正しくなければ、移行に失敗しますので、API キーが正しいことを確認してください。    
>!キーを大切に保管してください。移行完了後に、キーを削除または無効化することをお勧めします。

![](https://staticintl.cloudcachetci.com/yehe/backend-news/P5Xt263_%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20230407161235.png)
4. **移行情報の設定**
 1.　移行元の情報を確認したら、**移行元の追加**をクリックして、ポップアップした画面から移行するインスタンスを選択します。
 2.　画面の左上隅でリージョンを選択し、**リージョン**内の**インスタンスリスト**を取得します。リージョンの後の数字はインスタンスの数を示します。
 3.　移行するインスタンスを選択して、それが右側の**選択済み**リストに追加されます。
 >?
 >- **マルチインスタンス、マルチリージョン**の一括移行がサポートされます。移行元を複数回追加することができます。
 >- 現在、最大 5 つのインスタンスを一括移行できます。
 >

 4.**OK**をクリックすると、移行元情報リストに移行待ちのインスタンス情報が表示されます。操作列で**移行先の追加**をクリックし、移行先の情報を設定できます。
 5.**移行先の追加**画面で、リージョンと移行先のタイプを設定します。

 <table>
<thead>
<tr>
<th>アイテム</th>
<th>入力必須</th>
<th>説明</th>
</tr>
</thead>
<tbody><tr>
<td>移行先リージョン</td>
<td>はい</td>
<td>‍移行元サーバーの移行先となるTencent Cloudリージョン。リージョンについては、<a href="https://intl.cloud.tencent.com/document/product/213/6091">リージョンとアベイラビリティーゾーン</a>をご参照ください。</td>
</tr>
<tr>
<td>移行先タイプ</td>
<td>はい</td>
<td>Tencent Cloud に移行する移行元サーバーのターゲットタイプを設定します。<ul><li><strong>CVMイメージ</strong>：移行完了後、移行元サーバーのCVMイメージが生成されます。<br>イメージ名：移行元に対して生成されるターゲットCVM イメージの名前。イメージ名がターゲットリージョンにすでに存在する場合、移行タスクはイメージ名にタスク ID を自動的に追加します。</li><li><strong>CVMインスタンス</strong>：移行先リージョン内のCVMインスタンスを移行先として選択します。<br>移行先インスタンス：移行先CVMインスタンスと移行元サーバーには同じOSを使用することをお勧めします。‍例えば、CentOS 7 移行元サーバーを移行する場合、移行先として CentOS 7 CVM を選択します。さらに、移行先CVMインスタンスのシステムディスクとデータディスクの容量は、移行元サーバーの容量よりも大きい必要があります。</li></ul></td>
</tr>
</tbody></table>
5. **「新規作成」をクリックして移行タスクを開始します。次のようなメッセージが表示されますので、ご注意ください。**
	- 移行元でタスクの実行が時間かかりますので、しばらく経ってからコンソールで進捗状況を確認できます。
	- 移行元サーバー環境の異常や誤った情報により移行元のインポートに失敗した場合、Tencent Cloudコンソールに失敗の原因を表示しない可能性があります。この場合、タスクを再作成するか、[オンライン移行]をご利用ください。

 

[](id:checkAfter)
### 手順‍3：移行後の確認
1. **移行状態と進行状況の確認**
正常に作成された移行タスクは自動的に実行されます。[移行元ページ](https://console.cloud.tencent.com/cvm/csm/online?rid=1)で移行元の情報を確認できます。また、[移行タスク](https://console.cloud.tencent.com/cvm/csm/online?rid=1&tab=tasks)ページでタスクの進行状況を確認できます。
 - 移行先がCVMの場合、移行開始後に移行先CVMは移行モードに入ります。移行を完了して移行モードが終了するまで、移行先CVMに対してシステムの再インストール、シャットダウン、破棄、パスワードのリセットなどの操作を行わないでください。
 - 移行先がCVMイメージの場合、移行開始後にアカウント下に` do_not_delete_csm_instance`という名前のリレーインスタンスが作成されます。移行が完了して、今回作成されたリレーインスタンスが自動的に破棄されるまで、リレーインスタンスに対してシステムの再インストール、シャットダウン、破棄、パスワードのリセットなどの操作を行わないでください。
2. **移行タスクの完了を待つ**
移行タスクのステータスが**成功**になると、移行処理が正常に完了したことを示します。下図に示すとおり：
![](https://qcloudimg.tencent-cloud.cn/raw/7beb11db18bd9913b44941dd05f8a4a4.png)
<dx-alert infotype="explain" title="">
- データ転送の消費時間は、移行元データのサイズ、ネットワーク帯域幅などの要因に左右されます。移行が完了するまでお待ちください。
- 移行タスクの開始後、移行タスクのある行で**一時停止**クリックすると、移行タスクを停止できます。
- 移行ツールはデータ転送の中断からの再開をサポートしています。タスクの一時停止後、**開始/リトライ**をクリックすると、前回一時停止したポイントから移行を継続できます。
- 移行タスクはデータ転送段階での一時停止のみサポートしています。コンソールでの移行タスク中に**一時停止**をクリックすると、移行ツールはデータ転送段階でデータの転送を一時停止します。
- 移行中に消費時間が長くなりすぎ、今回の移行を中止したい場合は、まず移行タスクを一時停止してから**削除**をクリックすると、今回の移行タスクをキャンセルすることができます。
</dx-alert>
3.　**移行後のチェック**
 - **移行に失敗した場合**：
- ログファイル（デフォルトでは移行ディレクトリ下のログファイル）に出力されている内容を確認し、操作ガイドまたは[サーバー移行に関するよくあるご質問](https://intl.cloud.tencent.com/document/product/213/32395)ドキュメントを参照し、問題のトラブルシューティングを行ってください。問題を解決した後、移行タスクの操作列で**開始/リトライ**をクリックすると、移行タスクを再開できます。
 - **移行に成功した場合**：
     - 移行先がCVMの場合は、移行先CVMが正常に起動できるか、移行先CVMのデータが移行元サーバーと一致しているか、ネットワークが正常か、他のシステムサービスが正常かなどを確認してください。
     移行先がCVMイメージの場合は、移行タスクのある行の「CVMイメージID」をクリックし、[CVMイメージページ](https://console.cloud.tencent.com/cvm/image/index)に進むとこのイメージの情報を確認でき、このイメージを使用してCVMインスタンスを作成することができます。

ご質問がある場合や移行エラーが発生した場合は、 [サービス移行に関するFAQ](https://intl.cloud.tencent.com/document/product/213/32395) を参照するか、[お問い合わせ]ください。      
