본 문서는 CPU 혹은 메모리의 이용률이 높아 Windows CVM에 로그인할 수 없을 때의 진단 방법 및 솔루션을 소개합니다.
>? 다음 작업 순서는 Windows server 2012 R2를 예로 들며, 운영 체제 버전에 따라 세부 작업 순서에 차이가 있습니다.

## 예상 원인

CPU 혹은 메모리의 사용률이 지나치게 높으면 서비스 응답 속도가 느려지거나 서버에 로그인할 수 없는 등의 문제가 발생할 수 있습니다. CPU 혹은 메모리의 사용률을 지나치게 높이는 요소에는 하드웨어, 시스템 프로세스, 비즈니스 프로세스, 트로이 목마 바이러스 등이 있습니다. [클라우드 모니터링](https://intl.cloud.tencent.com/document/product/248/32799)을 통해 CPU 사용률 임계 값 알림을 생성하여, CPU나 메모리의 사용률이 임계 값을 초과할 경우 즉시 사용자에게 공지하도록 설정할 수 있습니다.

## 진단 방향

1. CPU 혹은 메모리를 소모하는 세부 프로세스를 진단합니다.
2. CPU 혹은 메모리의 이용률이 높은 프로세스를 분석합니다.
 - 비정상적인 프로세스일 경우 트로이 목마와 같은 바이러스가 원인일 수 있으므로, 사용자는 프로세스를 자체 종료하거나 보안 프로그램을 사용하여 바이러스를 검출할 수 있습니다.
 - 비즈니스 프로세스일 경우 액세스량의 변화가 원인인지, 최적화 공간이 존재하는지 분석해야 합니다.
 - Tencent Cloud 모듈 프로세스일 경우, [티켓 제출](https://console.cloud.tencent.com/workorder/category)을 통해 당사에 문의하여 진단하시기 바랍니다.

## 진단 툴

- **작업 관리자**: Windows 자체의 응용 프로그램 및 프로세스 관리 툴로써, 실행 프로세스의 이름, CPU 부하, 메모리 사용, I/O 상태, 로그인된 사용자와 Windows 서비스 정보를 포함한 전반적인 컴퓨터 성능 및 실행 프로그램에 관한 정보를 보여줍니다.
- **프로세스**: 시스템에서 실행 중인 모든 프로세스의 목록입니다.
- **성능**: 전체적인 CPU 사용량과 사용 중인 메모리 등, 시스템 성능에 관한 전체적인 통계 정보입니다.
- **사용자**: 현재 시스템에 세션이 있는 모든 사용자입니다.
- **세부 정보**: 프로세스 탭의 상세 내용으로, 프로세스의 PID, 상태, CPU, 메모리 사용 현황 등 프로세스의 상세 정보를 표시합니다.
- **서비스**: 시스템 내의 모든 서비스를 보여줍니다(실행 중지된 서비스 포함).


## 장애 처리

### VNC 방식을 사용하여 CVM에 로그인
>?  CVM의 부하가 높으면 원격 연결을 구축하기 어려우므로, [VNC 방식을 사용하여 Windows 인스턴스에 로그인](https://intl.cloud.tencent.com/document/product/213/32496)하시길 권장합니다. 
>
1. [CVM 콘솔](https://console.cloud.tencent.com/cvm/index)에 로그인합니다.
2. 아래 이미지와 같이, 인스턴스 관리 페이지에서 타깃 CVM 인스턴스를 찾아 [로그인]을 클릭합니다.
![](https://main.qcloudimg.com/raw/d9ccf04da21f4ac86d624742c87d5628.png)
3. 팝업된 'Windows 인스턴스 로그인' 창에서 [기타 방식(VNC)]을 선택하고 [즉시 로그인]를 클릭하여 CVM에 로그인합니다.
4. 아래 이미지와 같이, 팝업된 로그인 창 왼쪽 상단의 '원격 명령어 전송'을 선택하고 **Ctrl-Alt-Delete**를 클릭해 시스템 로그인 인터페이스로 이동합니다.
![](https://main.qcloudimg.com/raw/5064251ea86085326e86884a1c13ef6b.png)

### 프로세서 이용률 현황 조회

1. 아래 이미지와 같이, CVM에서 '작업 표시줄'을 우클릭한 뒤 [작업 관리자]를 선택합니다.
![](https://main.qcloudimg.com/raw/a795f4948fae3eab8a44ec0a3a4ee352.png)
2. 아래 이미지와 같이, '작업 관리자'에서 리소스 이용률을 바로 확인할 수 있습니다.
>? CPU 혹은 메모리를 클릭하여 오름차순/내림차순으로 프로세스를 정렬할 수 있습니다.
>
![](https://main.qcloudimg.com/raw/56a4be427be5046a15a05b02abbacf66.png)

### 프로세스 분석

작업 관리자의 프로세스에 따라 문제를 분석 및 진단하고 적합한 솔루션을 채택합니다.
#### 대량의 CPU 혹은 메모리 리소스를 사용하는 프로세스가 시스템 프로세스일 경우
시스템 프로세스가 대량의 CPU 혹은 메모리 리소스를 사용하고 있을 경우, 아래의 내용을 진단하시기 바랍니다.
1. 프로세스 이름을 검사합니다.
 일부 바이러스는 svch0st.exe, explore.exe, iexplorer.exe 등 시스템 프로세스와 유사한 이름을 사용합니다.
2. 프로세스에 대응하는 파일의 위치를 점검합니다.
 시스템 프로세스는 일반적으로 `C:\Windows\System32` 디렉터리에 위치해 있으며, 완전한 서명 및 설명이 있습니다. 작업 관리자에서 프로세스를 우클릭한 뒤 [파일 위치 열기]를 선택하면 파일이 실행되는 자세한 위치를 조회할 수 있습니다.
 - 프로세스의 위치가 `C:\Windows\System32` 디렉터리에 있지 않다면, CVM이 바이러스에 감염되었을 가능성이 있으므로 보안 툴을 사용하거나 수동으로 바이러스를 검출하시기 바랍니다.
 - 프로세스의 위치가 `C:\Windows\System32` 디렉터리에 있다면, 시스템을 재시작하거나 안전하지만 불필요한 시스템 프로세스를 종료하시기 바랍니다.

자주 보는 시스템 프로세스는 다음과 같습니다.
 - System Idle Process: 시스템 유휴 시간 프로세스로, CPU 유휴 시간 백분율을 나타냅니다
 - system: 메모리 관리 프로세스
 - explorer: 바탕 화면 및 파일 관리
 - iexplore: Microsoft 브라우저
 - csrss: Microsoft 클라이언트/서버 실행 시의 서브 시스템
 - svchost: 시스템 프로세스로, DLL 실행에 사용됩니다
 - Taskmgr: 작업 관리자
 - Isass: 로컬 보안 권한 서비스

#### 대량의 CPU 혹은 메모리 리소스를 사용하는 프로세스가 비정상적인 프로세스일 경우
이름이 이상한 일부 프로세스가 대량의 CPU 혹은 메모리 리소스를 사용하고 있을 경우, xmr64.exe(채굴 바이러스) 등의 트로이 목마 바이러스 프로세스일 수 있습니다. 검색 엔진을 사용하여 해당 프로세스가 트로이 목마 바이러스 프로세스는 아닌지 확인하시기 바랍니다.
 - 트로이 목마 바이러스 프로세스가 맞다면, 보안 툴을 사용하여 바이러스를 검출하고, 필요에 따라 데이터를 백업한 다음 시스템을 재설치하시기 바랍니다.
 - 트로이 목마 바이러스 프로세스가 아니라면, 시스템을 재시작하거나 안전하고 불필요한 프로세스를 종료하시기 바랍니다.

#### 대량의 CPU 혹은 메모리 리소스를 사용하는 프로세스가 비즈니스 프로세스일 경우
대량의 CPU 혹은 메모리 리소스를 사용하는 프로세스가 IIS, HTTPD, PHP, Java 등의 비즈니스 프로세스일 경우 한 단계 더 분석할 것을 권장합니다.
예: 현재 비즈니스 양이 많은지 진단합니다.
- 비즈니스의 양이 많다면, [서버 구성 업그레이드](https://intl.cloud.tencent.com/document/product/213/2178)를 진행하시기 바랍니다. 서버 구성을 업그레이드하지 않으려면 비즈니스 프로세스에 최적화 공간이 있는지 확인하고 최적화하시기 바랍니다.
- 비즈니스의 양이 많지 않다면, 비즈니스 오류 리포트를 참고하여 잘못된 매개변수로 인해 리소스가 헛되이 소모되는 등의 문제가 생기지 않았는지 분석합니다.

#### 대량의 CPU 혹은 메모리 리소스를 사용하는 프로세스가 Tencent Cloud 모듈 프로세스일 경우

[티켓 제출](https://console.cloud.tencent.com/workorder/category)을 통해 당사에 문의하여 더 자세히 진단하시기 바랍니다.

