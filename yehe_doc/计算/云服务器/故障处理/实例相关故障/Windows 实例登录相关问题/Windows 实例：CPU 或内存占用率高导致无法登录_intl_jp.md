このドキュメントでは、CPUまたはメモリの使用率が高いため、Windows CVMにログインできない問題のトラブルシューティングと対処方法について説明します。
>? 以下の操作手順はWindows server 2012 R2を例に説明します。OSのバージョンによって操作手順の詳細が若干異なります。

## 考えられる原因

CPUまたはメモリの使用率が高すぎると、サービスのレスポンスが遅くなるや、CVMにログインできないなどの問題が発生します。ハードウェア、システムプロセス、サービスプロセス、トロイの木馬などに起因する可能性があります。[クラウドモニター](https://intl.cloud.tencent.com/document/product/248/32799)を利用して、CPUまたはメモリ使用率のアラームしきい値を作成し、しきい値を超えると、リアルタイムにユーザーに通知することができます。

## トラブルシューティング

1. CPUまたはメモリの使用率が高くなるプロセスを特定します。
2. CPUまたはメモリの使用率が高くなるプロセスを分析します。
 - 異常なプロセスである場合は、ウイルスまたはトロイの木馬が原因である可能性があります。この場合、プロセスを終了するか、セキュリティソフトを使用してシステムをスキャンします。
 - サービスプロセスの場合は、アクセスボリュームの変更が原因でCPUまたはメモリの使用率が高くなっていること、および最適化できるかどうかを確認します。
 - Tencent Cloudコンポーネントプロセスの場合、[チケットを送信](https://console.cloud.tencent.com/workorder/category)してください。

## ツール

**タスクマネージャー**：これは、Microsoft Windows OSでアプリケーションとプロセスを管理するためのツールです。実行中のプロセスの名前、CPU負荷、メモリ使用量、I/Oの詳細、ログインしているユーザー、Windowsサービスなど、コンピューターのパフォーマンスと実行中のソフトウェアに関する情報を提供します。
- **プロセス**：システムで実行中のプロセスの一覧です。　
- **パフォーマンス**：システムのパフォーマンスに関する全体の統計です。例とえば、全体的なCPU使用量とメモリ使用率。
- **ユーザー**：システムでセッションを持つすべてのユーザーです。
- **詳細**：PID、ステータス、CPU使用率、メモリ使用量などの情報を含む、実行中のプロセスの詳細情報を提供します。
- **サービス**：システムのすべてのサービス（実行されていないービスも含む）です。


## ソリューション

### VNCを使用してCVMインスタンスにログインする
>?  CPUまたはメモリの使用率が高いためにCVMインスタンスにログインできない場合は、[VNCを使用してWindowsインスタンスにログインする]（https://intl.cloud.tencent.com/document/product/213/32496）ことをお勧めします 
>
1. [CVMコンソール](https://console.cloud.tencent.com/cvm/index)にログインします。
2. インスタンスの管理ページで、下図に示すように、対象のCVMインスタンスを見つけて、【ログイン】をクリックします。
![](https://main.qcloudimg.com/raw/d9ccf04da21f4ac86d624742c87d5628.png)
3. ポップアップされた 「Windowsインスタンスにログインする」画面で、【その他の方式(VNC）】を選択し、【すぐにログインする】をクリックして、CVMにログインします。
4. ポップアップされたログインウィンドウで、下図に示すように、左上の「Send CtrlAltDe」を選択し、**Ctrl-Alt-Delete**  をクリックすると、システムログイン画面に入ります。
![](https://main.qcloudimg.com/raw/5064251ea86085326e86884a1c13ef6b.png)

### プロセスのリソース使用状況を確認する

1. CVMで、下図に示すように、「タスクバー」を右クリックして、【タスクマネージャー】を選択します。
![](https://main.qcloudimg.com/raw/a795f4948fae3eab8a44ec0a3a4ee352.png)
2. 開かれた「タスクマネージャー」で、下図に示すように、リソース使用状況を確認できます。
>?  CPUまたはメモリをクリックして、プロセスを昇順/降順で並べ替えます。
>
![](https://main.qcloudimg.com/raw/56a4be427be5046a15a05b02abbacf66.png)

### プロセスを分析する

タスクマネージャーでプロセスを分析して原因を特定し、適切な対策を講じます。
#### CPUやメモリリソースを大量に消費しているプロセスはシステムプロセスの場合　
システムプロセスがCPUまたはメモリリソースを大量に消費していることが判明した場合は、以下の内容をご確認ください。
1. プロセス名を確認する。
 一部の悪意のあるプログラムは、svch0st.exe、explore.exe、iexplorer.exeなどのシステムプロセスに類似した名前を使用することがあります。
2. プロセスの実行可能ファイルのパスを確認します。
 ステムプロセスの実行可能ファイルは通常 `C:\Windows\System32` ディレクトリにあり、有効な署名と説明があります。タスクマネージャで表示するプロセスを右クリックし、【ファイルの場所を開く】を選択して、特定の実行可能ファイルの場所（`svchost.exe`など）を表示できます。
 - 実行可能ファイルが `C:\Windows\System32` ディレクトリに配置されていない場合、CVMインスタンスがウイルスに感染している可能性があります。この場合、手動またはセキュリティソフトを使用してウイルスを検出し、駆除してください。
 - 実行可能ファイルが `C:\Windows\System32` ディレクトリにある場合は、システムを再起動するか、安全だが不要なシステムプロセスを終了します。

通常のシステムプロセスは次のとおりです。
 - System Idle Process：システムアイドルプロセス。CPUがアイドル状態である時間の割合を表示します。
 - system：メモリ管理プロセスを示します。
 - explorer：デスクトップとファイル管理プロセスを示します。
 - iexplore：Microsoft Internet Explorerのプロセスを示します。
 - csrss：Microsoftクライアント/サーバー上のランタイムサブシステムを示します。
 - svchost：DLLを実行するためのシステムプロセスを示します。
 - Taskmgr：タスクマネージャーを示します。
 - Isass：ローカルセキュリティ権限サービスを示します。

#### CPUまたはメモリリソースを大量に消費しているプロセスは異常なプロセスの場合
xmr64.exe（マイニングウイルス）などの見慣れない名前のプロセスがCPUまたはメモリリソースを大量に消費している場合は、CVMインスタンスがウイルスやトロイの木馬に感染している可能性があります。この場合、検索エンジンを使用して、トロイの木馬ウイルスプロセスかどうかを検索・確認することをお勧めします。　
 - プロセスがウイルスまたはトロイの木馬の場合は、セキュリティソフトを使用してスキャン・駆除して、必要に応じて、データをバックアップし、OSを再インストールしてください。
 - プロセスがウイルスやトロイの木馬でない場合は、システムを再起動するか、安全だが不要なプロセスを終了してください。

#### CPUまたはメモリリソースを大量に消費しているプロセスはサービスプロセスの場合
CPU使用率が高いプロセスは、お客様のサービスプロセスである場合、例えば：IIS、HTTPD、PHPとJava など、さらに分析することをお勧めします。
たとえば、現在のサービス負荷が大きいかどうかを判断します。
- ビジネス負荷が大きい場合は、[サーバー構成をアップグレード](https://intl.cloud.tencent.com/document/product/213/2178)することをお勧めします。サーバー構成をアップグレードしない場合は、サービスプログラムを最適化する可能性を検討して、最適化してください。
- ビジネス負荷が少ない場合は、サービスエラーログをさらに分析する必要があります。たとえば、不適切なパラメータ設定によりリソースが無駄になっていないかどうかを確認します。

#### CPUまたはメモリリソースを大量に消費しているプロセスはTencent Cloudコンポーネントプロセスの場合

[チケットを送信](https://console.cloud.tencent.com/workorder/category)して特定・対処方法について、お問い合わせください。

