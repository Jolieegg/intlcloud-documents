

このドキュメントでは主にWindowsインスタンスに接続できない場合のトラブルシューティング方法と、Windowsインスタンスに接続できない主な原因について解説し、問題のトラブルシューティング、特定および解決について説明します。

## 考えられる原因
Windowsインスタンスにログインできない主な原因：
- [パスワードの問題によりログインできない](#CryptographicProblem)
- [帯域幅利用率が高すぎる](#BandwidthUtilization)
- [サーバー負荷が高い](#HighServerLoad)
- [リモートポート設定の異常](#RemotePortConfiguration)
- [セキュリティグループルールが不適切](#SafetyGroupRule)
- [ファイアウォールまたはセキュリティソフトによるログインの異常](#LoginSecuritySoftware)
- [リモートデスクトップ接続における認証エラー](#AuthenticationError)

## 自己診断ツールの使用

Tencent Cloudは、Windowsインスタンスに接続できない原因が、帯域幅、ファイアウォールおよびセキュリティグループの設定などの一般的な問題かどうかを判断するのに役立つ自己診断ツールを提供しています。 障害の70％はツールで特定でき、検出された問題をもとにログインできない原因となっている可能性のある障害を特定できます。
1. [セルフチェック](https://console.cloud.tencent.com/workorder/check)をクリックし 、自己診断ツールを開きます。
2. ツールインターフェースのプロンプトに基づき、診断したいCVMを選択し、**検出開始**をクリックします。

トラブルシューティングツールによって確認できない問題については、CVMに[VNC方式でログイン](#VNC)し、段階ごとにトラブルシューティングを実施することをお勧めします。


## 障害処理[](id:TroubleshootingIdeas)


### VNC 方式を介したログイン[](id:VNC)

RDPまたはリモートログインソフトウェアを使用してWindowsインスタンスにログインできない場合は、Tencent Cloud VNC方式でログインし、障害の原因特定に役立てることができます。
1. [Tencent Cloudコンソール](https://console.cloud.tencent.com/cvm/index)にログインします。
2. 下図のように、インスタンスの管理画面で、ログインしたいインスタンスを選択し、**ログイン**をクリックします。
![](https://main.qcloudimg.com/raw/d9ccf04da21f4ac86d624742c87d5628.png)
3. ポップアップした「標準ログイン | Windowsインスタンス」ウィンドウで、**VNCログイン**を選択します。
<dx-alert infotype="explain" title="">
ログイン中に、パスワードを忘れた場合は、コンソールでこのインスタンスのパスワードをリセットできます。具体的な操作については、[インスタンスのパスワードをリセット](https://intl.cloud.tencent.com/document/product/213/16566)ドキュメントをご参照ください。
</dx-alert>
4. 下図のように、ポップアップしたログインウィンドウで、左上の「リモートコマンドの送信」を選択し、 Ctrl-Alt-Deleteをクリックしてシステムログイン画面に進みます。
![](https://main.qcloudimg.com/raw/5064251ea86085326e86884a1c13ef6b.png)



### パスワードの問題によりログインできない[](id:CryptographicProblem)

**障害事象**：パスワードの入力ミス、パスワードを忘れた、パスワードのリセットに失敗したなどの理由で正常にログインできない。
**処理手順**：[Tencent Cloudコンソール](https://console.cloud.tencent.com/cvm/index)でインスタンスのパスワードをリセットし、インスタンスを再起動してください。詳細については、[インスタンスのパスワードをリセット](https://intl.cloud.tencent.com/document/product/213/16566)ドキュメントをご参照ください。



### 帯域幅利用率が高すぎる[](id:BandwidthUtilization)

**障害事象**：自己診断ツールによって、帯域幅利用率が高すぎることが問題だと表示された。
**処理手順**：
1. [VNCログイン](#VNC)によってインスタンスにログインします。
2. [帯域幅の利用率が高いためログインできない](https://intl.cloud.tencent.com/document/product/213/32542)ドキュメントを参照し、インスタンスの帯域幅使用状況および障害の処理について確認します。


### サーバー負荷が高い[](id:HighServerLoad)

**障害事象**：セルフチェックツールまたはTCOPによって、サーバーのCPU負荷が高いためにシステムがリモート接続できなくなっている、またはアクセスが非常に遅くなっていると表示された。
**考えられる原因**：ウイルスやトロイの木馬、サードパーティ製のウイルス対策ソフト、アプリケーションプログラムの異常、ドライバーの異常、またはソフトウェアのバックエンドでの自動更新によってCPU占有率が高くなり、CVMにログインできない、またはアクセスが遅いといった問題が発生している。
**処理手順**：
1. [VNCログイン](#VNC)によってインスタンスにログインします。
2. [Windowsインスタンス：CPUとメモリ占用率が高いため、ログインできない](https://intl.cloud.tencent.com/document/product/213/32405)ドキュメントを参照し、「タスクマネージャー」で負荷の高いプロセスを特定します。


### リモートポート設定の異常[](id:RemotePortConfiguration)

**障害事象**：リモート接続ができない、リモートアクセスポートがデフォルトのポートではない、変更されている、またはポート3389が開かない。
**問題特定の考え方**：pingをインスタンスのパブリックIPに通すことができるかどうか。telnetコマンドによってポートが開いているかどうかをテストする。
**処理手順**：具体的な操作については、[ポート問題が原因でリモートログインできない](https://intl.cloud.tencent.com/document/product/213/32540)ドキュメントをご参照ください。


### セキュリティグループルールが不適切[](id:SafetyGroupRule)

**障害事象**：セルフチェックツールでのチェックの結果、セキュリティグループルールが不適切なためにログインできないことがわかった。
**処理手順**：[セキュリティグループ（ポート）検証ツール](https://console.cloud.tencent.com/vpc/helper) によってチェックを行います。
<dx-alert infotype="notice" title="">
Windowsインスタンスへのリモートログインにはポート3389の開放が必要です。
</dx-alert>
<img src="https://main.qcloudimg.com/raw/bd91ec53dfd0df6bd1127a7f4f9db35c.png"/><br>
-セキュリティグループルールのカスタム設定を行いたい場合は、<a href="https://intl.cloud.tencent.com/document/product/213/34272">セキュリティグループルールの追加</a>をご参照の上、セキュリティグループルールを再設定してください。



### ファイアウォールまたはセキュリティソフトによるログインの異常[](id:LoginSecuritySoftware)

**障害事象**：CVMファイアウォールの設定またはセキュリティソフトによるログインの異常。
**問題特定の考え方**：VNCログイン方法でWindowsインスタンスにログインし、サーバー内でファイアウォールが有効になっているか、360、Safedogなどのセキュリティソフトをインストールしているかどうかをチェックする。
<dx-alert infotype="notice" title="">
この操作はCVMファイアウォールの無効化を伴います。ご自身にこの操作を実行する権限があるかどうかをご確認ください。
</dx-alert>

**処理手順**：ファイアウォールまたはインストールされているセキュリティソフトを無効化してからリモート接続をリトライし、リモートログインに成功するかどうかを確認します。以下の操作は Windows Server 2016インスタンスのファイアウォールの無効化を例に説明します。
1. [VNCログイン](#VNC)によってインスタンスにログインします。
2. OSの画面で、<img src="https://main.qcloudimg.com/raw/6e36af2ceb4604b81de13cb42f30e859.png" style="margin:-3px 0px;"></img>をクリックし、**コントロールパネル**を選択し、コントロールパネルウィンドウを開きます。
3. **Windowsファイアウォール**をクリックし、「Windowsファイアウォール」画面に進みます。
4. 左側の**Windowsファイアウォールの有効化または無効化**をクリックし、「設定のカスタマイズ」画面に進みます。
5. 「プライベートネットワークの設定」と「パブリックネットワークの設定」を「Windowsファイアウォールを無効にする」に設定し、**OK**をクリックします。
6. インスタンスを再起動してリモート接続をリトライし、リモートログインに成功するかどうかを確認します。


### リモートデスクトップ接続における認証エラー[](id:AuthenticationError)

**障害事象**：リモートデスクトップを使用したWindowsインスタンスへの接続とログイン時に、「認証エラーが発生しました。関数に提供されたトークンは無効です」または「認証エラーが発生しました。要求された関数はサポートされていません」というエラーが発生する。
**問題の原因**：Microsoftは2018年3月にセキュリティ更新をリリースしました。この更新はCredential Security Support Providerプロトコル（CredSSP）に基づいてID認証の過程でリクエストを検証する方法によって、CredSSPに存在する、リモートでコードが実行される脆弱性を修正するものです。この更新はクライアントとサーバーの両方にインストールする必要があり、そうしなければ「問題の説明」のような状況が発生する可能性があります。
**処理手順**：セキュリティ更新をインストールする方法で対処することを推奨します。具体的には、[Windowsインスタンス：認証エラーが発生した](https://intl.cloud.tencent.com/document/product/213/32421)ドキュメントをご参照ください。

## その他の対処方法
上述のトラブルシューティングを行っても、Windowsインスタンスに接続できない場合は、セルフチェック結果を保存し、[チケットを提出](https://console.intl.cloud.tencent.com/workorder/category)してフィードバックしてください。
