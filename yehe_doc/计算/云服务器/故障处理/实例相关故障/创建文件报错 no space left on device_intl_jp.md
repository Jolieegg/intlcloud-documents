##故障について
Linux CVMで新しいファイルを作成するときに、「no space left on device」のエラーが発生する。


## 考えられる原因
- ディスク容量が満杯
- ファイルシステム`inode`が満杯
-  df duが不一致
 - ファイルを削除済みだが、対応するファイルハンドラを持つプロセスがまだ残っており、ディスク容量がかなりの間リリースされていない。
 - mountマウントネスト。例えば、システムディスクの`/data`ディレクトリが大容量を使用し、さらに`/data`をマウントポイントとしてその他のデータディスクにマウントすると、システムディスクでdf duが一致しない場合がある。


## ソリューション
[処理方法](#ProcessingSteps) を参照し、問題を調査および解決してください。


## 処理方法[](id:ProcessingSteps)

### ディスク容量が満杯の問題を解決
1. CVMにログインします。詳細については、[標準ログイン方式を使用してLinuxインスタンスにログイン](https://intl.cloud.tencent.com/document/product/213/5436)をご参照ください。
2. [](id:Step2)で以下のコマンドを実行し、ハードディスク使用率を確認します。
```
df -h
```
3. ハードディスク使用率の高いマウントポイントを特定し、さらに以下のコマンドを実行してそのマウントポイントに入ります。
```
cd対応マウントポイント
```
例えば、cdシステムディスクマウントポイントが必要な場合、 `cd /`を実行します。
4. 以下のコマンドを実行し、使用容量の大きいディレクトリを検索します。
```
du -x --max-depth=1 | sort -n
```
使用容量最大を検知したディレクトリの容量状況に応じて、以下の手順を実行します。
   - ディレクトリ容量がハードディスク総容量より大幅に低い場合、[df duが不一致の問題を解決](#dfdu) 手順を参照して引き続き問題を調査してください。
   - ディレクトリ容量が大きい場合、[手順2](#Step2)を実行して使用容量が大きいファイルを特定し、総合的なビジネス状況により削除するかどうかを評価してください。削除できない場合、[CBS拡張](https://intl.cloud.tencent.com/document/product/213/32377)からハードディスクストレージ容量を拡張してください。


### ファイルシステムinodeが満杯の問題を解決
1. CVMにログインします。詳細については、[標準ログイン方式を使用してLinuxインスタンスにログイン](https://intl.cloud.tencent.com/document/product/213/5436)をご参照ください。
2. [](id:Step2)で以下のコマンドを実行し、ハードディスク使用率を確認します。
```
df -h
```
3. ハードディスク使用率の高いマウントポイントを特定し、さらに以下のコマンドを実行してそのマウントポイントに入ります。
```
cd対応マウントポイント
```
例えば、cdシステムディスクマウントポイントが必要な場合、 `cd /`を実行します。
4. 以下のコマンドを実行し、ファイル個数が最多のディレクトリを検索し、この問題を解決します。このコマンドは時間がかかるため、少々お待ちください。
```
find / -type f | awk -F / -v OFS=/ '{$NF="";dir[$0]++}END{for(i in dir)print dir[i]" "i}' | sort -k1 -nr | head
```


### df duが不一致という問題を解決[](id:dfdu)

#### プロセスがファイルハンドラを占用する問題を解決
以下のコマンドを実行し、占用しているファイルのプロセスを確認します。
```
lsof | grep delete
```
リターン結果に応じて、以下の手順を実行します。
 - kill対応プロセス。
 - サービスを再起動します。
 - ファイルハンドラを占用するプロセスが多い場合、サーバーを再起動することができます。


#### mountマウントネストの問題を解決
1. mountコマンドを実行し、使用容量が大きい磁気ディスクを`/mnt`にマウントします。例：
```
mount /dev/vda1 /mnt
```
2. 以下のコマンドを実行し、`/mnt`に入ります。
```
cd /mnt
```
3. 以下のコマンドを実行し、使用容量の大きいディレクトリを検索します。
```
du -x --max-depth=1 | sort -n
```
リターン結果に応じて、総合的なビジネス状況によりディレクトリまたはファイルを削除するかどうかを評価します。
4. umountコマンドを実行し、磁気ディスクをマウント解除します。例：
```
umount /mnt
```
