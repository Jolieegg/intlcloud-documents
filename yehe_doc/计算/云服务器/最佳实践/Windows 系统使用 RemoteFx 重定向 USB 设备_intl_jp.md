## ユースケース

RemoteFxは、Windows デスクトッププロトコル（RDP）のアップグレード版です。RDP8.0以降は、RemoteFxを使用して、RDPデータチャネルを介してローカルUSBデバイスをリモートデスクトップにリダイレクトして、CVMがUSBデバイスを使用できない問題を解決できます。

このドキュメントでは、次の環境バージョンを例として、RDPのRemoteFx USBリダイレクト機能を有効にしてUSBデバイスをCVMにリダイレクトする方法を説明します。
- クライアント：Windows 10 OS
- サーバー：Windows Server 2016 OS

## 使用制限

RDP 8.0以降のバージョンは、RemoteFX USB Redirection機能をサポートしているため、Windows 8、Windows 10、Windows Server 2016、およびWindows Server 2019がこの機能をサポートしています。ローカルPCのOSバージョンが上記のバージョンのいずれかである場合、RDP 8.0 Updateパッチをインストールする必要はありません。ローカルPCのOSバージョンがWindows 7またはWindows Vistaの場合は、[マイクロソフトの公式Webサイト](https://support.microsoft.com/en-us) にアクセスして、RDP 8.0更新パッチを入手してインストールしてください。


## 操作手順

### サーバーを設定する

1. [RDPファイルを利用してWindowsインスタンスにログインする（推奨）](https://intl.cloud.tencent.com/document/product/213/5435)
2. OSの画面で、<img src="https://main.qcloudimg.com/raw/ab9a3a22baf69f63a90a43476f12db94.png" style="margin: 0;"></img>をクリックして、【サーバーマネージャー】を選択して、サーバーマネージャーを開きます。
3. 「サーバーマネージャー」画面で、次の図に示すように、【役割と機能の追加】をクリックします。
![](https://main.qcloudimg.com/raw/518287dced9ccc1de01cbf73315f70d1.png)
4. ポップアップされた「役割と機能の追加ウィザード」画面で、【次へ】をクリックして、「インストールの種類を選択」画面に入ります。
5. 「インストールの種類を選択」画面で、【役割ベースまたは機能ベースのインストール】を選択して、【次へ】をクリックします。
6. 「対象サーバーの選択」画面で、デフォルト設定のままにして、【次へ】をクリックします。
7. 「サーバーのロールを選択」画面で、次の図に示すように、【リモートデスクトップサービス】を選択し、【次へ】をクリックします。
![](https://main.qcloudimg.com/raw/05868c877afe2e6043e34e54c023408e.png)
8. デフォルト設定のままにして、【次へ】を2回クリックします。
9. 「役割サービスの選択」画面で、次の図に示すように、【リモートデスクトップセッションホスト】、【リモートデスクトップ接続ブローカー】、および【リモートデスクトップライセンス】にチェックをいれて、ポップアップされた画面で【機能の追加】をクリックします。
![](https://main.qcloudimg.com/raw/efc41c3d8c5b54d27664772587261460.png)
10. 【次へ】をクリックします。
11. 【インストール】をクリックします。
13. インストールが完了すると、CVMを再起動します。
14. OS画面で、<img src="https://main.qcloudimg.com/raw/330624bafb194914948c8ebd9e47334d.png" style="margin: 0;"></img>をクリックし、**gpedit.msc**を入力して、**Enter**キーを押して、「ローカルグループポリシーエディター」を開きます。
15. 左側のナビゲーションツリーで、次の図に示すように、【コンピューターの設定】>【管理用テンプレート】>【Windowsコンポーネント】>【リモートデスクトップサービス】> 【リモートデスクトップセッションホスト】>【デバイスとリソースのリダイレクト】を選択し、【サポートされているプラグ アンド プレイ デバイスのリダイレクトを許可しない】をダブルクリックして開きます。
![](https://main.qcloudimg.com/raw/a812e4da0f4435b2ca351b286e283b2e.png)
16. ポップアップされた画面で、次の図に示すように、【無効】を選択し、【OK】をクリックします。
![](https://main.qcloudimg.com/raw/e9f02b468e39d2b78365514f91cb13d1.png)
17. CVMを再起動します。


### クライアントを設定する

1. ローカルコンピュータで、<img src="https://main.qcloudimg.com/raw/6e36af2ceb4604b81de13cb42f30e859.png" style="margin: 0;"></img>を右クリックし、【実行】を選択し、実行ダイアログボックスを開きます。
2. 実行ダイアログボックスで**gpedit.msc**と入力し、【OK】をクリックして「ローカルグループポリシーエディター」を開きます。
3. 左側のナビゲーションツリーで、次の図に示すように、【コンピューターの設定】>【管理用テンプレート】>【Windowsコンポーネント】>【リモートデスクトップサービス】> 【リモートデスクトップセッションホスト】> 【RemoteFx USBデバイスリダイレクト】を選択します。【サポートされている他の RemoteFX USB デバイスの、このコンピューターからの RDP リダイレクトを許可する】をダブルクリックして開きます。
![](https://main.qcloudimg.com/raw/760b413ec2fb3aec917716556875a99f.png)
4. ポップアップされた画面で、次の図に示すように、【有効】を選択し、RemoteFx USBリダイレクトのアクセス権限を【管理者とユーザー】に設定します。
![](https://main.qcloudimg.com/raw/a34da80ec13c8c041662b2c1142c931e.png)
5. 【OK】をクリックします。
6. ローカルPCを再起動します。

### 設定結果を確認する

1. ローカルPCで、USBデバイスを挿入し、<img src="https://main.qcloudimg.com/raw/6e36af2ceb4604b81de13cb42f30e859.png" style="margin: 0;"></img>を右クリックして、【実行】を選択して、実行ダイアログボックスを開きます。
2. 実行ダイアログで、次の図に示すように、**mstsc**と入力し、**Enter**キーを押して、リモートデスクトップ接続ダイアログボックスを開きます。
![](https://main.qcloudimg.com/raw/107284ef6b3548585f0598f419ec7b98.png)
3. 【コンピュータ】の後に、WindowsサーバーのパブリックIPアドレスを入力し、【オプション】をクリックします。
4. 【ローカルリソース】タブを選択し、「ローカルデバイスとリソース」列の【詳細】をクリックして、次の図に示すように、ローカルデバイスとリソースの画面が表示されます。
![](https://main.qcloudimg.com/raw/ab14993dae9d7c7bf22b9443c5badc13.png)
5. ポップアップされたローカルデバイスとリソースの画面で、【その他のサポートされているRemoteFX USBデバイス】を展開し、挿入されたUSBデバイスを選択して、【OK】をクリックします。
![](https://main.qcloudimg.com/raw/9c86c1ad14906f4e2566a26eceaf91de.png)
6. 【接続】をクリックします。
7. ポップアップされた「Windowsセキュリティ」画面で、次の図に示すように、インスタンスの管理者アカウントとパスワードを入力します。
![](https://main.qcloudimg.com/raw/0a0ffbf1f09c8bac278d97adb9e5ac96.png)
8.【OK】をクリックして、Windowsインスタンスにログインします。
Windows インスタンスの操作画面の上部に<img src="https://main.qcloudimg.com/raw/73fe2b3cfa740517e44e4596a222840a.png" style="margin: 0;"></img>が表示されると、設定が成功したことを示します。
![](https://main.qcloudimg.com/raw/751a4e2204cc38a0769116732c464789.png)


## 関連操作

Windows RDPプロトコルは、一般的に使用されるUSBデバイスに対してより最適化された接続パフォーマンスを提供できます。つまり、RemoteFx機能を有効にすることなく、ドライブやカメラなどのデバイスを直接マッピングできます。よく使われていないUSBデバイスは、RemoteFX USBリダイレクト機能によってのみ実現できます。よく使われていないUSBデバイスは、以下を参照して、対応するリダイレクト方法を選択できます。
![](https://main.qcloudimg.com/raw/715de06c08753eefe6e4ff5cc3bca270.png)

