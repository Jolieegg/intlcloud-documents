## Overview
Fair Scheduler allocates resources fairly to each job on YARN based on weight.
## Definitions
- Configuration Set: Specifies the resource assignment among active resource pools during a specified period.
- Execution Plan: Specifies when the configuration set will be active.
- Placement Rule: Automatically allocates jobs submitted by different users to specified resource pools.
- User Limits: Specifies the maximum number of applications that can be submitted by a user at a time.

## Directions
### Creating a resource pool
1. Log in to the [EMR console](https://console.cloud.tencent.com/emr) and click **Details** of the target Hadoop cluster in the cluster list to enter the cluster details page.
2. On the cluster details page, select **Cluster services** and click **Operation** > **Resource scheduling** in the top-right corner of the YARN component block to enter the **Resource scheduling** page.
![](https://qcloudimg.tencent-cloud.cn/raw/3a9562b5fda7bc120b9acd49439df0ae.png)
3. Toggle on **Resource scheduler** and configure the scheduler.
![](https://qcloudimg.tencent-cloud.cn/raw/1a933147979aeacae6842b98a7f376c1.png)
4. Create a resource pool for Fair Scheduler.
Select **Fair Scheduler**. On the displayed page, click **Create resource pool**. You can edit, clone, and delete an existing resource pool as well as create a subpool for it.
![](https://qcloudimg.tencent-cloud.cn/raw/0c658f61e62b58c27020d8c1ad87fd82.png)
**Fields and parameters**:
<table>
<thead>
<tr>
<th>Field</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Resource Pool Name</td>
<td>name</td>
<td>Name of the resource pool or queue. It can contain only letters, digits, hyphens, and underscores and cannot start with a hyphen or underscore.</td>
</tr>
<tr>
<td>Parent Pool</td>
<td>The value of `type` is `parent`.</td>
<td>Means that although the resource pool has no subpools, it is not a leaf node. A parent pool cannot have subpools in Hadoop v2.8 and later.</td>
</tr>
<tr>
<td>Configuration Set</td>
<td>None</td>
<td>YARN does not have this parameter, which means a collection of scheduled tasks.</td>
</tr>
<tr>
<td>Weight</td>
<td>weight</td>
<td>Percentage of resources in the parent pool. A greater weight means more resources allocated.</td>
</tr>
<tr>
<td>Min Resources</td>
<td>minResources</td>
<td>The minimum amount of resources guaranteed. When the minimum amount of resources guaranteed for a queue is not met, it has a higher priority than other queues at the same level to obtain resources.</td>
</tr>
<tr>
<td>Max Resources</td>
<td>maxResources</td>
<td>The maximum amount of resources that can be used. The amount of resources available for each queue cannot exceed this value.</td>
</tr>
<tr>
<td>Max Concurrent Running Apps</td>
<td>maxRunningApps</td>
<td>The maximum number of concurrent running applications allowed. This limitation can prevent intermediate outputs generated by excessive concurrent running map tasks from filling up the disks.</td>
</tr>
<tr>
<td>Max Share for App Master</td>
<td>maxAMShare</td>
<td>The maximum percentage of resources that can be used to run Application Master. This attribute only applies to leaf queues.</td>
</tr>
<tr>
<td>Scheduling Policy</td>
<td>schedulingPolicy</td>
<td>You can set a scheduling policy for any queue. Valid values include `Fifo`, `Fair`, and `Drf`. If the value is `Fifo` or `Fair`, only memory is taken into account in resource allocation. If `Drf`, both memory and the number of cores are taken into account.</td>
</tr>
<tr>
<td>Preemption Mode</td>
<td>allowPreemptionFrom</td>
<td>This field applies only to Hadoop v3.x and later. In v2.x, you can only configure `yarn.scheduler.fair.preemption` to set the preemption mode.</td>
</tr>
<tr>
<td>Fair Share Preemption Threshold</td>
<td>fairSharePreemptionThreshold</td>
<td>The fair share preemption threshold for the queue. If the queue waits `fairSharePreemptionTimeout` without receiving `fairSharePreemptionThreshold*fairShare` resources, it is allowed to preempt resources from other queues. If this field is not set, the queue will inherit the value from its parent queue.</td>
</tr>
<tr>
<td>Fair Share Preemption Timeout</td>
<td>fairSharePreemptionTimeout</td>
<td>Number of seconds the queue is under its fair share threshold before it will try to preempt resources from other queues. If this field is not set, the queue will inherit the value from its parent queue.</td>
</tr>
<tr>
<td>Min Share Preemption Timeout</td>
<td>minSharePreemptionTimeout</td>
<td>Number of seconds the queue is under its minimum share before it will try to preempt resources from other queues. If this field is not set, the queue will inherit the value from its parent queue.</td>
</tr>
<tr>
<td>Submission</td>
<td>aclSubmitApps</td>
<td>List of users that can submit apps to the queue</td>
</tr>
<tr>
<td>Management</td>
<td>aclAdministerApps</td>
<td>List of users that can manage the queue</td>
</tr>
</tbody></table>


### Configuring an execution plan
1. In the **Policy settings** section, click **Execution plans** > **Create execution plan** to create an execution plan.
**Configuration set status** indicates whether the execution plan is enabled, which defaults to "Enabled". When you don't want to enable an execution plan but still want to retain the configuration set, you can set the plan status to "Disabled".
2. In the **Create execution plan** window, select/enter the **Configuration set**, **Name**, and **Plan validity**.
![](https://qcloudimg.tencent-cloud.cn/raw/d45fef031c88783c0b06ee33260ea486.png)

### Sample configuration set
1. Log in to the [EMR console](https://console.cloud.tencent.com/emr) and click **Details** of the target Hadoop cluster in the cluster list to enter the cluster details page.
2. On the cluster details page, select **Cluster services** and click **Operation** > **Resource scheduling** in the top-right corner of the YARN component block to go to the **Resource scheduling** page.
3. Toggle on **Resource scheduler** and select **Fair Scheduler**.
4. Click **Create resource pool** and configure parameters as needed.
![](https://qcloudimg.tencent-cloud.cn/raw/f7b0f75b338f84cb4d73d7c5b06b30f1.png)
5. On the **Resource Scheduling** page, click **Execution Plans** > **Create Execution Plan** and adjust the **Plan Validity** as needed.
>? If scheduled scale-out is configured for the EMR cluster, we recommend you set the **Plan Validity** to a time period after the scheduled scale-out.
>
![](https://qcloudimg.tencent-cloud.cn/raw/e372d4e3e821c00237e89c8b1182909e.png)
![](https://qcloudimg.tencent-cloud.cn/raw/89318116a64fcfadca1aca35ff2b9745.png)
6. On the **Resource Scheduling** page, click **Resource Pools** and select an item from the **Configuration Set** drop-down list.
>? The resource limits of a resource pool can be configured by configuration set.
>
![](https://qcloudimg.tencent-cloud.cn/raw/6242338ea9ba5dee55b78f06dbe9c8b9.png)
7. Select the created resource pool from **Configuration Set** and adjust the **Resource Limits** as needed.
![](https://qcloudimg.tencent-cloud.cn/raw/476912683296aa9dc28007b4794c0fc8.png)
![](https://qcloudimg.tencent-cloud.cn/raw/c5a4ccb6eabee693c2539b9fa78d8e7d.png)
![](https://qcloudimg.tencent-cloud.cn/raw/0bdf077e98540416cb104b78a647a559.png)
8. After the resource pool adjustment, click **Apply** to make the settings effective.


### Configuring a placement rule
In the **Policy settings** section, click **Placement rules** > **Create placement rule** to create a placement rule.
![](https://qcloudimg.tencent-cloud.cn/raw/acb45a79294f2ad650e28849c6644d6a.png)
Set **Placement type** and **Pool name**.
![](https://qcloudimg.tencent-cloud.cn/raw/d3cdc014b72b1490cfdf9ec63af822f7.png)
**Configuration rule type description:**
**root.[pool name]**: The rule always needs to be met and applies when other rules do not match. Therefore, it needs to be placed after others.
**root.[pool name].[username]**: The rule checks whether the pool name exists in the resource pool, and if so, a resource pool with the same name as the username will be created (when **Create one if the pool does not exist** is selected).
**root.[primary group]**: The rule uses the resource pool matching the user's primary group. On Linux, the user's default primary group has the same name as the username. The names of the user's primary group and resource pool are used for match.
**root.[primary group].[username]**: The rule first uses the resource pool matching the user's primary group and then the subpool matching the username. If the selected pool does not exist but a pool is created, a subpool with the same name as the username will be created under the pool.
**root.[secondarygroup]**: The rule matches the user's secondary groups and uses the resource pool matching one of the secondary groups.
**root.[secondarygroup].[username]**: The rule first matches the user's secondary groups and then the resource pool matching the username.
**root.[username]**: The rule matches the resource pool with the same name as the username (not recommended).
Specified at runtime: The rule mainly uses the resource pool specified at runtime.
Placement rules are matched in the order of 1, 2, 3... If a rule is matched, rules after it will not be matched.

### Configuring user limits
In the **Policy settings** section, click **User limits** > **Create user limit** to create a user limit.
![](https://qcloudimg.tencent-cloud.cn/raw/c810a65f155a5ea1f727aea0ca9c55a3.png)
Set **Username** and **Max Concurrent Running Apps**.
![](https://qcloudimg.tencent-cloud.cn/raw/ecc5ee92ec96ca534635bbbc8d289c02.png)
